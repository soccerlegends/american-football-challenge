/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){var m="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},c="undefined"!==typeof module&&module.exports,f="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,g=function(){for(var b,a=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],d=0,e=a.length,c={};d<e;d++)if((b=a[d])&&b[1]in m){for(d=0;d<b.length;d++)c[a[0][d]]=
b[d];return c}return!1}(),a={change:g.fullscreenchange,error:g.fullscreenerror},d={request:function(b){var a=g.requestFullscreen;b=b||m.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))b[a]();else b[a](f&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){m[g.exitFullscreen]()},toggle:function(b){this.isFullscreen?this.exit():this.request(b)},onchange:function(b){this.on("change",b)},onerror:function(b){this.on("error",b)},on:function(b,d){var c=a[b];c&&m.addEventListener(c,d,!1)},off:function(b,
d){var c=a[b];c&&m.removeEventListener(c,d,!1)},raw:g};g?(Object.defineProperties(d,{isFullscreen:{get:function(){return!!m[g.fullscreenElement]}},element:{enumerable:!0,get:function(){return m[g.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!m[g.fullscreenEnabled]}}}),c?module.exports=d:window.screenfull=d):c?module.exports=!1:window.screenfull=!1})();
(function(){function m(b){b=String(b);return b.charAt(0).toUpperCase()+b.slice(1)}function c(b,a){var e=-1,d=b?b.length:0;if("number"==typeof d&&-1<d&&d<=q)for(;++e<d;)a(b[e],e,b);else g(b,a)}function f(b){b=String(b).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(b)?b:m(b)}function g(b,a){for(var e in b)r.call(b,e)&&a(b[e],e,b)}function a(b){return null==b?m(b):y.call(b).slice(8,-1)}function d(b,a){var e=null!=b?typeof b[a]:"number";return!/^(?:boolean|number|string|undefined)$/.test(e)&&
("object"==e?!!b[a]:!0)}function b(b){return String(b).replace(/([ -])(?!$)/g,"$1?")}function l(b,a){var e=null;c(b,function(d,c){e=a(e,d,c,b)});return e}function k(e){function c(a){return l(a,function(a,d){var c=d.pattern||b(d);!a&&(a=RegExp("\\b"+c+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+c+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+c+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((a=String(d.label&&!RegExp(c,"i").test(d.label)?d.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=
" "+a[1]),d=d.label||d,a=f(a[0].replace(RegExp(c,"i"),d).replace(RegExp("; *(?:"+d+"[_-])?","i")," ").replace(RegExp("("+d+")[-_.]?(\\w)","i"),"$1 $2")));return a})}function p(b){return l(b,function(b,a){return b||(RegExp(a+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}var q=h,n=e&&"object"==typeof e&&"String"!=a(e);n&&(q=e,e=null);var m=q.navigator||{},r=m.userAgent||"";e||(e=r);var u=n?!!m.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(y.toString()),
J=n?"Object":"ScriptBridgingProxyObject",L=n?"Object":"Environment",O=n&&q.java?"JavaPackage":a(q.java),x=n?"Object":"RuntimeObject";L=(O=/\bJava/.test(O)&&q.java)&&a(q.environment)==L;var M=O?"a":"\u03b1",Q=O?"b":"\u03b2",K=q.document||{},E=q.operamini||q.opera,R=t.test(R=n&&E?E["[[Class]]"]:a(E))?R:E=null,v,I=e;n=[];var V=null,S=e==r;r=S&&E&&"function"==typeof E.version&&E.version();var N=function(a){return l(a,function(a,d){return a||RegExp("\\b"+(d.pattern||b(d))+"\\b","i").exec(e)&&(d.label||
d)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),B=function(a){return l(a,function(a,d){return a||RegExp("\\b"+(d.pattern||b(d))+"\\b","i").exec(e)&&(d.label||d)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),P=c([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),T=function(a){return l(a,function(a,d,c){return a||(d[P]||d[/^[a-z]+(?: +[a-z]+\b)*/i.exec(P)]||RegExp("\\b"+b(c)+"(?:\\b|\\w*\\d)","i").exec(e))&&c})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),F=function(a){return l(a,function(a,d){var c=d.pattern||b(d);if(!a&&(a=RegExp("\\b"+c+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))){var h=a,k=d.label||d,n={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};c&&k&&/^Win/i.test(h)&&!/^Windows Phone /i.test(h)&&(n=n[/[\d.]+$/.exec(h)])&&(h="Windows "+n);h=String(h);c&&k&&(h=h.replace(RegExp(c,"i"),k));a=h=f(h.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return a})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);N&&(N=[N]);T&&!P&&(P=c([T]));if(v=/\bGoogle TV\b/.exec(P))P=v[0];/\bSimulator\b/i.test(e)&&(P=(P?P+" ":"")+"Simulator");"Opera Mini"==B&&/\bOPiOS\b/.test(e)&&n.push("running in Turbo/Uncompressed mode");"IE"==B&&/\blike iPhone OS\b/.test(e)?(v=k(e.replace(/like iPhone OS/,"")),T=v.manufacturer,P=v.product):/^iP/.test(P)?(B||(B="Safari"),F="iOS"+((v=/ OS ([\d_]+)/i.exec(e))?" "+v[1].replace(/_/g,"."):"")):"Konqueror"!=B||/buntu/i.test(F)?T&&"Google"!=T&&(/Chrome/.test(B)&&
!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(P))||/\bAndroid\b/.test(F)&&/^Chrome/.test(B)&&/\bVersion\//i.test(e)?(B="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==B?(/\bMobi/i.test(e)||(F="Android",n.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&n.unshift("accelerated")):"PaleMoon"==B&&(v=/\bFirefox\/([\d.]+)\b/.exec(e))?n.push("identifying as Firefox "+v[1]):"Firefox"==B&&(v=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(F||(F="Firefox OS"),P||(P=v[1])):!B||(v=!/\bMinefield\b/i.test(e)&&
/\b(?:Firefox|Safari)\b/.exec(B))?(B&&!P&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(v+"/")+8))&&(B=null),(v=P||T||F)&&(P||T||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(B=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:v)+" Browser")):"Electron"==B&&(v=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&n.push("Chromium "+v):F="Kubuntu";r||(r=p(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",b(B),"(?:Firefox|Minefield|NetFront)"]));
if(v="iCab"==N&&3<parseFloat(r)&&"WebKit"||/\bOpera\b/.test(B)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(N)&&"WebKit"||!N&&/\bMSIE\b/i.test(e)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==N&&/\bPlayStation\b(?! Vita\b)/i.test(B)&&"NetFront")N=[v];"IE"==B&&(v=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(B+=" Mobile",F="Windows Phone "+(/\+$/.test(v)?v:v+".x"),n.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(B="IE Mobile",F="Windows Phone 8.x",
n.unshift("desktop mode"),r||(r=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=B&&"Trident"==N&&(v=/\brv:([\d.]+)/.exec(e))&&(B&&n.push("identifying as "+B+(r?" "+r:"")),B="IE",r=v[1]);if(S){if(d(q,"global"))if(O&&(v=O.lang.System,I=v.getProperty("os.arch"),F=F||v.getProperty("os.name")+" "+v.getProperty("os.version")),L){try{r=q.require("ringo/engine").version.join("."),B="RingoJS"}catch(Y){(v=q.system)&&v.global.system==q.system&&(B="Narwhal",F||(F=v[0].os||null))}B||(B="Rhino")}else"object"==typeof q.process&&
!q.process.browser&&(v=q.process)&&("object"==typeof v.versions&&("string"==typeof v.versions.electron?(n.push("Node "+v.versions.node),B="Electron",r=v.versions.electron):"string"==typeof v.versions.nw&&(n.push("Chromium "+r,"Node "+v.versions.node),B="NW.js",r=v.versions.nw)),B||(B="Node.js",I=v.arch,F=v.platform,r=(r=/[\d.]+/.exec(v.version))?r[0]:null));else a(v=q.runtime)==J?(B="Adobe AIR",F=v.flash.system.Capabilities.os):a(v=q.phantom)==x?(B="PhantomJS",r=(v=v.version||null)&&v.major+"."+v.minor+
"."+v.patch):"number"==typeof K.documentMode&&(v=/\bTrident\/(\d+)/i.exec(e))?(r=[r,K.documentMode],(v=+v[1]+4)!=r[1]&&(n.push("IE "+r[1]+" mode"),N&&(N[1]=""),r[1]=v),r="IE"==B?String(r[1].toFixed(1)):r[0]):"number"==typeof K.documentMode&&/^(?:Chrome|Firefox)\b/.test(B)&&(n.push("masking as "+B+" "+r),B="IE",r="11.0",N=["Trident"],F="Windows");F=F&&f(F)}r&&(v=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(r)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(S&&m.appMinorVersion))||/\bMinefield\b/i.test(e)&&
"a")&&(V=/b/i.test(v)?"beta":"alpha",r=r.replace(RegExp(v+"\\+?$"),"")+("beta"==V?Q:M)+(/\d+\+?/.exec(v)||""));if("Fennec"==B||"Firefox"==B&&/\b(?:Android|Firefox OS)\b/.test(F))B="Firefox Mobile";else if("Maxthon"==B&&r)r=r.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(P))"Xbox 360"==P&&(F=null),"Xbox 360"==P&&/\bIEMobile\b/.test(e)&&n.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(B)&&(!B||P||/Browser|Mobi/.test(B))||"Windows CE"!=F&&!/Mobi/i.test(e))if("IE"==B&&S)try{null===q.external&&
n.unshift("platform preview")}catch(Y){n.unshift("embedded")}else(/\bBlackBerry\b/.test(P)||/\bBB10\b/.test(e))&&(v=(RegExp(P.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||r)?(v=[v,/BB10/.test(e)],F=(v[1]?(P=null,T="BlackBerry"):"Device Software")+" "+v[0],r=null):this!=g&&"Wii"!=P&&(S&&E||/Opera/.test(B)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==B&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==B&&(F&&!/^Win/.test(F)&&5.5<r||/\bWindows XP\b/.test(F)&&8<r||8==r&&!/\bTrident\b/.test(e)))&&!t.test(v=
k.call(g,e.replace(t,"")+";"))&&v.name&&(v="ing as "+v.name+((v=v.version)?" "+v:""),t.test(B)?(/\bIE\b/.test(v)&&"Mac OS"==F&&(F=null),v="identify"+v):(v="mask"+v,B=R?f(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(v)&&(F=null),S||(r=null)),N=["Presto"],n.push(v));else B+=" Mobile";if(v=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1]){v=[parseFloat(v.replace(/\.(\d)$/,".0$1")),v];if("Safari"==B&&"+"==v[1].slice(-1))B="WebKit Nightly",V="alpha",r=v[1].slice(0,-1);else if(r==v[1]||r==(v[2]=
(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1]))r=null;v[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1];537.36==v[0]&&537.36==v[2]&&28<=parseFloat(v[1])&&"WebKit"==N&&(N=["Blink"]);S&&(u||v[1])?(N&&(N[1]="like Chrome"),v=v[1]||(v=v[0],530>v?1:532>v?2:532.05>v?3:533>v?4:534.03>v?5:534.07>v?6:534.1>v?7:534.13>v?8:534.16>v?9:534.24>v?10:534.3>v?11:535.01>v?12:535.02>v?"13+":535.07>v?15:535.11>v?16:535.19>v?17:536.05>v?18:536.1>v?19:537.01>v?20:537.11>v?"21+":537.13>v?23:537.18>v?24:537.24>v?25:537.36>v?26:"Blink"!=
N?"27":"28")):(N&&(N[1]="like Safari"),v=(v=v[0],400>v?1:500>v?2:526>v?3:533>v?4:534>v?"4+":535>v?5:537>v?6:538>v?7:601>v?8:"8"));N&&(N[1]+=" "+(v+="number"==typeof v?".x":/[.+]/.test(v)?"":"+"));"Safari"==B&&(!r||45<parseInt(r))&&(r=v)}"Opera"==B&&(v=/\bzbov|zvav$/.exec(F))?(B+=" ",n.unshift("desktop mode"),"zvav"==v?(B+="Mini",r=null):B+="Mobile",F=F.replace(RegExp(" *"+v+"$"),"")):"Safari"==B&&/\bChrome\b/.exec(N&&N[1])&&(n.unshift("desktop mode"),B="Chrome Mobile",r=null,/\bOS X\b/.test(F)?(T=
"Apple",F="iOS 4.3+"):F=null);r&&0==r.indexOf(v=/[\d.]+$/.exec(F))&&-1<e.indexOf("/"+v+"-")&&(F=String(F.replace(v,"")).replace(/^ +| +$/g,""));N&&!/\b(?:Avant|Nook)\b/.test(B)&&(/Browser|Lunascape|Maxthon/.test(B)||"Safari"!=B&&/^iOS/.test(F)&&/\bSafari\b/.test(N[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(B)&&N[1])&&(v=N[N.length-1])&&n.push(v);n.length&&(n=["("+n.join("; ")+")"]);T&&P&&0>P.indexOf(T)&&n.push("on "+T);P&&n.push((/^on /.test(n[n.length-
1])?"":"on ")+P);if(F){var W=(v=/ ([\d.+]+)$/.exec(F))&&"/"==F.charAt(F.length-v[0].length-1);F={architecture:32,family:v&&!W?F.replace(v[0],""):F,version:v?v[1]:null,toString:function(){var b=this.version;return this.family+(b&&!W?" "+b:"")+(64==this.architecture?" 64-bit":"")}}}(v=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(I))&&!/\bi686\b/i.test(I)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+v),"")),B&&(/\bWOW64\b/i.test(e)||S&&/\w(?:86|32)$/.test(m.cpuClass||m.platform)&&!/\bWin64; x64\b/i.test(e))&&
n.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==B&&39<=parseFloat(r)&&(F.architecture=64);e||(e=null);q={};q.description=e;q.layout=N&&N[0];q.manufacturer=T;q.name=B;q.prerelease=V;q.product=P;q.ua=e;q.version=B&&r;q.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}};q.parse=k;q.toString=function(){return this.description||""};q.version&&n.unshift(r);q.name&&n.unshift(B);F&&B&&(F!=String(F).split(" ")[0]||F!=B.split(" ")[0]&&!P)&&n.push(P?"("+F+")":"on "+
F);n.length&&(q.description=n.join(" "));return q}var e={"function":!0,object:!0},h=e[typeof window]&&window||this,p=e[typeof exports]&&exports;e=e[typeof module]&&module&&!module.nodeType&&module;var n=p&&e&&"object"==typeof global&&global;!n||n.global!==n&&n.window!==n&&n.self!==n||(h=n);var q=Math.pow(2,53)-1,t=/\bOpera/;n=Object.prototype;var r=n.hasOwnProperty,y=n.toString,u=k();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(h.platform=u,define(function(){return u})):p&&
e?g(u,function(b,a){p[a]=b}):h.platform=u}).call(this);
function buildIOSMeta(){for(var m=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],c=0;c<m.length;c++){var f=document.createElement("meta");f.name=m[c].name;f.content=m[c].content;var g=window.document.head.querySelector('meta[name="'+f.name+'"]');g&&g.parentNode.removeChild(g);window.document.head.appendChild(f)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(m){return!0}}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"!==platform.name.toLowerCase()&&(buildIOSFullscreenPanel(),buildIOSMeta())});jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"!==platform.name.toLowerCase()&&iosResize()});var s_iScaleFactor=1,s_iOffsetX,s_iOffsetY,s_bIsIphone=!1,s_fInverseScaling=0;
(function(m){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(m)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(m.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(m){console.log(m)}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isIOS(){var m="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);m.length;)if(navigator.platform===m.pop())return!0;return s_bIsIphone=!1}
window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(m){var c=m.toLowerCase(),f=window.document,g=f.documentElement;if(void 0===window["inner"+m])m=g["client"+m];else if(window["inner"+m]!=g["client"+m]){var a=f.createElement("body");a.id="vpw-test-b";a.style.cssText="overflow:scroll";var d=f.createElement("div");d.id="vpw-test-d";d.style.cssText="position:absolute;top:-1000px";d.innerHTML="<style>@media("+c+":"+g["client"+m]+"px){body#vpw-test-b div#vpw-test-d{"+c+":7px!important}}</style>";a.appendChild(d);g.insertBefore(a,f.head);
m=7==d["offset"+m]?g["client"+m]:window["inner"+m];g.removeChild(a)}else m=window["inner"+m];return m}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var m=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<m?m:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var m="safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var c=getSize("Width");_checkOrientation(c,m);s_iScaleFactor=Math.min(m/CANVAS_HEIGHT,c/CANVAS_WIDTH);var f=CANVAS_WIDTH*s_iScaleFactor,g=CANVAS_HEIGHT*s_iScaleFactor;if(g<m){var a=m-g;g+=a;f+=CANVAS_WIDTH/CANVAS_HEIGHT*a}else f<c&&(a=c-f,f+=a,g+=CANVAS_HEIGHT/CANVAS_WIDTH*a);a=m/2-g/2;var d=c/2-f/2,b=CANVAS_WIDTH/f;if(d*b<-EDGEBOARD_X||a*b<-EDGEBOARD_Y)s_iScaleFactor=
Math.min(m/(CANVAS_HEIGHT-2*EDGEBOARD_Y),c/(CANVAS_WIDTH-2*EDGEBOARD_X)),f=CANVAS_WIDTH*s_iScaleFactor,g=CANVAS_HEIGHT*s_iScaleFactor,a=(m-g)/2,d=(c-f)/2,b=CANVAS_WIDTH/f;s_fInverseScaling=b;s_iOffsetX=-1*d*b;s_iOffsetY=-1*a*b;0<=a&&(s_iOffsetY=0);0<=d&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",
f+"px");$("#canvas").css("height",g+"px");0>a||(a=(m-g)/2);$("#canvas").css("top",a+"px");s_iCanvasOffsetHeight=a;$("#canvas").css("left",d+"px");resizeCanvas3D();s_iCanvasResizeWidth=f;s_iCanvasResizeHeight=g;s_iCanvasOffsetWidth=d;fullscreenHandler()}}
function _checkOrientation(m,c){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(m>c?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(m,c,f){var g=new createjs.Bitmap(m),a=new createjs.Shape;c&&f?a.graphics.beginFill("#fff").drawRect(-c/2,-f/2,c,f):a.graphics.beginFill("#ff0").drawRect(0,0,m.width,m.height);g.hitArea=a;return g}function createSprite(m,c,f,g,a,d){m=null!==c?new createjs.Sprite(m,c):new createjs.Sprite(m);c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(-f,-g,a,d);m.hitArea=c;return m}
function randomFloatBetween(m,c,f){"undefined"===typeof f&&(f=2);return parseFloat(Math.min(m+Math.random()*(c-m),c).toFixed(f))}function shuffle(m){for(var c=m.length,f,g;0!==c;)g=Math.floor(Math.random()*c),--c,f=m[c],m[c]=m[g],m[g]=f;return m}function formatTime(m){m/=1E3;var c=Math.floor(m/60);m=parseFloat(m-60*c).toFixed(1);var f="";f=10>c?f+("0"+c+":"):f+(c+":");return 10>m?f+("0"+m):f+m}function degreesToRadians(m){return m*Math.PI/180}
function checkRectCollision(m,c){var f=getBounds(m,.9);var g=getBounds(c,.98);return calculateIntersection(f,g)}function calculateIntersection(m,c){var f,g,a,d;var b=m.x+(f=m.width/2);var l=m.y+(g=m.height/2);var k=c.x+(a=c.width/2);var e=c.y+(d=c.height/2);b=Math.abs(b-k)-(f+a);l=Math.abs(l-e)-(g+d);return 0>b&&0>l?(b=Math.min(Math.min(m.width,c.width),-b),l=Math.min(Math.min(m.height,c.height),-l),{x:Math.max(m.x,c.x),y:Math.max(m.y,c.y),width:b,height:l,rect1:m,rect2:c}):null}
function getBounds(m,c){var f={x:Infinity,y:Infinity,width:0,height:0};if(m instanceof createjs.Container){f.x2=-Infinity;f.y2=-Infinity;var g=m.children,a=g.length,d;for(d=0;d<a;d++){var b=getBounds(g[d],1);b.x<f.x&&(f.x=b.x);b.y<f.y&&(f.y=b.y);b.x+b.width>f.x2&&(f.x2=b.x+b.width);b.y+b.height>f.y2&&(f.y2=b.y+b.height)}Infinity==f.x&&(f.x=0);Infinity==f.y&&(f.y=0);Infinity==f.x2&&(f.x2=0);Infinity==f.y2&&(f.y2=0);f.width=f.x2-f.x;f.height=f.y2-f.y;delete f.x2;delete f.y2}else{if(m instanceof createjs.Bitmap){a=
m.sourceRect||m.image;d=a.width*c;var l=a.height*c}else if(m instanceof createjs.Sprite)if(m.spriteSheet._frames&&m.spriteSheet._frames[m.currentFrame]&&m.spriteSheet._frames[m.currentFrame].image){a=m.spriteSheet.getFrame(m.currentFrame);d=a.rect.width;l=a.rect.height;g=a.regX;var k=a.regY}else f.x=m.x||0,f.y=m.y||0;else f.x=m.x||0,f.y=m.y||0;g=g||0;d=d||0;k=k||0;l=l||0;f.regX=g;f.regY=k;a=m.localToGlobal(0-g,0-k);b=m.localToGlobal(d-g,l-k);d=m.localToGlobal(d-g,0-k);g=m.localToGlobal(0-g,l-k);f.x=
Math.min(Math.min(Math.min(a.x,b.x),d.x),g.x);f.y=Math.min(Math.min(Math.min(a.y,b.y),d.y),g.y);f.width=Math.max(Math.max(Math.max(a.x,b.x),d.x),g.x)-f.x;f.height=Math.max(Math.max(Math.max(a.y,b.y),d.y),g.y)-f.y}return f}function NoClickDelay(m){this.element=m;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(m){switch(m.type){case "touchstart":this.onTouchStart(m);break;case "touchmove":this.onTouchMove(m);break;case "touchend":this.onTouchEnd(m)}},onTouchStart:function(m){m.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(m){this.moved=!0},onTouchEnd:function(m){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){m=document.elementFromPoint(m.changedTouches[0].clientX,m.changedTouches[0].clientY);3==m.nodeType&&(m=m.parentNode);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0);m.dispatchEvent(c)}}};
(function(){function m(f){var m={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};f=f||window.event;f.type in m?document.body.className=m[f.type]:(document.body.className=this[c]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var c="hidden";c in document?document.addEventListener("visibilitychange",m):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",m):(c="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",m):(c="msHidden")in document?document.addEventListener("msvisibilitychange",m):"onfocusin"in document?document.onfocusin=document.onfocusout=m:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=m})();function playSound(m,c,f){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[m].play(),s_aSounds[m].volume(c),s_aSounds[m].loop(f),s_aSounds[m]):null}
function stopSound(m){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[m].stop()}function setVolume(m,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[m].volume(c)}function setMute(m,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[m].mute(c)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(m){for(var c=window.location.search.substring(1).split("&"),f=0;f<c.length;f++){var g=c[f].split("=");if(g[0]==m)return g[1]}}function rotateVector2D(m,c){return{x:c.x*Math.cos(m)+c.y*Math.sin(m),y:c.x*-Math.sin(m)+c.y*Math.cos(m)}}function normalize(m,c){0<c&&(m.x/=c,m.y/=c);return m}function length(m){return Math.sqrt(m.x*m.x+m.y*m.y)}
function findNearestIntersectingObject(m,c,f,g){var a=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,d=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,b=new THREE.Raycaster,l=new THREE.Vector3;l.x=m/a*2-1;l.y=2*-(c/d)+1;l.z=.5;b.setFromCamera(l,f);m=b.intersectObjects(g,!0);c=!1;0<m.length&&(c=m[0]);return c}function distance(m,c,f,g){m-=f;c-=g;return Math.sqrt(m*m+c*c)}function distance2(m,c,f,g){m-=f;c-=g;return m*m+c*c}
function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var m=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);m.rotation.x=Math.PI/180*90;m.position.set(0,0,0);m.updateProjectionMatrix();m.updateMatrixWorld();return m}function rotateVector2D(m,c){return{x:c.x*Math.cos(m)+c.y*Math.sin(m),y:c.x*-Math.sin(m)+c.y*Math.cos(m),z:0}}Math.radians=function(m){return m*Math.PI/180};Math.degrees=function(m){return 180*m/Math.PI};
function distanceV3(m,c,f,g,a,d){m-=g;c-=a;f-=d;return Math.sqrt(m*m+c*c+f*f)}function distanceV2(m,c){var f=m.x-c.x,g=m.y-c.y;return Math.sqrt(f*f+g*g)}function saveItem(m,c){s_bStorageAvailable&&localStorage.setItem(m,c)}function getItem(m){return s_bStorageAvailable?localStorage.getItem(m):null}function clearAllItem(){s_bStorageAvailable&&localStorage.clear()}
function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.enabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut())}if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut()});
var s_szGameID="549acb1f378e4de48e042580276a2d51";window.GD_OPTIONS={gameId:s_szGameID,onEvent:function(m){switch(m.name){case "SDK_GAME_START":s_oMain&&s_oMain.startUpdate();break;case "SDK_GAME_PAUSE":s_oMain&&s_oMain.stopUpdate()}}};(function(m,c,f){var g=m.getElementsByTagName(c)[0];m.getElementById(f)||(m=m.createElement(c),m.id=f,m.src="/main.min.js",g.parentNode.insertBefore(m,g))})(document,"script","gamedistribution-jssdk");
function CSpriteLibrary(){var m={},c,f,g,a,d,b;this.init=function(l,k,e){c={};g=f=0;a=l;d=k;b=e};this.addSprite=function(b,a){if(!m.hasOwnProperty(b)){var e=new Image;m[b]=c[b]={szPath:a,oSprite:e,bLoaded:!1};f++}};this.getSprite=function(b){return m.hasOwnProperty(b)?m[b].oSprite:null};this._onSpritesLoaded=function(){f=0;d.call(b)};this._onSpriteLoaded=function(){a.call(b);++g===f&&this._onSpritesLoaded()};this.loadSprites=function(){for(var b in c)c[b].oSprite.oSpriteLibrary=this,c[b].oSprite.szKey=
b,c[b].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},c[b].oSprite.onerror=function(b){var a=b.currentTarget;setTimeout(function(){c[a.szKey].oSprite.src=c[a.szKey].szPath},500)},c[b].oSprite.src=c[b].szPath};this.setLoaded=function(b){m[b].bLoaded=!0};this.isLoaded=function(b){return m[b].bLoaded};this.getNumSprites=function(){return f}}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=768,CANVAS_WIDTH_HALF=.5*CANVAS_WIDTH,CANVAS_HEIGHT_HALF=.5*CANVAS_HEIGHT,EDGEBOARD_X=90,EDGEBOARD_Y=95,DISABLE_SOUND_MOBILE=!1,FONT_GAME="arialrounded",FPS=30,FPS_DESKTOP=60,FPS_TIME=1/FPS,ROLL_BALL_RATE=60/FPS,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_TWEEN_ENDED=6,ON_BUT_NO_DOWN=7,ON_BUT_YES_DOWN=8,STEP_RATE=1.5,TEXT_SIZE=[80,100,130],TEXT_EXCELLENT_COLOR=
["#fff","#5d96fe"],TEXT_COLOR="#ffffff",TEXT_COLOR_STROKE="#000000",TIME_INTERVAL_STROBE=.2,PHYSICS_ACCURACY=3,MOBILE_OFFSET_GLOVES_X=-100,BALL_VELOCITY_MULTIPLIER=1,PHYSICS_STEP=1/(FPS*STEP_RATE),STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,BALL_MASS=.5,BALL_RADIUS=1,BALL_LINEAR_DAMPING=.2,OFFSET_BALL_POS_X=10,MIN_BALL_VEL_ROTATION=.1,TIME_RESET_AFTER_KEEPER_SAVED=2,TIME_RESET_AFTER_PERFECT_KEEPER_SAVED=2,TIME_BALL_IN_HAND=1E3,FOV=45,HAND_KEEPER_ANGLE_RATE=.15,LIMIT_HAND_RANGE_POS={x:22,
zMax:5.1,zMin:-8.5},POSITION_BALL={x:0,y:125,z:5.5},BALL_SPEED_FOR_RESET=2,HAND_KEEPER_SIZE={width:1.8,depth:.5,height:1.5},HAND_KEEPER_POSITION={x:0,y:36,z:0},SHOW_3D_RENDER=!1,CAMERA_TEST=!1,NEAR=10,FAR=2E3,SOUNDTRACK_VOLUME_IN_GAME=.2;TEXT_GAMEOVER="GAME OVER";TEXT_OF="/";TEXT_HELP1_PC="MOVE THE MOUSE TO CONTROL THE RECEIVER GLOVES TO CATCH THE BALL";TEXT_HELP1_MOBILE="MOVE THE FINGER TO CONTROL THE RECEIVER GLOVES TO CATCH THE BALL";TEXT_COMPLETE="COMPLETE";TEXT_SELECT_A_LEVEL="SELECT A LEVEL";
TEXT_TOTAL_SCORE="TOTAL SCORE";TEXT_WIN="YOU WON";TEXT_LOSE="YOU LOST";TEXT_BALLS="BALLS";TEXT_MISS_BALL="MISS BALL SCORE";TEXT_LAUNCH="LAUNCH";TEXT_SCORE_BALL_CATCH="BALL CATCH SCORE";TEXT_SCORE_BALL="BALL CATCH";TEXT_MATCH_SCORE="MATCH SCORE";TEXT_ARE_SURE="ARE YOU SURE?";TEXT_CREDITS_DEVELOPED="DEVELOPED BY";TEXT_CAUGHT="YOU CAUGHT";TEXT_RESET="ARE YOU SURE? ALL YOUR PREVIOUS SAVINGS WILL BE DELETED!";TEXT_MATCH="MATCH";TEXT_PAUSE="PAUSE";TEXT_HOW_TO_PLAY="HOW TO PLAY";
TEXT_CONGRATULATION=["GOOD!","GREAT!","EXCELLENT!!!"];TEXT_MISS="MISS!";var TEXT_START_MSG="TAP TO START QUARTERBACK THROW",TEXT_ERR_LS="YOUR WEB BROWSER DOES NOT SUPPORT LOCAL STORAGE. IF YOU'RE USING SAFARI, IT MAY BE RELATED TO PRIVATE BROWSING. AS A RESULT, SOME INFO MAY NOT BE SAVED OR SOME FEATURES MAY NOT BE AVAILABLE.",TEXT_PRELOADER_CONTINUE="START";TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";
TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var m,c,f,g,a,d,b,l,k,e;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();e=new createjs.Container;s_oStage.addChild(e)};this.unload=function(){e.removeAllChildren();k.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.addChild(h);h=s_oSpriteLibrary.getSprite("200x200");b=createBitmap(h);b.regX=.5*h.width;b.regY=.5*h.height;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-140;e.addChild(b);l=new createjs.Shape;l.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(b.x-100,b.y-100,200,200,10);e.addChild(l);b.mask=l;
h=s_oSpriteLibrary.getSprite("progress_bar");g=createBitmap(h);g.x=CANVAS_WIDTH/2-h.width/2;g.y=CANVAS_HEIGHT/2+90;e.addChild(g);m=h.width;c=h.height;a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(g.x,g.y,1,c);e.addChild(a);g.mask=a;f=new createjs.Text("","30px "+FONT_GAME,"#fff");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2+140;f.textBaseline="alphabetic";f.textAlign="center";e.addChild(f);h=s_oSpriteLibrary.getSprite("but_start");k=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2+40,h,TEXT_PRELOADER_CONTINUE,"Arial","#000",50,e);k.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);k.setVisible(!1);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.addChild(d);createjs.Tween.get(d).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(d);e.removeChild(d)})};this._onButStartRelease=function(){s_oMain._onRemovePreloader()};this.refreshLoader=function(b){f.text=b+"%";100===b&&(s_oMain._onRemovePreloader(),f.visible=
!1,g.visible=!1);a.graphics.clear();b=Math.floor(b*m/100);a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(g.x,g.y,b,c)};this._init()}
function CMain(m){var c,f=0,g=0,a=STATE_LOADING,d,b;this.initContainer=function(){var b=document.getElementById("canvas");s_oStage=new createjs.Stage(b);createjs.Touch.enable(s_oStage);s_oStage.preventSelection=!1;s_bMobile=jQuery.browser.mobile;!1===s_bMobile?(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(b){return!1}),FPS=FPS_DESKTOP,FPS_TIME=1/FPS,PHYSICS_STEP=1/(FPS*STEP_RATE),ROLL_BALL_RATE=60/FPS):BALL_VELOCITY_MULTIPLIER=.8;s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",
this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;d=new CPreloader;c=!0};this.soundLoaded=function(){f++;d.refreshLoader(Math.floor(f/g*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"drop_bounce_grass",loop:!1,volume:1,ingamename:"drop_bounce_grass"});s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,
ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"keep_ball",loop:!1,volume:1,ingamename:"keep_ball"});s_aSoundsInfo.push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"});s_aSoundsInfo.push({path:"./sounds/",filename:"miss",loop:!1,volume:1,ingamename:"miss"});s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});g+=s_aSoundsInfo.length;s_aSounds=[];for(var b=0;b<s_aSoundsInfo.length;b++)this.tryToLoadSound(s_aSoundsInfo[b],
!1)};this.tryToLoadSound=function(b,a){setTimeout(function(){s_aSounds[b.ingamename]=new Howl({src:[b.path+b.filename+".mp3"],autoplay:!1,preload:!0,loop:b.loop,volume:b.volume,onload:s_oMain.soundLoaded,onloaderror:function(b,a){for(var e=0;e<s_aSoundsInfo.length;e++)if(b===s_aSounds[s_aSoundsInfo[e].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[e],!0);break}},onplayerror:function(b){for(var a=0;a<s_aSoundsInfo.length;a++)if(b===s_aSounds[s_aSoundsInfo[a].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[a].ingamename].once("unlock",
function(){s_aSounds[s_aSoundsInfo[a].ingamename].play();"soundtrack"===s_aSoundsInfo[a].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},a?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("but_restart_small","./sprites/but_restart_small.png");
s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("msg_box_small","./sprites/msg_box_small.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_continue_big",
"./sprites/but_continue_big.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("gloves","./sprites/gloves.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_info",
"./sprites/but_info.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("quarterback","./sprites/quarterback.png");s_oSpriteLibrary.addSprite("ball_shadow","./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("gui_panel","./sprites/gui_panel.png");s_oSpriteLibrary.addSprite("help_mouse",
"./sprites/help_mouse.png");s_oSpriteLibrary.addSprite("help_touch","./sprites/help_touch.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");g+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){f++;d.refreshLoader(Math.floor(f/g*100))};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||
this._initSounds();c=!0};this._onRemovePreloader=function(){try{saveItem("ls_available","ok")}catch(k){s_bStorageAvailable=!1}d.unload();try{checkMoreGames(s_szGameID,"bottom-left",["sport","multiplayer"],[],-1,"dark_green")}catch(k){}s_oSoundTrack=playSound("soundtrack",1,!0);this.gotoMenu()};this.gotoMenu=function(){try{showMoreGames()}catch(k){}new CMenu(m.ball_to_saved.length);a=STATE_MENU};this.gotoGame=function(d){b=new CGame(l,d);a=STATE_GAME};this.gotoLevelMenu=function(){new CLevelMenu(m.ball_to_saved.length);
a=STATE_MENU};this.gotoHelp=function(){new CHelp;a=STATE_HELP};this.stopUpdate=function(){c=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();c=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(d){if(!1!==c){var e=(new Date).getTime();s_iTimeElaps=
e-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=e;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);a===STATE_GAME&&b.update();s_oStage.update(d)}};s_oMain=this;var l=m;ENABLE_FULLSCREEN=m.fullscreen;ENABLE_CHECK_ORIENTATION=m.check_orientation;s_bAudioActive=m.audio_enable_on_startup;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_bStorageAvailable=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iLevelReached=18,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_iAdsLevel=1,s_iLastLevel=1,s_aScores=[],s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack=null,s_aSounds;
function CTextButton(m,c,f,g,a,d,b,l){var k,e,h,p,n,q,t,r,y,u;this._init=function(b,a,d,c,n,q,f){k=!1;e=1;h=[];p=[];u=createBitmap(d);r=new createjs.Container;r.x=b;r.y=a;r.regX=d.width/2;r.regY=d.height/2;s_bMobile||(r.cursor="pointer");r.addChild(u,y);l.addChild(r);y=new CTLText(r,10,5,d.width-20,d.height-10,f,"center",q,n,1,0,0,c,!0,!0,!1,!1);this._initListener()};this.unload=function(){r.off("mousedown",n);r.off("pressup",q);l.removeChild(r)};this.setVisible=function(b){r.visible=b};this.setAlign=
function(b){y.textAlign=b};this.setTextX=function(b){y.x=b};this.setScale=function(b){e=r.scaleX=r.scaleY=b};this.enable=function(){k=!1};this.disable=function(){k=!0};this._initListener=function(){n=r.on("mousedown",this.buttonDown);q=r.on("pressup",this.buttonRelease)};this.addEventListener=function(b,a,e){h[b]=a;p[b]=e};this.addEventListenerWithParams=function(b,a,e,d){h[b]=a;p[b]=e;t=d};this.buttonRelease=function(){k||(playSound("click",1,!1),r.scaleX=e,r.scaleY=e,h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(p[ON_MOUSE_UP],
t))};this.buttonDown=function(){k||(r.scaleX=.9*e,r.scaleY=.9*e,h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(p[ON_MOUSE_DOWN]))};this.setPosition=function(b,a){r.x=b;r.y=a};this.tweenPosition=function(b,a,e,d,c,h,k){createjs.Tween.get(r).wait(d).to({x:b,y:a},e,c).call(function(){void 0!==h&&h.call(k)})};this.changeText=function(b){y.refreshText(b)};this.setX=function(b){r.x=b};this.setY=function(b){r.y=b};this.getButtonImage=function(){return r};this.getX=function(){return r.x};this.getY=function(){return r.y};
this.getSprite=function(){return r};this.getScale=function(){return r.scaleX};this._init(m,c,f,g,a,d,b)}
function CToggle(m,c,f,g,a){var d,b,l,k,e,h,p;this._init=function(a,e,c,k,f){p=void 0!==f?f:s_oStage;b=[];l=[];f=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{state_true:[0],state_false:[1]}});d=k;h=createSprite(f,"state_"+d,c.width/2/2,c.height/2,c.width/2,c.height);h.x=a;h.y=e;h.stop();s_bMobile||(h.cursor="pointer");p.addChild(h);this._initListener()};this.unload=function(){h.off("mousedown",k);h.off("pressup",e);p.removeChild(h)};
this._initListener=function(){k=h.on("mousedown",this.buttonDown);e=h.on("pressup",this.buttonRelease)};this.addEventListener=function(a,e,d){b[a]=e;l[a]=d};this.setCursorType=function(b){h.cursor=b};this.setActive=function(b){d=b;h.gotoAndStop("state_"+d)};this.buttonRelease=function(){h.scaleX=1;h.scaleY=1;playSound("click",1,!1);d=!d;h.gotoAndStop("state_"+d);b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(l[ON_MOUSE_UP],d)};this.buttonDown=function(){h.scaleX=.9;h.scaleY=.9;b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])};
this.setPosition=function(b,a){h.x=b;h.y=a};this._init(m,c,f,g,a)}
function CGfxButton(m,c,f,g){var a,d,b,l,k,e,h,p,n=!1;this._init=function(b,c,n){a=[];d=[];e=[];k=createBitmap(n);k.x=b;k.y=c;p=h=1;k.regX=n.width/2;k.regY=n.height/2;s_bMobile||(k.cursor="pointer");q.addChild(k);this._initListener()};this.unload=function(){k.off("mousedown",b);k.off("pressup",l);q.removeChild(k)};this.setVisible=function(b){k.visible=b};this.setCursorType=function(b){k.cursor=b};this._initListener=function(){b=k.on("mousedown",this.buttonDown);l=k.on("pressup",this.buttonRelease)};
this.addEventListener=function(b,e,c){a[b]=e;d[b]=c};this.addEventListenerWithParams=function(b,c,h,k){a[b]=c;d[b]=h;e[b]=k};this.buttonRelease=function(){n||(k.scaleX=0<h?1:-1,k.scaleY=1,playSound("click",1,!1),a[ON_MOUSE_UP]&&a[ON_MOUSE_UP].call(d[ON_MOUSE_UP],e[ON_MOUSE_UP]))};this.buttonDown=function(){n||(k.scaleX=0<h?.9:-.9,k.scaleY=.9,a[ON_MOUSE_DOWN]&&a[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN],e[ON_MOUSE_DOWN]))};this.rotation=function(b){k.rotation=b};this.getButton=function(){return k};this.setPosition=
function(b,a){k.x=b;k.y=a};this.setX=function(b){k.x=b};this.setY=function(b){k.y=b};this.getButtonImage=function(){return k};this.block=function(b){n=b;k.scaleX=h;k.scaleY=p};this.setScaleX=function(b){h=k.scaleX=b};this.getX=function(){return k.x};this.getY=function(){return k.y};this.pulseAnimation=function(){createjs.Tween.get(k).to({scaleX:.9*h,scaleY:.9*p},850,createjs.Ease.quadOut).to({scaleX:h,scaleY:p},650,createjs.Ease.quadIn).call(function(){t.pulseAnimation()})};this.trebleAnimation=function(){createjs.Tween.get(k).to({rotation:5},
75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){t.trebleAnimation()})};this.removeAllTweens=function(){createjs.Tween.removeTweens(k)};var q=void 0!==g?g:s_oStage;this._init(m,c,f);var t=this;return this}
function CMenu(m){var c,f,g,a,d,b,l,k,e,h,p,n,q,t,r=null,y,u=null,x=null;this._init=function(){e=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(e);var m=s_oSpriteLibrary.getSprite("but_play");d=CANVAS_WIDTH/2;b=CANVAS_HEIGHT-230;h=new CGfxButton(d,b,m);h.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);s_bStorageAvailable&&null!==getItem("LevelReached")?(s_iLastLevel=getItem("LevelReached"),s_aScores=JSON.parse(getItem("Scores")),h.setPosition(CANVAS_WIDTH/2-200,CANVAS_HEIGHT-
230),m=s_oSpriteLibrary.getSprite("but_continue_big"),n=new CGfxButton(CANVAS_WIDTH/2+200,CANVAS_HEIGHT-230,m),n.addEventListener(ON_MOUSE_UP,this._onButContinueRelease,this),n.pulseAnimation()):(h.setPosition(CANVAS_WIDTH/2,584),h.pulseAnimation(),this.resetArrayScores());!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(m=s_oSpriteLibrary.getSprite("audio_icon"),l=CANVAS_WIDTH-m.height/2-10,k=m.height/2+10,t=new CToggle(l,k,m,s_bAudioActive),t.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),m=s_oSpriteLibrary.getSprite("but_fullscreen"),
c=l-m.width/2-10,f=k):(m=s_oSpriteLibrary.getSprite("but_fullscreen"),c=CANVAS_WIDTH-m.height/2-10,f=m.height/2+10);var r=s_oSpriteLibrary.getSprite("but_info");g=r.height/2+10;a=r.height/2+10;p=new CGfxButton(g,a,r,s_oStage);p.addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this);r=window.document;var w=r.documentElement;u=w.requestFullscreen||w.mozRequestFullScreen||w.webkitRequestFullScreen||w.msRequestFullscreen;x=r.exitFullscreen||r.mozCancelFullScreen||r.webkitExitFullscreen||r.msExitFullscreen;
!1===ENABLE_FULLSCREEN&&(u=!1);u&&screenfull.enabled&&(y=new CToggle(c,f,m,s_bFullscreen,s_oStage),y.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(q);createjs.Tween.get(q).to({alpha:0},1E3).call(function(){q.visible=!1});s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(b,e){!1!==DISABLE_SOUND_MOBILE&&
!1!==s_bMobile||t.setPosition(l-b,e+k);u&&screenfull.enabled&&y.setPosition(c-s_iOffsetX,f+s_iOffsetY);p.setPosition(g+b,a+e)};this.unload=function(){h.unload();h=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t.unload(),t=null;u&&screenfull.enabled&&y.unload();s_oStage.removeAllChildren();s_oMenu=null};this._onButPlayRelease=function(){"undefined"!==typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(z){}s_bStorageAvailable&&null!==getItem("LevelReached")?null===
r&&(r=new CConfirmPanel(TEXT_RESET,0),r.addEventListener(ON_BUT_NO_DOWN,this._onButNo,this),r.addEventListener(ON_BUT_YES_DOWN,this._onButYes,this)):(this.unload(),s_oMain.gotoLevelMenu())};this._onButContinueRelease=function(){"undefined"!==typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(z){}this.unload();s_oMain.gotoLevelMenu()};this._onButNo=function(){r.unload();r=null};this._onButYes=function(){clearAllItem();this.unload();s_iLastLevel=1;this.resetArrayScores();
s_oMain.gotoLevelMenu()};this.resetArrayScores=function(){s_aScores=[];for(var b=0;b<w;b++)s_aScores[b]=0};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=function(){new CCreditsPanel};this.resetFullscreenBut=function(){u&&screenfull.enabled&&y.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?x.call(window.document):u.call(window.document.documentElement);sizeHandler()};s_oMenu=this;var w=m;this._init()}
var s_oMenu=null;
function CGame(m,c){var f,g,a,d,b,l=null,k=null,e,h=!1,p=!1,n=!1,q=!1,t,r,y,u,x=0,w=0,z=0,A=0,C,D,G=STATE_INIT,H=null,J;this._init=function(){this.pause(!0);u=y=0;t=!1;D=[];r=c;for(var h=0;h<r;h++)y+=s_aScores[h];e=new createjs.Container;s_oStage.addChild(e);s_bMobile&&this.velocityBall();g=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));e.addChild(g);a=new CScenario(r);H=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();h=s_oSpriteLibrary.getSprite("quarterback");l=new CQuarterback(640,480,h,
e);h=s_oSpriteLibrary.getSprite("ball");b=new CBall(0,0,h,a.ballBody(),e);D.push(b);this.ballPosition();resizeCanvas3D();setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME);f=new CInterface;h=s_oSpriteLibrary.getSprite("gloves");d=new CGloves(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF,h,a.getHandKeeperBody(),e);D.push(d);f.refreshBallCatch(z,BALL_TO_SAVED[r]);f.refreshMatchNum(r+1);f.refreshLaunch(w,MATCH_LAUNCH[r]);if(SHOW_3D_RENDER)this.onExitHelp();else f.createHelpPanel();f.showHelpText(!0)};this.velocityBall=
function(){for(var b=0;b<BALL_FORCE_Y.length;b++)BALL_FORCE_Y[b]*=BALL_VELOCITY_MULTIPLIER,BALL_FORCE_Z[b].min/=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_Z[b].max*=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_X[b]*=BALL_VELOCITY_MULTIPLIER};this.sortDepth=function(b,a){null!==b&&null!==a&&(b.getDepthPos()>a.getDepthPos()?e.getChildIndex(b.getObject())>e.getChildIndex(a.getObject())&&e.swapChildren(b.getObject(),a.getObject()):b.getDepthPos()<a.getDepthPos()&&e.getChildIndex(a.getObject())>e.getChildIndex(b.getObject())&&
e.swapChildren(a.getObject(),b.getObject()))};this.onExitHelp=function(){this.pause(!1);f.onExitFromHelp()};this.activeEventListeners=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.addImpulseToBall),window.addEventListener("mousemove",this.onHandKeeper)):(null===k&&(k=s_oStage.on("stagemousemove",this.onHandKeeper)),J=e.on("click",this.clickStage,this))};this.clickStage=function(){e.off("click",J);s_oGame.startQuarterbackShot();f.showHelpText(!1)};this.deactiveEventListeners=
function(){SHOW_3D_RENDER?(window.removeEventListener("mousedown",this.addImpulseToBall),window.removeEventListener("mousemove",this.onHandKeeper)):(s_oStage.off("stagemousemove",k),k=null)};this.ballPosition=function(){var e=a.ballBody(),d=this.convert3dPosTo2dScreen(e.position,H),c=b.getStartScale()-d.z;this.shadowBall(e,c);b.scale(c);b.setPosition(d.x,d.y)};this.getLevel=function(){return r};this.shadowBall=function(e,d){var c=a.getFieldBody(),h=this.convert3dPosTo2dScreen({x:e.position.x,y:e.position.y,
z:c.position.z},H);b.scaleShadow(d/(e.position.z-c.position.z));b.setAlphaByHeight(.1*(-e.position.z-.1*c.position.z));b.setPositionShadow(h.x,h.y)};this.unload=function(){f.unload();a.destroyWorld();a=null;this.deactiveEventListeners();s_oStage.removeAllChildren()};this.onContinue=function(){this.nextLevel();G=STATE_PLAY;this.resetValues();this.activeEventListeners()};this.resetValues=function(){w=u=z=x=0;f.refreshBallCatch(z,BALL_TO_SAVED[r]);f.refreshLaunch(w,MATCH_LAUNCH[r])};this.nextLevel=function(){r++;
f.refreshMatchNum(r+1);this.resetScene();$(s_oMain).trigger("start_level",r);f.showHelpText(!0)};this.keeperSave=function(a){h||(a.x>-BALL_SAVED_POINT.x&&a.x<BALL_SAVED_POINT.x&&a.z>-BALL_SAVED_POINT.z&&a.z<BALL_SAVED_POINT.z?(p=!0,b.getPhysics().mass=0,C=TIME_RESET_AFTER_PERFECT_KEEPER_SAVED,z++,f.refreshBallCatch(z,BALL_TO_SAVED[r]),d.changeState("perfect"),createjs.Tween.get(e).wait(TIME_BALL_IN_HAND).call(function(){p=!1;b.getPhysics().mass=BALL_MASS;d.changeState("normal")}),createjs.Tween.get(e).wait(300).call(function(){s_oGame.textSave()})):
(p=!1,C=TIME_RESET_AFTER_KEEPER_SAVED),b.playAnim("start"),h=!0,playSound("keep_ball",1,!1))};this.addImpulseToBall=function(){if(!n&&G===STATE_PLAY){var e={x:Math.random()*(BALL_FORCE_X[r]+BALL_FORCE_X[r])-BALL_FORCE_X[r],y:-BALL_FORCE_Y[r],z:Math.random()*(BALL_FORCE_Z[r].max-BALL_FORCE_Z[r].min)+BALL_FORCE_Z[r].min},d=a.ballBody();a.addImpulse(d,e);a.setElementAngularVelocity(d,{x:0,y:0,z:0});b.setVisible(!0);b.playAnim("rotate");n=!0;w++;f.refreshLaunch(w,MATCH_LAUNCH[r])}};this.pause=function(b){b?
(G=STATE_PAUSE,null!==l&&l.stopAnimation(),this.deactiveEventListeners()):(G=STATE_PLAY,null!==l&&l.playAnimation(),this.activeEventListeners());createjs.Ticker.paused=b};this.startQuarterbackShot=function(){l.changeState("shot");l.onFinishAnimation()};this.onExit=function(){this.unload();$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume("soundtrack",1);s_oMain.gotoMenu()};this.restartLevel=function(){this.resetValues();this.resetScene();f.showHelpText(!0);this.activeEventListeners();
G=STATE_PLAY;$(s_oMain).trigger("restart_level",r)};this.resetBallPosition=function(){var e=a.ballBody();e.sleep();b.setVisible(!1);e.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);a.setElementVelocity(e,{x:0,y:0,z:0});a.setElementAngularVelocity(e,{x:0,y:0,z:0});b.fadeAnimation(1,500,0)};this.ballFadeForReset=function(){h&&!q&&(b.fadeAnimation(0,300,1E3),q=!0)};this._updateInit=function(){a.update();this._updateBall2DPosition();G=STATE_PLAY};this.onHandKeeper=function(b){var e=a.getHandKeeperBody();
b=SHOW_3D_RENDER?{x:b.clientX-s_iCanvasOffsetWidth,y:b.clientY-s_iCanvasOffsetHeight}:{x:b.stageX/s_fInverseScaling,y:b.stageY/s_fInverseScaling};s_bMobile&&(b.x+=MOBILE_OFFSET_GLOVES_X);b=s_oGame.convert2dScreenPosTo3d(b,e);e.position.x=b.x<LIMIT_HAND_RANGE_POS.x&&b.x>-LIMIT_HAND_RANGE_POS.x?b.x:b.x<LIMIT_HAND_RANGE_POS.x?-LIMIT_HAND_RANGE_POS.x:LIMIT_HAND_RANGE_POS.x;e.position.z=b.z>LIMIT_HAND_RANGE_POS.zMin&&b.z<LIMIT_HAND_RANGE_POS.zMax?b.z:b.z>LIMIT_HAND_RANGE_POS.zMin?LIMIT_HAND_RANGE_POS.zMax:
LIMIT_HAND_RANGE_POS.zMin;b=s_oGame.convert3dPosTo2dScreen(e.position,H);d.setPosition(b.x,b.y);p&&s_oGame.ballInHand(e.position)};this.ballInHand=function(e){var d=a.ballBody();d.position.x=e.x;d.position.y=e.y+.7*BALL_RADIUS;d.position.z=e.z;e=this.convert3dPosTo2dScreen(d.position,H);var c=b.getStartScale()-e.z;this.shadowBall(d,c);b.scale(b.getStartScale()-e.z);b.setPosition(e.x,e.y)};this.convert2dScreenPosTo3d=function(b){b=new THREE.Vector3(b.x/s_iCanvasResizeWidth*2-1,2*-(b.y/s_iCanvasResizeHeight)+
1,-1);b.unproject(H);b.sub(H.position);b.normalize();b.multiply(new THREE.Vector3(34,1,34));return b};this.convert3dPosTo2dScreen=function(b,a){var e=(new THREE.Vector3(b.x,b.y,b.z)).project(a),d=.5*Math.floor(s_iCanvasResizeWidth),c=.5*Math.floor(s_iCanvasResizeHeight);e.x=(e.x*d+d)*s_fInverseScaling;e.y=(-(e.y*c)+c)*s_fInverseScaling;return e};this.timeReset=function(){0<C?C-=FPS_TIME:(t=!0,h||x++,w<MATCH_LAUNCH[r]?(this.resetScene(),q=!1,this.startQuarterbackShot()):(this.matchResult(),G=STATE_FINISH,
$(s_oMain).trigger("end_level",r),this.deactiveEventListeners()),n=!1)};this.textSave=function(){if(A<TEXT_CONGRATULATION.length){var b=!1;A>=TEXT_CONGRATULATION.length-1&&(b=!0);f.createAnimText(TEXT_CONGRATULATION[A],TEXT_SIZE[A],b);A++}else{b=!1;var a=Math.floor(Math.random()*(TEXT_CONGRATULATION.length-1))+1;a>=TEXT_CONGRATULATION.length-1&&(b=!0);f.createAnimText(TEXT_CONGRATULATION[a],TEXT_SIZE[a],b)}};this.textMiss=function(){f.createAnimText(TEXT_MISS,80,!1);playSound("miss",1,!1)};this.matchResult=
function(){z>=BALL_TO_SAVED[r]?this.wonMatch():this.lostMatch()};this.displayShock=function(b,a,d){createjs.Tween.get(e).to({x:Math.round(Math.random()*a),y:Math.round(Math.random()*d)},b).call(function(){createjs.Tween.get(e).to({x:Math.round(Math.random()*a*.8),y:-Math.round(Math.random()*d*.8)},b).call(function(){createjs.Tween.get(e).to({x:Math.round(Math.random()*a*.6),y:Math.round(Math.random()*d*.6)},b).call(function(){createjs.Tween.get(e).to({x:Math.round(Math.random()*a*.4),y:-Math.round(Math.random()*
d*.4)},b).call(function(){createjs.Tween.get(e).to({x:Math.round(Math.random()*a*.2),y:Math.round(Math.random()*d*.2)},b).call(function(){createjs.Tween.get(e).to({y:0,x:0},b).call(function(){})})})})})})};this.wonMatch=function(){var b=!1;r>=MATCH_LAUNCH.length-1&&(b=!0);var a=this.calculateNewScore();y=a.new_score;this.saveProgress();f.createWinPanel(z,BALL_TO_SAVED[r],a,b);playSound("win",1,!1)};this.lostMatch=function(){f.createLosePanel(z,BALL_TO_SAVED[r])};this.calculateNewScore=function(){var b=
{score:y,ball_saved:0,num_miss:0,new_score:0};b.ball_saved=z*SCORE_BALL_CATCH;b.num_miss=x*SCORE_MISS;u=b.ball_saved+b.num_miss;b.new_score=b.score+u;0>b.new_score&&(b.new_score=0);return b};this.saveProgress=function(){s_iLastLevel<r+2&&(s_iLastLevel=r+2);u>s_aScores[r]&&(s_aScores[r]=u);saveItem("LevelReached",s_iLastLevel);saveItem("Scores",JSON.stringify(s_aScores))};this.resetScene=function(){h=t=!1;this.resetBallPosition();l.reset()};this._onEnd=function(){this.onExit()};this.swapChildrenIndex=
function(){for(var b=0;b<D.length-1;b++)for(var a=b+1;a<D.length;a++)this.sortDepth(D[b],D[a])};this.rotateGloves=function(){var b=(d.getX()-CANVAS_WIDTH_HALF)*HAND_KEEPER_ANGLE_RATE;d.setRotation(b)};this._updatePlay=function(){for(var e=0;e<PHYSICS_ACCURACY;e++)a.update();this._updateBall2DPosition();!t&&2!==a.isBallSleeping()&&a.getBodyVelocity(a.ballBody()).norm()<BALL_SPEED_FOR_RESET?this.timeReset():b.isVisible()&&0>a.ballBody().position.y&&(b.setVisible(!1),b.playAnim("start"),this.textMiss());
this.rotateGloves();this.swapChildrenIndex()};this.update=function(){switch(G){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};this._updateBall2DPosition=function(){p||(this.ballPosition(),b.rolls());H.updateProjectionMatrix();H.updateMatrixWorld()};s_oGame=this;BALL_TO_SAVED=m.ball_to_saved;BALL_FORCE_X=m.ball_force_left_right;BALL_FORCE_Z=m.ball_force_up;BALL_FORCE_Y=m.ball_force_velocity;MATCH_LAUNCH=m.max_launch;SCORE_BALL_CATCH=m.score_ball_catch;SCORE_MISS=m.score_miss;
BALL_SAVED_POINT=m.perfect_ball_saved_point;NUM_LEVEL_FOR_ADS=m.num_levels_for_ads;this._init()}var s_oGame;
function CInterface(){var m,c,f,g,a,d,b,l,k,e,h,p,n,q,t=null,r,y,u,x,w=null,z=null,A,C,D,G=null,H=null,J;this._init=function(){l=b=0;r=createBitmap(s_oSpriteLibrary.getSprite("gui_panel"));s_oStage.addChild(r);A=new createjs.Container;s_oStage.addChild(A);n=new CTLText(A,.5*CANVAS_WIDTH-160,30,200,64,32,"center","#ffffff",FONT_GAME,1,0,0,TEXT_SCORE_BALL+"\n0",!0,!0,!0,!1);q=new CTLText(A,.5*CANVAS_WIDTH-390,30,200,64,32,"center","#ffffff",FONT_GAME,1,0,0,TEXT_LAUNCH+"\n0",!0,!0,!0,!1);u=new CTLText(A,
20,30,200,64,32,"center","#ffffff",FONT_GAME,1,0,0,TEXT_MATCH+"\n0",!0,!0,!0,!1);x=new CTLText(s_oStage,.5*CANVAS_WIDTH-350,500,700,104,52,"center","#ffffff",FONT_GAME,1,0,0,TEXT_START_MSG,!0,!0,!0,!1);var t=s_oSpriteLibrary.getSprite("but_exit");f=CANVAS_WIDTH-t.height/2-10;g=t.height/2+10;h=new CGfxButton(f,g,t);h.addEventListener(ON_MOUSE_UP,this._onExit,this);t=s_oSpriteLibrary.getSprite("but_pause");m=f-t.height-10;c=g;p=new CGfxButton(m,c,t);p.addEventListener(ON_MOUSE_UP,this.onButPauseRelease,
this);!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(t=s_oSpriteLibrary.getSprite("audio_icon"),k=m-t.height-10,e=g,y=new CToggle(k,e,t,s_bAudioActive),y.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),t=s_oSpriteLibrary.getSprite("but_fullscreen"),a=k-t.width/2-10,d=e):(a=m-t.height-10,d=g);t=window.document;var J=t.documentElement;G=J.requestFullscreen||J.mozRequestFullScreen||J.webkitRequestFullScreen||J.msRequestFullscreen;H=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||
t.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(G=!1);G&&screenfull.enabled&&(t=s_oSpriteLibrary.getSprite("but_fullscreen"),D=new CToggle(a,d,t,s_bFullscreen,s_oStage),D.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(q,n){h.setPosition(f-q,n+g);p.setPosition(m-q,n+c);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||y.setPosition(k-q,n+e);G&&screenfull.enabled&&D.setPosition(a-s_iOffsetX,d+s_iOffsetY);r.y=l+n;A.y=l+
n;A.x=b+q};this.unload=function(){h.unload();h=null;this.onExitFromHelp();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)y.unload(),y=null;G&&screenfull.enabled&&D.unload();s_oInterface=null};this.showHelpText=function(b){x.setVisible(b)};this.refreshBallCatch=function(b,a){n.refreshText(TEXT_SCORE_BALL+"\n"+b+" "+TEXT_OF+" "+a)};this.refreshLaunch=function(b,a){q.refreshText(TEXT_LAUNCH+"\n"+b+" "+TEXT_OF+" "+a)};this.onExitFromHelp=function(){null!==t&&(t.unload(),t=null)};this.createLosePanel=function(b,
a){z=new CLosePanel(s_oSpriteLibrary.getSprite("msg_box"));z.show(b,a)};this.createWinPanel=function(b,a,e,d){w=new CWinPanel(s_oSpriteLibrary.getSprite("msg_box"),d);w.show(b,a,e)};this.createHelpPanel=function(){createjs.Ticker.paused=!1;t=new CHelpPanel(0,0,s_oSpriteLibrary.getSprite("msg_box"))};this.createAnimText=function(b,a,e){var d=new createjs.Container;(new CTLText(d,-320,a+"px "+FONT_GAME,640,80,80,"center","#000",FONT_GAME,1,0,0,b,!0,!0,!0,!1)).setOutline(3);var c=new CTLText(d,-320,
a+"px "+FONT_GAME,640,80,80,"center","#fff",FONT_GAME,1,0,0,b,!0,!0,!0,!1);d.x=CANVAS_WIDTH_HALF;d.y=-80;e&&s_oInterface.strobeText(c.getText());s_oStage.addChild(d);createjs.Tween.get(d).to({y:CANVAS_HEIGHT_HALF},500,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(d).wait(250).to({y:CANVAS_HEIGHT+80},500,createjs.Ease.cubicIn).call(function(){e&&createjs.Tween.removeTweens(c.getText());s_oStage.removeChild(d)})})};this.strobeText=function(b){createjs.Tween.get(b).wait(30).call(function(){J<
TEXT_EXCELLENT_COLOR.length-1?J++:J=0;b.color=TEXT_EXCELLENT_COLOR[J];s_oInterface.strobeText(b)})};this.refreshMatchNum=function(b){u.refreshText(TEXT_MATCH+"\n"+b)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){(new CAreYouSurePanel(s_oStage)).show()};this.unloadPause=function(){C.unload();C=null};this.onButPauseRelease=function(){C=new CPause};this.resetFullscreenBut=function(){G&&screenfull.enabled&&D.setActive(s_bFullscreen)};
this._onFullscreenRelease=function(){s_bFullscreen?H.call(window.document):G.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init();return this}var s_oInterface=null;
function CHelpPanel(m,c,f){var g,a,d,b,l,k,e=!1,h;this._init=function(e,c,q){d=new createjs.Container;d.x=e;d.y=c;s_oStage.addChild(d);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=.5;d.addChild(a);g=createBitmap(q);g.x=CANVAS_WIDTH_HALF;g.y=CANVAS_HEIGHT_HALF;g.regX=.5*q.width;g.regY=.5*q.height;d.addChild(g);new CTLText(d,CANVAS_WIDTH/2-350,.5*CANVAS_HEIGHT-240,700,50,50,"center",TEXT_COLOR,FONT_GAME,1,0,0,TEXT_HOW_TO_PLAY,!0,!0,!1,!1);k=new createjs.Container;
e=s_oSpriteLibrary.getSprite("gloves");l=new CGloves(CANVAS_WIDTH_HALF,306,e,null,k);l.changeState("perfect");s_bMobile?(e=TEXT_HELP1_MOBILE,c="help_touch"):(e=TEXT_HELP1_PC,c="help_mouse");c=s_oSpriteLibrary.getSprite(c);h=createBitmap(c);h.x=CANVAS_WIDTH_HALF+6;h.y=320;h.regX=.5*c.width;h.regY=.5*c.height;k.addChild(h);d.addChild(k);this.animGloves();new CTLText(d,CANVAS_WIDTH/2-350,.5*CANVAS_HEIGHT+34,700,64,32,"center",TEXT_COLOR,FONT_GAME,1,0,0,e,!0,!0,!0,!1);e=s_oSpriteLibrary.getSprite("but_continue");
b=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT_HALF+180,e,d);b.addEventListener(ON_MOUSE_UP,this._onExitHelp,this);b.pulseAnimation();var n=this;d.on("pressup",function(){n._onExitHelp()})};this.animGloves=function(){var b=this;createjs.Tween.get(k).to({x:100},1E3,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(k).to({x:-100},1E3,createjs.Ease.cubicInOut).call(function(){b.animGloves()})})};this.unload=function(){createjs.Tween.get(d).to({alpha:0},500,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(d)});
var b=this;createjs.Tween.removeTweens(k);d.off("pressup",function(){b._onExitHelp()})};this._onExitHelp=function(){e||(e=!0,this.unload(),s_oGame.onExitHelp())};this._init(m,c,f)}
!function(m){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=m();else{var c;"undefined"!=typeof window?c=window:"undefined"!=typeof global?c=global:"undefined"!=typeof self&&(c=self);c.CANNON=m()}}(function(){return function a(c,f,g){function d(k,e){if(!f[k]){if(!c[k]){var h="function"==typeof require&&require;if(!e&&h)return h(k,!0);if(b)return b(k,!0);throw Error("Cannot find module '"+k+"'");}h=f[k]={exports:{}};c[k][0].call(h.exports,function(b){var a=c[k][1][b];return d(a?
a:b)},h,h.exports,a,c,f,g)}return f[k].exports}for(var b="function"==typeof require&&require,l=0;l<g.length;l++)d(g[l]);return d}({1:[function(c,f,g){f.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(c,f,g){f.exports={version:c("../package.json").version,AABB:c("./collision/AABB"),ArrayCollisionMatrix:c("./collision/ArrayCollisionMatrix"),
Body:c("./objects/Body"),Box:c("./shapes/Box"),Broadphase:c("./collision/Broadphase"),Constraint:c("./constraints/Constraint"),ContactEquation:c("./equations/ContactEquation"),Narrowphase:c("./world/Narrowphase"),ConeTwistConstraint:c("./constraints/ConeTwistConstraint"),ContactMaterial:c("./material/ContactMaterial"),ConvexPolyhedron:c("./shapes/ConvexPolyhedron"),Cylinder:c("./shapes/Cylinder"),DistanceConstraint:c("./constraints/DistanceConstraint"),Equation:c("./equations/Equation"),EventTarget:c("./utils/EventTarget"),
FrictionEquation:c("./equations/FrictionEquation"),GSSolver:c("./solver/GSSolver"),GridBroadphase:c("./collision/GridBroadphase"),Heightfield:c("./shapes/Heightfield"),HingeConstraint:c("./constraints/HingeConstraint"),LockConstraint:c("./constraints/LockConstraint"),Mat3:c("./math/Mat3"),Material:c("./material/Material"),NaiveBroadphase:c("./collision/NaiveBroadphase"),ObjectCollisionMatrix:c("./collision/ObjectCollisionMatrix"),Pool:c("./utils/Pool"),Particle:c("./shapes/Particle"),Plane:c("./shapes/Plane"),
PointToPointConstraint:c("./constraints/PointToPointConstraint"),Quaternion:c("./math/Quaternion"),Ray:c("./collision/Ray"),RaycastVehicle:c("./objects/RaycastVehicle"),RaycastResult:c("./collision/RaycastResult"),RigidVehicle:c("./objects/RigidVehicle"),RotationalEquation:c("./equations/RotationalEquation"),RotationalMotorEquation:c("./equations/RotationalMotorEquation"),SAPBroadphase:c("./collision/SAPBroadphase"),SPHSystem:c("./objects/SPHSystem"),Shape:c("./shapes/Shape"),Solver:c("./solver/Solver"),
Sphere:c("./shapes/Sphere"),SplitSolver:c("./solver/SplitSolver"),Spring:c("./objects/Spring"),Trimesh:c("./shapes/Trimesh"),Vec3:c("./math/Vec3"),Vec3Pool:c("./utils/Vec3Pool"),World:c("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(c,f,g){function a(b){b=b||{};
this.lowerBound=new d;b.lowerBound&&this.lowerBound.copy(b.lowerBound);this.upperBound=new d;b.upperBound&&this.upperBound.copy(b.upperBound)}var d=c("../math/Vec3");c("../utils/Utils");f.exports=a;var b=new d;a.prototype.setFromPoints=function(a,e,d,c){var h=this.lowerBound,k=this.upperBound;h.copy(a[0]);d&&d.vmult(h,h);k.copy(h);for(var l=1;l<a.length;l++){var p=a[l];d&&(d.vmult(p,b),p=b);p.x>k.x&&(k.x=p.x);p.x<h.x&&(h.x=p.x);p.y>k.y&&(k.y=p.y);p.y<h.y&&(h.y=p.y);p.z>k.z&&(k.z=p.z);p.z<h.z&&(h.z=
p.z)}e&&(e.vadd(h,h),e.vadd(k,k));c&&(h.x-=c,h.y-=c,h.z-=c,k.x+=c,k.y+=c,k.z+=c);return this};a.prototype.copy=function(b){this.lowerBound.copy(b.lowerBound);this.upperBound.copy(b.upperBound);return this};a.prototype.clone=function(){return(new a).copy(this)};a.prototype.extend=function(b){var a=b.lowerBound.x;this.lowerBound.x>a&&(this.lowerBound.x=a);a=b.upperBound.x;this.upperBound.x<a&&(this.upperBound.x=a);a=b.lowerBound.y;this.lowerBound.y>a&&(this.lowerBound.y=a);a=b.upperBound.y;this.upperBound.y<
a&&(this.upperBound.y=a);a=b.lowerBound.z;this.lowerBound.z>a&&(this.lowerBound.z=a);a=b.upperBound.z;this.upperBound.z<a&&(this.upperBound.z=a)};a.prototype.overlaps=function(b){var a=this.lowerBound,d=this.upperBound,c=b.lowerBound;b=b.upperBound;return(c.x<=d.x&&d.x<=b.x||a.x<=b.x&&b.x<=d.x)&&(c.y<=d.y&&d.y<=b.y||a.y<=b.y&&b.y<=d.y)&&(c.z<=d.z&&d.z<=b.z||a.z<=b.z&&b.z<=d.z)};a.prototype.contains=function(b){var a=this.lowerBound,d=this.upperBound,c=b.lowerBound;b=b.upperBound;return a.x<=c.x&&
d.x>=b.x&&a.y<=c.y&&d.y>=b.y&&a.z<=c.z&&d.z>=b.z};a.prototype.getCorners=function(b,a,d,c,l,q,f,r){var e=this.lowerBound,h=this.upperBound;b.copy(e);a.set(h.x,e.y,e.z);d.set(h.x,h.y,e.z);c.set(e.x,h.y,h.z);l.set(h.x,e.y,e.z);q.set(e.x,h.y,e.z);f.set(e.x,e.y,h.z);r.copy(h)};var l=[new d,new d,new d,new d,new d,new d,new d,new d];a.prototype.toLocalFrame=function(b,a){this.getCorners(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);for(var e=0;8!==e;e++){var d=l[e];b.pointToLocal(d,d)}return a.setFromPoints(l)};
a.prototype.toWorldFrame=function(b,a){this.getCorners(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);for(var e=0;8!==e;e++){var d=l[e];b.pointToWorld(d,d)}return a.setFromPoints(l)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(c,f,g){function a(){this.matrix=[]}f.exports=a;a.prototype.get=function(a,b){a=a.index;b=b.index;if(b>a){var d=b;b=a;a=d}return this.matrix[(a*(a+1)>>1)+b-1]};a.prototype.set=function(a,b,c){a=a.index;b=b.index;if(b>a){var d=b;b=a;a=d}this.matrix[(a*(a+1)>>1)+b-1]=c?1:0};
a.prototype.reset=function(){for(var a=0,b=this.matrix.length;a!==b;a++)this.matrix[a]=0};a.prototype.setNumObjects=function(a){this.matrix.length=a*(a-1)>>1}},{}],5:[function(c,f,g){function a(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var d=c("../objects/Body");g=c("../math/Vec3");var b=c("../math/Quaternion");c("../shapes/Shape");c("../shapes/Plane");f.exports=a;a.prototype.collisionPairs=function(b,a,e){throw Error("collisionPairs not implemented for this BroadPhase class!");};var l=
d.STATIC|d.KINEMATIC;a.prototype.needBroadphaseCollision=function(b,a){return 0!==(b.collisionFilterGroup&a.collisionFilterMask)&&0!==(a.collisionFilterGroup&b.collisionFilterMask)&&(0===(b.type&l)&&b.sleepState!==d.SLEEPING||0===(a.type&l)&&a.sleepState!==d.SLEEPING)?!0:!1};a.prototype.intersectionTest=function(b,a,e,d){this.useBoundingBoxes?this.doBoundingBoxBroadphase(b,a,e,d):this.doBoundingSphereBroadphase(b,a,e,d)};var k=new g;new g;new b;new g;a.prototype.doBoundingSphereBroadphase=function(b,
a,e,d){a.position.vsub(b.position,k);var c=Math.pow(b.boundingRadius+a.boundingRadius,2);k.norm2()<c&&(e.push(b),d.push(a))};a.prototype.doBoundingBoxBroadphase=function(b,a,e,d){b.aabbNeedsUpdate&&b.computeAABB();a.aabbNeedsUpdate&&a.computeAABB();b.aabb.overlaps(a.aabb)&&(e.push(b),d.push(a))};var e={keys:[]},h=[],p=[];a.prototype.makePairsUnique=function(b,a){for(var d=b.length,c=0;c!==d;c++)h[c]=b[c],p[c]=a[c];b.length=0;for(c=a.length=0;c!==d;c++){var k=h[c].id,l=p[c].id;k=k<l?k+","+l:l+","+
k;e[k]=c;e.keys.push(k)}for(c=0;c!==e.keys.length;c++)k=e.keys.pop(),d=e[k],b.push(h[d]),a.push(p[d]),delete e[k]};a.prototype.setWorld=function(b){};var n=new g;a.boundingSphereCheck=function(b,a){b.position.vsub(a.position,n);return Math.pow(b.shape.boundingSphereRadius+a.shape.boundingSphereRadius,2)>n.norm2()};a.prototype.aabbQuery=function(b,a,e){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(c,f,g){function a(a,c,k,l,q){d.apply(this);this.nx=k||10;this.ny=l||10;this.nz=q||10;this.aabbMin=a||new b(100,100,100);this.aabbMax=c||new b(-100,-100,-100);a=this.nx*this.ny*this.nz;if(0>=a)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=a;this.binLengths.length=a;for(c=0;c<a;c++)this.bins[c]=[],this.binLengths[c]=0}f.exports=a;var d=c("./Broadphase"),b=c("../math/Vec3"),l=c("../shapes/Shape");
a.prototype=new d;a.prototype.constructor=a;var k=new b;new b;a.prototype.collisionPairs=function(b,a,d){function e(b,a,e,d,c,h,k){b=(b-G)*L|0;a=(a-H)*O|0;e=(e-J)*U|0;d=I((d-G)*L);c=I((c-H)*O);h=I((h-J)*U);0>b?b=0:b>=f&&(b=f-1);0>a?a=0:a>=g&&(a=g-1);0>e?e=0:e>=x&&(e=x-1);0>d?d=0:d>=f&&(d=f-1);0>c?c=0:c>=g&&(c=g-1);0>h?h=0:h>=x&&(h=x-1);b*=w;a*=z;e*=1;d*=w;c*=z;for(h*=1;b<=d;b+=w)for(var l=a;l<=c;l+=z)for(var p=e;p<=h;p+=1){var n=b+l+p;R[n][v[n]++]=k}}var c=b.numObjects();b=b.bodies;var h=this.aabbMax,
p=this.aabbMin,f=this.nx,g=this.ny,x=this.nz,w=g*x,z=x,A=h.x,C=h.y,D=h.z,G=p.x,H=p.y,J=p.z,L=f/(A-G),O=g/(C-H),U=x/(D-J);A=(A-G)/f;var M=(C-H)/g;D=(D-J)/x;var Q=.5*Math.sqrt(A*A+M*M+D*D);C=l.types;var K=C.SPHERE,E=C.PLANE,R=this.bins,v=this.binLengths;C=this.bins.length;for(p=0;p!==C;p++)v[p]=0;var I=Math.ceil;p=Math.min;h=Math.max;for(p=0;p!==c;p++){h=b[p];var V=h.shape;switch(V.type){case K:var S=h.position.x,N=h.position.y,B=h.position.z;V=V.radius;e(S-V,N-V,B-V,S+V,N+V,B+V,h);break;case E:V.worldNormalNeedsUpdate&&
V.computeWorldNormal(h.quaternion);B=V.worldNormal;V=H+.5*M-h.position.y;var P=J+.5*D-h.position.z,T=k;T.set(G+.5*A-h.position.x,V,P);for(var F=S=0;S!==f;S++,F+=w,T.y=V,T.x+=A)for(var W=N=0;N!==g;N++,W+=z,T.z=P,T.y+=M)for(var Y=0,X=0;Y!==x;Y++,X+=1,T.z+=D)if(T.dot(B)<Q){var aa=F+W+X;R[aa][v[aa]++]=h}break;default:h.aabbNeedsUpdate&&h.computeAABB(),e(h.aabb.lowerBound.x,h.aabb.lowerBound.y,h.aabb.lowerBound.z,h.aabb.upperBound.x,h.aabb.upperBound.y,h.aabb.upperBound.z,h)}}for(p=0;p!==C;p++)if(c=v[p],
1<c)for(b=R[p],S=0;S!==c;S++)for(h=b[S],N=0;N!==S;N++)A=b[N],this.needBroadphaseCollision(h,A)&&this.intersectionTest(h,A,a,d);this.makePairsUnique(a,d)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(c,f,g){function a(){d.apply(this)}f.exports=a;var d=c("./Broadphase");c=c("./AABB");a.prototype=new d;a.prototype.constructor=a;a.prototype.collisionPairs=function(b,a,d){b=b.bodies;var e=b.length,c,k;for(c=0;c!==e;c++)for(k=0;k!==c;k++){var l=b[c];var q=b[k];this.needBroadphaseCollision(l,
q)&&this.intersectionTest(l,q,a,d)}};new c;a.prototype.aabbQuery=function(b,a,d){d=d||[];for(var e=0;e<b.bodies.length;e++){var c=b.bodies[e];c.aabbNeedsUpdate&&c.computeAABB();c.aabb.overlaps(a)&&d.push(c)}return d}},{"./AABB":3,"./Broadphase":5}],8:[function(c,f,g){function a(){this.matrix={}}f.exports=a;a.prototype.get=function(a,b){a=a.id;b=b.id;if(b>a){var d=b;b=a;a=d}return a+"-"+b in this.matrix};a.prototype.set=function(a,b,c){a=a.id;b=b.id;if(b>a){var d=b;b=a;a=d}c?this.matrix[a+"-"+b]=!0:
delete this.matrix[a+"-"+b]};a.prototype.reset=function(){this.matrix={}};a.prototype.setNumObjects=function(a){}},{}],9:[function(c,f,g){function a(e,d){this.from=e?e.clone():new b;this.to=d?d.clone():new b;this._direction=new b;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=a.ANY;this.result=new k;this.hasHit=!1;this.callback=function(b){}}function d(b,a,e,d){d.vsub(a,K);e.vsub(a,p);b.vsub(a,n);b=K.dot(K);
a=K.dot(p);e=K.dot(n);d=p.dot(p);var c=p.dot(n),h,k;return 0<=(h=d*e-a*c)&&0<=(k=b*c-a*e)&&h+k<b*d-a*a}f.exports=a;var b=c("../math/Vec3");f=c("../math/Quaternion");var l=c("../math/Transform");c("../shapes/ConvexPolyhedron");c("../shapes/Box");var k=c("../collision/RaycastResult");g=c("../shapes/Shape");c=c("../collision/AABB");a.prototype.constructor=a;a.CLOSEST=1;a.ANY=2;a.ALL=4;var e=new c,h=[];a.prototype.intersectWorld=function(b,d){this.mode=d.mode||a.ANY;this.result=d.result||new k;this.skipBackfaces=
!!d.skipBackfaces;this.collisionFilterMask="undefined"!==typeof d.collisionFilterMask?d.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof d.collisionFilterGroup?d.collisionFilterGroup:-1;d.from&&this.from.copy(d.from);d.to&&this.to.copy(d.to);this.callback=d.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(e);h.length=0;b.broadphase.aabbQuery(b,e,h);this.intersectBodies(h);return this.hasHit};var p=new b,n=new b;a.pointInTriangle=d;
var q=new b,t=new f;a.prototype.intersectBody=function(b,a){a&&(this.result=a,this._updateDirection());var e=this.checkCollisionResponse;if((!e||b.collisionResponse)&&0!==(this.collisionFilterGroup&b.collisionFilterMask)&&0!==(b.collisionFilterGroup&this.collisionFilterMask))for(var d=0,c=b.shapes.length;d<c;d++){var h=b.shapes[d];if(!e||h.collisionResponse)if(b.quaternion.mult(b.shapeOrientations[d],t),b.quaternion.vmult(b.shapeOffsets[d],q),q.vadd(b.position,q),this.intersectShape(h,t,q,b),this.result._shouldStop)break}};
a.prototype.intersectBodies=function(b,a){a&&(this.result=a,this._updateDirection());for(var e=0,d=b.length;!this.result._shouldStop&&e<d;e++)this.intersectBody(b[e])};a.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};a.prototype.intersectShape=function(b,a,e,d){var c=this.from,h=this._direction;e.vsub(c,K);var k=K.dot(h);h.mult(k,E);E.vadd(c,E);e.distanceTo(E)>b.boundingSphereRadius||(c=this[b.type])&&c.call(this,b,a,e,d)};new b;new b;var r=
new b,y=new b,u=new b,x=new b;new b;new k;a.prototype.intersectBox=function(b,a,e,d){return this.intersectConvex(b.convexPolyhedronRepresentation,a,e,d)};a.prototype[g.types.BOX]=a.prototype.intersectBox;a.prototype.intersectPlane=function(a,e,d,c){var h=this.from,k=this.to,l=this._direction,p=new b(0,0,1);e.vmult(p,p);var n=new b;h.vsub(d,n);e=n.dot(p);k.vsub(d,n);n=n.dot(p);if(!(0<e*n||h.distanceTo(k)<e||(n=p.dot(l),Math.abs(n)<this.precision))){var q=new b;k=new b;e=new b;h.vsub(d,q);d=-p.dot(q)/
n;l.scale(d,k);h.vadd(k,e);this.reportIntersection(p,e,a,c,-1)}};a.prototype[g.types.PLANE]=a.prototype.intersectPlane;a.prototype.getAABB=function(b){var a=this.to,e=this.from;b.lowerBound.x=Math.min(a.x,e.x);b.lowerBound.y=Math.min(a.y,e.y);b.lowerBound.z=Math.min(a.z,e.z);b.upperBound.x=Math.max(a.x,e.x);b.upperBound.y=Math.max(a.y,e.y);b.upperBound.z=Math.max(a.z,e.z)};var w={faceList:[0]};a.prototype.intersectHeightfield=function(e,d,c,h){var k=new b,p=new a(this.from,this.to);l.pointToLocalFrame(c,
d,p.from,p.from);l.pointToLocalFrame(c,d,p.to,p.to);var n=[],q=null,f=null,g=null,r=null,t=e.getIndexOfPosition(p.from.x,p.from.y,n,!1);t&&(q=n[0],f=n[1],g=n[0],r=n[1]);if(t=e.getIndexOfPosition(p.to.x,p.to.y,n,!1)){if(null===q||n[0]<q)q=n[0];if(null===g||n[0]>g)g=n[0];if(null===f||n[1]<f)f=n[1];if(null===r||n[1]>r)r=n[1]}if(null!==q)for(e.getRectMinMax(q,f,g,r,[]),p=q;p<=g;p++)for(n=f;n<=r;n++){if(this.result._shouldStop)return;e.getConvexTrianglePillar(p,n,!1);l.pointToWorldFrame(c,d,e.pillarOffset,
k);this.intersectConvex(e.pillarConvex,d,k,h,w);if(this.result._shouldStop)return;e.getConvexTrianglePillar(p,n,!0);l.pointToWorldFrame(c,d,e.pillarOffset,k);this.intersectConvex(e.pillarConvex,d,k,h,w)}};a.prototype[g.types.HEIGHTFIELD]=a.prototype.intersectHeightfield;var z=new b,A=new b;a.prototype.intersectSphere=function(b,a,e,d){a=this.from;var c=this.to,h=Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2)+Math.pow(c.z-a.z,2),k=2*((c.x-a.x)*(a.x-e.x)+(c.y-a.y)*(a.y-e.y)+(c.z-a.z)*(a.z-e.z)),p=Math.pow(k,
2)-4*h*(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2)+Math.pow(a.z-e.z,2)-Math.pow(b.radius,2));if(!(0>p))if(0===p)a.lerp(c,p,z),z.vsub(e,A),A.normalize(),this.reportIntersection(A,z,b,d,-1);else{var n=(-k-Math.sqrt(p))/(2*h);h=(-k+Math.sqrt(p))/(2*h);0<=n&&1>=n&&(a.lerp(c,n,z),z.vsub(e,A),A.normalize(),this.reportIntersection(A,z,b,d,-1));!this.result._shouldStop&&0<=h&&1>=h&&(a.lerp(c,h,z),z.vsub(e,A),A.normalize(),this.reportIntersection(A,z,b,d,-1))}};a.prototype[g.types.SPHERE]=a.prototype.intersectSphere;
var C=new b;new b;new b;var D=new b;a.prototype.intersectConvex=function(b,a,e,c,h){h=h&&h.faceList||null;for(var k=b.faces,p=b.vertices,n=b.faceNormals,l=this._direction,q=this.from,f=q.distanceTo(this.to),g=h?h.length:k.length,t=this.result,v=0;!t._shouldStop&&v<g;v++){var E=h?h[v]:v,I=k[E],J=n[E],H=a,R=e;D.copy(p[I[0]]);H.vmult(D,D);D.vadd(R,D);D.vsub(q,D);H.vmult(J,C);J=l.dot(C);if(!(Math.abs(J)<this.precision||(J=C.dot(D)/J,0>J)))for(l.mult(J,r),r.vadd(q,r),y.copy(p[I[0]]),H.vmult(y,y),R.vadd(y,
y),J=1;!t._shouldStop&&J<I.length-1;J++){u.copy(p[I[J]]);x.copy(p[I[J+1]]);H.vmult(u,u);H.vmult(x,x);R.vadd(u,u);R.vadd(x,x);var w=r.distanceTo(q);!d(r,y,u,x)&&!d(r,u,y,x)||w>f||this.reportIntersection(C,r,b,c,E)}}};a.prototype[g.types.CONVEXPOLYHEDRON]=a.prototype.intersectConvex;var G=new b,H=new b,J=new b,L=new b,O=new b,U=new b;new c;var M=[],Q=new l;a.prototype.intersectTrimesh=function(b,a,e,c,h){h=b.indices;var k=this.from,p=this.to,n=this._direction;Q.position.copy(e);Q.quaternion.copy(a);
l.vectorToLocalFrame(e,a,n,H);l.pointToLocalFrame(e,a,k,J);l.pointToLocalFrame(e,a,p,L);k=J.distanceSquared(L);b.tree.rayQuery(this,Q,M);p=0;for(n=M.length;!this.result._shouldStop&&p!==n;p++){var q=M[p];b.getNormal(q,G);b.getVertex(h[3*q],y);y.vsub(J,D);var f=H.dot(G);f=G.dot(D)/f;0>f||(H.scale(f,r),r.vadd(J,r),b.getVertex(h[3*q+1],u),b.getVertex(h[3*q+2],x),f=r.distanceSquared(J),!d(r,u,y,x)&&!d(r,y,u,x)||f>k||(l.vectorToWorldFrame(a,G,O),l.pointToWorldFrame(e,a,r,U),this.reportIntersection(O,U,
b,c,q)))}M.length=0};a.prototype[g.types.TRIMESH]=a.prototype.intersectTrimesh;a.prototype.reportIntersection=function(b,e,d,c,h){var k=this.from,p=this.to,n=k.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&0<b.dot(this._direction)))switch(l.hitFaceIndex="undefined"!==typeof h?h:-1,this.mode){case a.ALL:this.hasHit=!0;l.set(k,p,b,e,d,c,n);l.hasHit=!0;this.callback(l);break;case a.CLOSEST:if(n<l.distance||!l.hasHit)this.hasHit=!0,l.hasHit=!0,l.set(k,p,b,e,d,c,n);break;case a.ANY:this.hasHit=
!0,l.hasHit=!0,l.set(k,p,b,e,d,c,n),l._shouldStop=!0}};var K=new b,E=new b},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(c,f,g){function a(){this.rayFromWorld=new d;this.rayToWorld=new d;this.hitNormalWorld=new d;this.hitPointWorld=new d;this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var d=
c("../math/Vec3");f.exports=a;a.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};a.prototype.abort=function(){this._shouldStop=!0};a.prototype.set=function(b,a,d,e,c,p,n){this.rayFromWorld.copy(b);this.rayToWorld.copy(a);this.hitNormalWorld.copy(d);this.hitPointWorld.copy(e);this.shape=c;this.body=p;this.distance=
n}},{"../math/Vec3":30}],11:[function(c,f,g){function a(b){d.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var a=this.axisList;this._addBodyHandler=function(b){a.push(b.body)};this._removeBodyHandler=function(b){b=a.indexOf(b.body);-1!==b&&a.splice(b,1)};b&&this.setWorld(b)}c("../shapes/Shape");var d=c("../collision/Broadphase");f.exports=a;a.prototype=new d;a.prototype.setWorld=function(b){for(var a=this.axisList.length=0;a<b.bodies.length;a++)this.axisList.push(b.bodies[a]);b.removeEventListener("addBody",
this._addBodyHandler);b.removeEventListener("removeBody",this._removeBodyHandler);b.addEventListener("addBody",this._addBodyHandler);b.addEventListener("removeBody",this._removeBodyHandler);this.world=b;this.dirty=!0};a.insertionSortX=function(b){for(var a=1,d=b.length;a<d;a++){for(var e=b[a],c=a-1;0<=c&&!(b[c].aabb.lowerBound.x<=e.aabb.lowerBound.x);c--)b[c+1]=b[c];b[c+1]=e}return b};a.insertionSortY=function(b){for(var a=1,d=b.length;a<d;a++){for(var e=b[a],c=a-1;0<=c&&!(b[c].aabb.lowerBound.y<=
e.aabb.lowerBound.y);c--)b[c+1]=b[c];b[c+1]=e}return b};a.insertionSortZ=function(b){for(var a=1,d=b.length;a<d;a++){for(var e=b[a],c=a-1;0<=c&&!(b[c].aabb.lowerBound.z<=e.aabb.lowerBound.z);c--)b[c+1]=b[c];b[c+1]=e}return b};a.prototype.collisionPairs=function(b,d,c){b=this.axisList;var e=b.length,h=this.axisIndex,p,k;this.dirty&&(this.sortList(),this.dirty=!1);for(p=0;p!==e;p++){var l=b[p];for(k=p+1;k<e;k++){var f=b[k];if(this.needBroadphaseCollision(l,f)){if(!a.checkBounds(l,f,h))break;this.intersectionTest(l,
f,d,c)}}}};a.prototype.sortList=function(){for(var b=this.axisList,d=this.axisIndex,c=b.length,e=0;e!==c;e++){var h=b[e];h.aabbNeedsUpdate&&h.computeAABB()}0===d?a.insertionSortX(b):1===d?a.insertionSortY(b):2===d&&a.insertionSortZ(b)};a.checkBounds=function(b,a,d){if(0===d){var e=b.position.x;var c=a.position.x}else 1===d?(e=b.position.y,c=a.position.y):2===d&&(e=b.position.z,c=a.position.z);return c-a.boundingRadius<e+b.boundingRadius};a.prototype.autoDetectAxis=function(){for(var b=0,a=0,d=0,e=
0,c=0,p=0,n=this.axisList,q=n.length,f=1/q,g=0;g!==q;g++){var y=n[g],u=y.position.x;b+=u;a+=u*u;u=y.position.y;d+=u;e+=u*u;y=y.position.z;c+=y;p+=y*y}b=a-b*b*f;d=e-d*d*f;c=p-c*c*f;this.axisIndex=b>d?b>c?0:2:d>c?1:2};a.prototype.aabbQuery=function(b,a,d){d=d||[];this.dirty&&(this.sortList(),this.dirty=!1);b=this.axisList;for(var e=0;e<b.length;e++){var c=b[e];c.aabbNeedsUpdate&&c.computeAABB();c.aabb.overlaps(a)&&d.push(c)}return d}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(c,
f,g){function a(a,c,p){p=p||{};var e="undefined"!==typeof p.maxForce?p.maxForce:1E6,h=p.pivotA?p.pivotA.clone():new k,f=p.pivotB?p.pivotB.clone():new k;this.axisA=p.axisA?p.axisA.clone():new k;this.axisB=p.axisB?p.axisB.clone():new k;d.call(this,a,h,c,f,e);this.collideConnected=!!p.collideConnected;this.angle="undefined"!==typeof p.angle?p.angle:0;h=this.coneEquation=new b(a,c,p);a=this.twistEquation=new l(a,c,p);this.twistAngle="undefined"!==typeof p.twistAngle?p.twistAngle:0;h.maxForce=0;h.minForce=
-e;a.maxForce=0;a.minForce=-e;this.equations.push(h,a)}f.exports=a;c("./Constraint");var d=c("./PointToPointConstraint"),b=c("../equations/ConeEquation"),l=c("../equations/RotationalEquation");c("../equations/ContactEquation");var k=c("../math/Vec3");a.prototype=new d;a.constructor=a;new k;new k;a.prototype.update=function(){var b=this.bodyA,a=this.bodyB,c=this.coneEquation,k=this.twistEquation;d.prototype.update.call(this);b.vectorToWorldFrame(this.axisA,c.axisA);a.vectorToWorldFrame(this.axisB,
c.axisB);this.axisA.tangents(k.axisA,k.axisA);b.vectorToWorldFrame(k.axisA,k.axisA);this.axisB.tangents(k.axisB,k.axisB);a.vectorToWorldFrame(k.axisB,k.axisB);c.angle=this.angle;k.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(c,f,g){function a(b,c,k){k=d.defaults(k,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=b;
this.bodyB=c;this.id=a.idCounter++;this.collideConnected=k.collideConnected;k.wakeUpBodies&&(b&&b.wakeUp(),c&&c.wakeUp())}f.exports=a;var d=c("../utils/Utils");a.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};a.prototype.enable=function(){for(var b=this.equations,a=0;a<b.length;a++)b[a].enabled=!0};a.prototype.disable=function(){for(var b=this.equations,a=0;a<b.length;a++)b[a].enabled=!1};a.idCounter=0},{"../utils/Utils":53}],14:[function(c,
f,g){function a(a,c,e,h){d.call(this,a,c);"undefined"===typeof e&&(e=a.position.distanceTo(c.position));"undefined"===typeof h&&(h=1E6);this.distance=e;a=this.distanceEquation=new b(a,c);this.equations.push(a);a.minForce=-h;a.maxForce=h}f.exports=a;var d=c("./Constraint"),b=c("../equations/ContactEquation");a.prototype=new d;a.prototype.update=function(){var b=this.distanceEquation,a=.5*this.distance,e=b.ni;this.bodyB.position.vsub(this.bodyA.position,e);e.normalize();e.mult(a,b.ri);e.mult(-a,b.rj)}},
{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(c,f,g){function a(a,e,c){c=c||{};var h="undefined"!==typeof c.maxForce?c.maxForce:1E6,p=c.pivotA?c.pivotA.clone():new k,n=c.pivotB?c.pivotB.clone():new k;d.call(this,a,p,e,n,h);(this.axisA=c.axisA?c.axisA.clone():new k(1,0,0)).normalize();(this.axisB=c.axisB?c.axisB.clone():new k(1,0,0)).normalize();p=this.rotationalEquation1=new b(a,e,c);c=this.rotationalEquation2=new b(a,e,c);a=this.motorEquation=new l(a,e,h);a.enabled=!1;this.equations.push(p,
c,a)}f.exports=a;c("./Constraint");var d=c("./PointToPointConstraint"),b=c("../equations/RotationalEquation"),l=c("../equations/RotationalMotorEquation");c("../equations/ContactEquation");var k=c("../math/Vec3");a.prototype=new d;a.constructor=a;a.prototype.enableMotor=function(){this.motorEquation.enabled=!0};a.prototype.disableMotor=function(){this.motorEquation.enabled=!1};a.prototype.setMotorSpeed=function(b){this.motorEquation.targetVelocity=b};a.prototype.setMotorMaxForce=function(b){this.motorEquation.maxForce=
b;this.motorEquation.minForce=-b};var e=new k,h=new k;a.prototype.update=function(){var b=this.bodyA,a=this.bodyB,c=this.motorEquation,k=this.rotationalEquation1,f=this.rotationalEquation2,l=this.axisA,g=this.axisB;d.prototype.update.call(this);b.quaternion.vmult(l,e);a.quaternion.vmult(g,h);e.tangents(k.axisA,f.axisA);k.axisB.copy(h);f.axisB.copy(h);this.motorEquation.enabled&&(b.quaternion.vmult(this.axisA,c.axisA),a.quaternion.vmult(this.axisB,c.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,
"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(c,f,g){function a(a,e,c){c=c||{};var h="undefined"!==typeof c.maxForce?c.maxForce:1E6,k=new l,f=new l,g=new l;a.position.vadd(e.position,g);g.scale(.5,g);e.pointToLocalFrame(g,f);a.pointToLocalFrame(g,k);d.call(this,a,k,e,f,h);h=this.rotationalEquation1=new b(a,e,c);k=this.rotationalEquation2=new b(a,e,c);a=this.rotationalEquation3=new b(a,e,c);this.equations.push(h,k,a)}f.exports=
a;c("./Constraint");var d=c("./PointToPointConstraint"),b=c("../equations/RotationalEquation");c("../equations/RotationalMotorEquation");c("../equations/ContactEquation");var l=c("../math/Vec3");a.prototype=new d;a.constructor=a;new l;new l;a.prototype.update=function(){var b=this.bodyA,a=this.bodyB,c=this.rotationalEquation1,p=this.rotationalEquation2,n=this.rotationalEquation3;d.prototype.update.call(this);b.vectorToWorldFrame(l.UNIT_X,c.axisA);a.vectorToWorldFrame(l.UNIT_Y,c.axisB);b.vectorToWorldFrame(l.UNIT_Y,
p.axisA);a.vectorToWorldFrame(l.UNIT_Z,p.axisB);b.vectorToWorldFrame(l.UNIT_Z,n.axisA);a.vectorToWorldFrame(l.UNIT_X,n.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(c,f,g){function a(a,c,h,p,n){d.call(this,a,h);n="undefined"!==typeof n?n:1E6;this.pivotA=c?c.clone():new l;this.pivotB=p?p.clone():new l;c=this.equationX=new b(a,h);p=this.equationY=
new b(a,h);a=this.equationZ=new b(a,h);this.equations.push(c,p,a);c.minForce=p.minForce=a.minForce=-n;c.maxForce=p.maxForce=a.maxForce=n;c.ni.set(1,0,0);p.ni.set(0,1,0);a.ni.set(0,0,1)}f.exports=a;var d=c("./Constraint"),b=c("../equations/ContactEquation"),l=c("../math/Vec3");a.prototype=new d;a.prototype.update=function(){var b=this.bodyB,a=this.equationX,c=this.equationY,d=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,a.ri);b.quaternion.vmult(this.pivotB,a.rj);c.ri.copy(a.ri);c.rj.copy(a.rj);
d.ri.copy(a.ri);d.rj.copy(a.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(c,f,g){function a(a,c,p){p=p||{};var e="undefined"!==typeof p.maxForce?p.maxForce:1E6;b.call(this,a,c,-e,e);this.axisA=p.axisA?p.axisA.clone():new d(1,0,0);this.axisB=p.axisB?p.axisB.clone():new d(0,1,0);this.angle="undefined"!==typeof p.angle?p.angle:0}f.exports=a;var d=c("../math/Vec3");c("../math/Mat3");var b=c("./Equation");a.prototype=new b;a.prototype.constructor=a;var l=new d,
k=new d;a.prototype.computeB=function(b){var a=this.a,c=this.b,d=this.axisA,e=this.axisB,f=this.jacobianElementA,g=this.jacobianElementB;d.cross(e,l);e.cross(d,k);f.rotational.copy(k);g.rotational.copy(l);d=Math.cos(this.angle)-d.dot(e);e=this.computeGW();f=this.computeGiMf();return-d*a-e*c-b*f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(c,f,g){function a(a,c,e){d.call(this,a,c,0,"undefined"!==typeof e?e:1E6);this.restitution=0;this.ri=new b;this.rj=new b;this.ni=new b}f.exports=
a;var d=c("./Equation"),b=c("../math/Vec3");c("../math/Mat3");a.prototype=new d;a.prototype.constructor=a;var l=new b,k=new b,e=new b;a.prototype.computeB=function(b){var a=this.a,c=this.b,d=this.bi,h=this.bj,p=this.ri,f=this.rj,n=d.velocity,q=d.angularVelocity,g=h.velocity,r=h.angularVelocity,t=this.jacobianElementA,L=this.jacobianElementB,O=this.ni;p.cross(O,l);f.cross(O,k);O.negate(t.spatial);l.negate(t.rotational);L.spatial.copy(O);L.rotational.copy(k);e.copy(h.position);e.vadd(f,e);e.vsub(d.position,
e);e.vsub(p,e);d=O.dot(e);h=this.restitution+1;n=h*g.dot(O)-h*n.dot(O)+r.dot(k)-q.dot(l);q=this.computeGiMf();return-d*a-n*c-b*q};var h=new b,p=new b,n=new b,q=new b,t=new b;a.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,n);this.bj.position.vadd(this.rj,q);this.bi.getVelocityAtWorldPoint(n,h);this.bj.getVelocityAtWorldPoint(q,p);h.vsub(p,t);return this.ni.dot(t)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(c,f,g){function a(b,c,e,h){this.id=
a.id++;this.minForce="undefined"===typeof e?-1E6:e;this.maxForce="undefined"===typeof h?1E6:h;this.bi=b;this.bj=c;this.eps=this.b=this.a=0;this.jacobianElementA=new d;this.jacobianElementB=new d;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}f.exports=a;var d=c("../math/JacobianElement");c=c("../math/Vec3");a.prototype.constructor=a;a.id=0;a.prototype.setSpookParams=function(b,a,c){this.a=4/(c*(1+4*a));this.b=4*a/(1+4*a);this.eps=4/(c*c*b*(1+4*a))};a.prototype.computeB=function(b,a,c){var d=this.computeGW(),
e=this.computeGq(),h=this.computeGiMf();return-e*b-d*a-h*c};a.prototype.computeGq=function(){var b=this.jacobianElementB,a=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+b.spatial.dot(a)};var b=new c;a.prototype.computeGW=function(){var a=this.jacobianElementB,c=this.bi,d=this.bj,e=d.velocity;d=d.angularVelocity||b;return this.jacobianElementA.multiplyVectors(c.velocity,c.angularVelocity||b)+a.multiplyVectors(e,d)};a.prototype.computeGWlambda=function(){var a=this.jacobianElementB,
c=this.bi,d=this.bj,e=d.vlambda;d=d.wlambda||b;return this.jacobianElementA.multiplyVectors(c.vlambda,c.wlambda||b)+a.multiplyVectors(e,d)};var l=new c,k=new c,e=new c,h=new c;a.prototype.computeGiMf=function(){var b=this.jacobianElementA,a=this.jacobianElementB,c=this.bi,d=this.bj,p=c.force,f=c.torque,n=d.force,g=d.torque,A=c.invMassSolve,C=d.invMassSolve;c.invInertiaWorldSolve?c.invInertiaWorldSolve.vmult(f,e):e.set(0,0,0);d.invInertiaWorldSolve?d.invInertiaWorldSolve.vmult(g,h):h.set(0,0,0);p.mult(A,
l);n.mult(C,k);return b.multiplyVectors(l,e)+a.multiplyVectors(k,h)};var p=new c;a.prototype.computeGiMGt=function(){var b=this.jacobianElementA,a=this.jacobianElementB,c=this.bi,d=this.bj,e=c.invInertiaWorldSolve,h=d.invInertiaWorldSolve;c=c.invMassSolve+d.invMassSolve;e&&(e.vmult(b.rotational,p),c+=p.dot(b.rotational));h&&(h.vmult(a.rotational,p),c+=p.dot(a.rotational));return c};var n=new c;new c;new c;new c;new c;new c;a.prototype.addToWlambda=function(b){var a=this.jacobianElementA,c=this.jacobianElementB,
d=this.bi,e=this.bj;a.spatial.mult(d.invMassSolve*b,n);d.vlambda.vadd(n,d.vlambda);c.spatial.mult(e.invMassSolve*b,n);e.vlambda.vadd(n,e.vlambda);d.invInertiaWorldSolve&&(d.invInertiaWorldSolve.vmult(a.rotational,n),n.mult(b,n),d.wlambda.vadd(n,d.wlambda));e.invInertiaWorldSolve&&(e.invInertiaWorldSolve.vmult(c.rotational,n),n.mult(b,n),e.wlambda.vadd(n,e.wlambda))};a.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(c,
f,g){function a(a,c,p){d.call(this,a,c,-p,p);this.ri=new b;this.rj=new b;this.t=new b}f.exports=a;var d=c("./Equation"),b=c("../math/Vec3");c("../math/Mat3");a.prototype=new d;a.prototype.constructor=a;var l=new b,k=new b;a.prototype.computeB=function(b){var a=this.b,c=this.rj,d=this.t;this.ri.cross(d,l);c.cross(d,k);c=this.jacobianElementA;var e=this.jacobianElementB;d.negate(c.spatial);l.negate(c.rotational);e.spatial.copy(d);e.rotational.copy(k);d=this.computeGW();c=this.computeGiMf();return-d*
a-b*c}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(c,f,g){function a(a,c,p){p=p||{};var e="undefined"!==typeof p.maxForce?p.maxForce:1E6;b.call(this,a,c,-e,e);this.axisA=p.axisA?p.axisA.clone():new d(1,0,0);this.axisB=p.axisB?p.axisB.clone():new d(0,1,0);this.maxAngle=Math.PI/2}f.exports=a;var d=c("../math/Vec3");c("../math/Mat3");var b=c("./Equation");a.prototype=new b;a.prototype.constructor=a;var l=new d,k=new d;a.prototype.computeB=function(b){var a=this.a,c=this.b,d=
this.axisA,e=this.axisB,f=this.jacobianElementA,g=this.jacobianElementB;d.cross(e,l);e.cross(d,k);f.rotational.copy(k);g.rotational.copy(l);d=Math.cos(this.maxAngle)-d.dot(e);e=this.computeGW();f=this.computeGiMf();return-d*a-e*c-b*f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(c,f,g){function a(a,c,e){e="undefined"!==typeof e?e:1E6;b.call(this,a,c,-e,e);this.axisA=new d;this.axisB=new d;this.targetVelocity=0}f.exports=a;var d=c("../math/Vec3");c("../math/Mat3");var b=c("./Equation");
a.prototype=new b;a.prototype.constructor=a;a.prototype.computeB=function(b){var a=this.b,c=this.axisB,d=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);c.negate(d.rotational);c=this.computeGW()-this.targetVelocity;d=this.computeGiMf();return-c*a-b*d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(c,f,g){function a(b,c,f){f=d.defaults(f,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});
this.id=a.idCounter++;this.materials=[b,c];this.friction=f.friction;this.restitution=f.restitution;this.contactEquationStiffness=f.contactEquationStiffness;this.contactEquationRelaxation=f.contactEquationRelaxation;this.frictionEquationStiffness=f.frictionEquationStiffness;this.frictionEquationRelaxation=f.frictionEquationRelaxation}var d=c("../utils/Utils");f.exports=a;a.idCounter=0},{"../utils/Utils":53}],25:[function(c,f,g){function a(c){var b="";c=c||{};"string"===typeof c?(b=c,c={}):"object"===
typeof c&&(b="");this.name=b;this.id=a.idCounter++;this.friction="undefined"!==typeof c.friction?c.friction:-1;this.restitution="undefined"!==typeof c.restitution?c.restitution:-1}f.exports=a;a.idCounter=0},{}],26:[function(c,f,g){function a(){this.spatial=new d;this.rotational=new d}f.exports=a;var d=c("./Vec3");a.prototype.multiplyElement=function(b){return b.spatial.dot(this.spatial)+b.rotational.dot(this.rotational)};a.prototype.multiplyVectors=function(b,a){return b.dot(this.spatial)+a.dot(this.rotational)}},
{"./Vec3":30}],27:[function(c,f,g){function a(b){this.elements=b?b:[0,0,0,0,0,0,0,0,0]}f.exports=a;var d=c("./Vec3");a.prototype.identity=function(){var b=this.elements;b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1};a.prototype.setZero=function(){var b=this.elements;b[0]=0;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=0;b[6]=0;b[7]=0;b[8]=0};a.prototype.setTrace=function(b){var a=this.elements;a[0]=b.x;a[4]=b.y;a[8]=b.z};a.prototype.getTrace=function(b){b=b||new d;var a=this.elements;b.x=a[0];
b.y=a[4];b.z=a[8]};a.prototype.vmult=function(b,a){a=a||new d;var c=this.elements,e=b.x,h=b.y,f=b.z;a.x=c[0]*e+c[1]*h+c[2]*f;a.y=c[3]*e+c[4]*h+c[5]*f;a.z=c[6]*e+c[7]*h+c[8]*f;return a};a.prototype.smult=function(b){for(var a=0;a<this.elements.length;a++)this.elements[a]*=b};a.prototype.mmult=function(b,c){for(var d=c||new a,e=0;3>e;e++)for(var h=0;3>h;h++){for(var f=0,n=0;3>n;n++)f+=b.elements[e+3*n]*this.elements[n+3*h];d.elements[e+3*h]=f}return d};a.prototype.scale=function(b,c){c=c||new a;for(var d=
this.elements,e=c.elements,h=0;3!==h;h++)e[3*h]=b.x*d[3*h],e[3*h+1]=b.y*d[3*h+1],e[3*h+2]=b.z*d[3*h+2];return c};a.prototype.solve=function(b,a){a=a||new d;for(var c=[],e=0;12>e;e++)c.push(0);var h;for(e=0;3>e;e++)for(h=0;3>h;h++)c[e+4*h]=this.elements[e+3*h];c[3]=b.x;c[7]=b.y;c[11]=b.z;var f=3,n=f;do{e=n-f;if(0===c[e+4*e])for(h=e+1;h<n;h++)if(0!==c[e+4*h]){var q=4;do{var l=4-q;c[l+4*e]+=c[l+4*h]}while(--q);break}if(0!==c[e+4*e])for(h=e+1;h<n;h++){var g=c[e+4*h]/c[e+4*e];q=4;do l=4-q,c[l+4*h]=l<=
e?0:c[l+4*h]-c[l+4*e]*g;while(--q)}}while(--f);a.z=c[11]/c[10];a.y=(c[7]-c[6]*a.z)/c[5];a.x=(c[3]-c[2]*a.z-c[1]*a.y)/c[0];if(isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||Infinity===a.x||Infinity===a.y||Infinity===a.z)throw"Could not solve equation! Got x=["+a.toString()+"], b=["+b.toString()+"], A=["+this.toString()+"]";return a};a.prototype.e=function(b,a,c){if(void 0===c)return this.elements[a+3*b];this.elements[a+3*b]=c};a.prototype.copy=function(b){for(var a=0;a<b.elements.length;a++)this.elements[a]=
b.elements[a];return this};a.prototype.toString=function(){for(var b="",a=0;9>a;a++)b+=this.elements[a]+",";return b};a.prototype.reverse=function(b){b=b||new a;for(var c=[],d=0;18>d;d++)c.push(0);var e;for(d=0;3>d;d++)for(e=0;3>e;e++)c[d+6*e]=this.elements[d+3*e];c[3]=1;c[9]=0;c[15]=0;c[4]=0;c[10]=1;c[16]=0;c[5]=0;c[11]=0;c[17]=1;var h=3,f=h;do{d=f-h;if(0===c[d+6*d])for(e=d+1;e<f;e++)if(0!==c[d+6*e]){var n=6;do{var q=6-n;c[q+6*d]+=c[q+6*e]}while(--n);break}if(0!==c[d+6*d])for(e=d+1;e<f;e++){var g=
c[d+6*e]/c[d+6*d];n=6;do q=6-n,c[q+6*e]=q<=d?0:c[q+6*e]-c[q+6*d]*g;while(--n)}}while(--h);d=2;do{e=d-1;do{g=c[d+6*e]/c[d+6*d];n=6;do q=6-n,c[q+6*e]-=c[q+6*d]*g;while(--n)}while(e--)}while(--d);d=2;do{g=1/c[d+6*d];n=6;do q=6-n,c[q+6*d]*=g;while(--n)}while(d--);d=2;do{e=2;do{q=c[3+e+6*d];if(isNaN(q)||Infinity===q)throw"Could not reverse! A=["+this.toString()+"]";b.e(d,e,q)}while(e--)}while(d--);return b};a.prototype.setRotationFromQuaternion=function(b){var a=b.x,c=b.y,d=b.z,h=b.w,f=a+a,n=c+c,q=d+d;
b=a*f;var g=a*n;a*=q;var r=c*n;c*=q;d*=q;f*=h;n*=h;h*=q;q=this.elements;q[0]=1-(r+d);q[1]=g-h;q[2]=a+n;q[3]=g+h;q[4]=1-(b+d);q[5]=c-f;q[6]=a-n;q[7]=c+f;q[8]=1-(b+r);return this};a.prototype.transpose=function(b){b=b||new a;for(var c=b.elements,d=this.elements,e=0;3!==e;e++)for(var h=0;3!==h;h++)c[3*e+h]=d[3*h+e];return b}},{"./Vec3":30}],28:[function(c,f,g){function a(b,a,c,d){this.x=void 0!==b?b:0;this.y=void 0!==a?a:0;this.z=void 0!==c?c:0;this.w=void 0!==d?d:1}f.exports=a;var d=c("./Vec3");a.prototype.set=
function(b,a,c,d){this.x=b;this.y=a;this.z=c;this.w=d};a.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};a.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};a.prototype.setFromAxisAngle=function(b,a){var c=Math.sin(.5*a);this.x=b.x*c;this.y=b.y*c;this.z=b.z*c;this.w=Math.cos(.5*a)};a.prototype.toAxisAngle=function(b){b=b||new d;this.normalize();var a=2*Math.acos(this.w),c=Math.sqrt(1-this.w*this.w);.001>c?(b.x=this.x,b.y=this.y,b.z=this.z):(b.x=this.x/
c,b.y=this.y/c,b.z=this.z/c);return[b,a]};var b=new d,l=new d;a.prototype.setFromVectors=function(a,c){if(a.isAntiparallelTo(c))a.tangents(b,l),this.setFromAxisAngle(b,Math.PI);else{var d=a.cross(c);this.x=d.x;this.y=d.y;this.z=d.z;this.w=Math.sqrt(Math.pow(a.norm(),2)*Math.pow(c.norm(),2))+a.dot(c);this.normalize()}};var k=new d,e=new d,h=new d;a.prototype.mult=function(b,c){c=c||new a;var d=this.w;k.set(this.x,this.y,this.z);e.set(b.x,b.y,b.z);c.w=d*b.w-k.dot(e);k.cross(e,h);c.x=d*e.x+b.w*k.x+h.x;
c.y=d*e.y+b.w*k.y+h.y;c.z=d*e.z+b.w*k.z+h.z;return c};a.prototype.inverse=function(b){var c=this.x,d=this.y,e=this.z,h=this.w;b=b||new a;this.conjugate(b);c=1/(c*c+d*d+e*e+h*h);b.x*=c;b.y*=c;b.z*=c;b.w*=c;return b};a.prototype.conjugate=function(b){b=b||new a;b.x=-this.x;b.y=-this.y;b.z=-this.z;b.w=this.w;return b};a.prototype.normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===b?this.w=this.z=this.y=this.x=0:(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=
b)};a.prototype.normalizeFast=function(){var b=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===b?this.w=this.z=this.y=this.x=0:(this.x*=b,this.y*=b,this.z*=b,this.w*=b)};a.prototype.vmult=function(b,a){a=a||new d;var c=b.x,e=b.y,h=b.z,f=this.x,n=this.y,p=this.z,k=this.w,g=k*c+n*h-p*e,l=k*e+p*c-f*h,C=k*h+f*e-n*c;c=-f*c-n*e-p*h;a.x=g*k+c*-f+l*-p-C*-n;a.y=l*k+c*-n+C*-f-g*-p;a.z=C*k+c*-p+g*-n-l*-f;return a};a.prototype.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this};
a.prototype.toEuler=function(b,a){a=a||"YZX";var c=this.x,d=this.y,e=this.z,h=this.w;switch(a){case "YZX":var f=c*d+e*h;if(.499<f){var n=2*Math.atan2(c,h);var p=Math.PI/2;var k=0}-.499>f&&(n=-2*Math.atan2(c,h),p=-Math.PI/2,k=0);isNaN(n)&&(k=e*e,n=Math.atan2(2*d*h-2*c*e,1-2*d*d-2*k),p=Math.asin(2*f),k=Math.atan2(2*c*h-2*d*e,1-2*c*c-2*k));break;default:throw Error("Euler order "+a+" not supported yet.");}b.y=n;b.z=p;b.x=k};a.prototype.setFromEuler=function(b,a,c,d){d=d||"XYZ";var e=Math.cos(b/2),h=
Math.cos(a/2),f=Math.cos(c/2);b=Math.sin(b/2);a=Math.sin(a/2);c=Math.sin(c/2);"XYZ"===d?(this.x=b*h*f+e*a*c,this.y=e*a*f-b*h*c,this.z=e*h*c+b*a*f,this.w=e*h*f-b*a*c):"YXZ"===d?(this.x=b*h*f+e*a*c,this.y=e*a*f-b*h*c,this.z=e*h*c-b*a*f,this.w=e*h*f+b*a*c):"ZXY"===d?(this.x=b*h*f-e*a*c,this.y=e*a*f+b*h*c,this.z=e*h*c+b*a*f,this.w=e*h*f-b*a*c):"ZYX"===d?(this.x=b*h*f-e*a*c,this.y=e*a*f+b*h*c,this.z=e*h*c-b*a*f,this.w=e*h*f+b*a*c):"YZX"===d?(this.x=b*h*f+e*a*c,this.y=e*a*f+b*h*c,this.z=e*h*c-b*a*f,this.w=
e*h*f-b*a*c):"XZY"===d&&(this.x=b*h*f-e*a*c,this.y=e*a*f-b*h*c,this.z=e*h*c+b*a*f,this.w=e*h*f+b*a*c);return this};a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(c,f,g){function a(a){a=a||{};this.position=new d;a.position&&this.position.copy(a.position);this.quaternion=new b;a.quaternion&&this.quaternion.copy(a.quaternion)}var d=c("./Vec3"),b=c("./Quaternion");f.exports=a;var l=new b;a.pointToLocalFrame=function(b,a,c,f){f=f||new d;c.vsub(b,f);
a.conjugate(l);l.vmult(f,f);return f};a.prototype.pointToLocal=function(b,c){return a.pointToLocalFrame(this.position,this.quaternion,b,c)};a.pointToWorldFrame=function(b,a,c,f){f=f||new d;a.vmult(c,f);f.vadd(b,f);return f};a.prototype.pointToWorld=function(b,c){return a.pointToWorldFrame(this.position,this.quaternion,b,c)};a.prototype.vectorToWorldFrame=function(b,a){a=a||new d;this.quaternion.vmult(b,a);return a};a.vectorToWorldFrame=function(b,a,c){b.vmult(a,c);return c};a.vectorToLocalFrame=function(b,
a,c,f){f=f||new d;a.w*=-1;a.vmult(c,f);a.w*=-1;return f}},{"./Quaternion":28,"./Vec3":30}],30:[function(c,f,g){function a(b,a,c){this.x=b||0;this.y=a||0;this.z=c||0}f.exports=a;var d=c("./Mat3");a.ZERO=new a(0,0,0);a.UNIT_X=new a(1,0,0);a.UNIT_Y=new a(0,1,0);a.UNIT_Z=new a(0,0,1);a.prototype.cross=function(b,c){var d=b.x,e=b.y,h=b.z,f=this.x,g=this.y,k=this.z;c=c||new a;c.x=g*h-k*e;c.y=k*d-f*h;c.z=f*e-g*d;return c};a.prototype.set=function(b,a,c){this.x=b;this.y=a;this.z=c;return this};a.prototype.setZero=
function(){this.x=this.y=this.z=0};a.prototype.vadd=function(b,c){if(c)c.x=b.x+this.x,c.y=b.y+this.y,c.z=b.z+this.z;else return new a(this.x+b.x,this.y+b.y,this.z+b.z)};a.prototype.vsub=function(b,c){if(c)c.x=this.x-b.x,c.y=this.y-b.y,c.z=this.z-b.z;else return new a(this.x-b.x,this.y-b.y,this.z-b.z)};a.prototype.crossmat=function(){return new d([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};a.prototype.normalize=function(){var b=this.x,a=this.y,c=this.z;b=Math.sqrt(b*b+a*a+c*c);0<b?(a=1/
b,this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return b};a.prototype.unit=function(b){b=b||new a;var c=this.x,d=this.y,e=this.z,f=Math.sqrt(c*c+d*d+e*e);0<f?(f=1/f,b.x=c*f,b.y=d*f,b.z=e*f):(b.x=1,b.y=0,b.z=0);return b};a.prototype.norm=function(){var b=this.x,a=this.y,c=this.z;return Math.sqrt(b*b+a*a+c*c)};a.prototype.length=a.prototype.norm;a.prototype.norm2=function(){return this.dot(this)};a.prototype.lengthSquared=a.prototype.norm2;a.prototype.distanceTo=function(b){var a=this.x,c=this.y,
d=this.z,e=b.x,f=b.y;b=b.z;return Math.sqrt((e-a)*(e-a)+(f-c)*(f-c)+(b-d)*(b-d))};a.prototype.distanceSquared=function(b){var a=this.x,c=this.y,d=this.z,e=b.x,f=b.y;b=b.z;return(e-a)*(e-a)+(f-c)*(f-c)+(b-d)*(b-d)};a.prototype.mult=function(b,c){c=c||new a;var d=this.y,e=this.z;c.x=b*this.x;c.y=b*d;c.z=b*e;return c};a.prototype.scale=a.prototype.mult;a.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z};a.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};a.prototype.negate=
function(b){b=b||new a;b.x=-this.x;b.y=-this.y;b.z=-this.z;return b};var b=new a,l=new a;a.prototype.tangents=function(a,c){var d=this.norm();0<d?(d=1/d,b.set(this.x*d,this.y*d,this.z*d),.9>Math.abs(b.x)?l.set(1,0,0):l.set(0,1,0),b.cross(l,a),b.cross(a,c)):(a.set(1,0,0),c.set(0,1,0))};a.prototype.toString=function(){return this.x+","+this.y+","+this.z};a.prototype.toArray=function(){return[this.x,this.y,this.z]};a.prototype.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this};a.prototype.lerp=
function(b,a,c){var d=this.x,e=this.y,f=this.z;c.x=d+(b.x-d)*a;c.y=e+(b.y-e)*a;c.z=f+(b.z-f)*a};a.prototype.almostEquals=function(b,a){void 0===a&&(a=1E-6);return Math.abs(this.x-b.x)>a||Math.abs(this.y-b.y)>a||Math.abs(this.z-b.z)>a?!1:!0};a.prototype.almostZero=function(b){void 0===b&&(b=1E-6);return Math.abs(this.x)>b||Math.abs(this.y)>b||Math.abs(this.z)>b?!1:!0};var k=new a;a.prototype.isAntiparallelTo=function(b,a){this.negate(k);return k.almostEquals(b,a)};a.prototype.clone=function(){return new a(this.x,
this.y,this.z)}},{"./Mat3":27}],31:[function(c,f,g){function a(c){c=c||{};d.apply(this);this.id=a.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new b;this.collisionFilterGroup="number"===typeof c.collisionFilterGroup?c.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof c.collisionFilterMask?c.collisionFilterMask:1;this.collisionResponse=!0;this.position=new b;c.position&&this.position.copy(c.position);this.previousPosition=new b;this.initPosition=new b;this.velocity=
new b;c.velocity&&this.velocity.copy(c.velocity);this.initVelocity=new b;this.force=new b;var f="number"===typeof c.mass?c.mass:0;this.mass=f;this.invMass=0<f?1/f:0;this.material=c.material||null;this.linearDamping="number"===typeof c.linearDamping?c.linearDamping:.01;this.type=0>=f?a.STATIC:a.DYNAMIC;typeof c.type===typeof a.STATIC&&(this.type=c.type);this.allowSleep="undefined"!==typeof c.allowSleep?c.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!==typeof c.sleepSpeedLimit?c.sleepSpeedLimit:
.1;this.sleepTimeLimit="undefined"!==typeof c.sleepTimeLimit?c.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new b;this.quaternion=new k;c.quaternion&&this.quaternion.copy(c.quaternion);this.initQuaternion=new k;this.angularVelocity=new b;c.angularVelocity&&this.angularVelocity.copy(c.angularVelocity);this.initAngularVelocity=new b;this.interpolatedPosition=new b;this.interpolatedQuaternion=new k;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=
new b;this.invInertia=new b;this.invInertiaWorld=new l;this.invMassSolve=0;this.invInertiaSolve=new b;this.invInertiaWorldSolve=new l;this.fixedRotation="undefined"!==typeof c.fixedRotation?c.fixedRotation:!1;this.angularDamping="undefined"!==typeof c.angularDamping?c.angularDamping:.01;this.aabb=new e;this.aabbNeedsUpdate=!0;this.wlambda=new b;c.shape&&this.addShape(c.shape);this.updateMassProperties()}f.exports=a;var d=c("../utils/EventTarget");c("../shapes/Shape");var b=c("../math/Vec3"),l=c("../math/Mat3"),
k=c("../math/Quaternion");c("../material/Material");var e=c("../collision/AABB"),h=c("../shapes/Box");a.prototype=new d;a.prototype.constructor=a;a.DYNAMIC=1;a.STATIC=2;a.KINEMATIC=4;a.AWAKE=0;a.SLEEPY=1;a.SLEEPING=2;a.idCounter=0;a.prototype.wakeUp=function(){var b=this.sleepState;this.sleepState=0;b===a.SLEEPING&&this.dispatchEvent({type:"wakeup"})};a.prototype.sleep=function(){this.sleepState=a.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};a.sleepyEvent={type:"sleepy"};a.sleepEvent=
{type:"sleep"};a.prototype.sleepTick=function(b){if(this.allowSleep){var c=this.sleepState,d=this.velocity.norm2()+this.angularVelocity.norm2(),e=Math.pow(this.sleepSpeedLimit,2);c===a.AWAKE&&d<e?(this.sleepState=a.SLEEPY,this.timeLastSleepy=b,this.dispatchEvent(a.sleepyEvent)):c===a.SLEEPY&&d>e?this.wakeUp():c===a.SLEEPY&&b-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(a.sleepEvent))}};a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===
a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};a.prototype.pointToLocalFrame=function(a,c){c=c||new b;a.vsub(this.position,c);this.quaternion.conjugate().vmult(c,c);return c};a.prototype.vectorToLocalFrame=function(a,c){c=c||new b;this.quaternion.conjugate().vmult(a,c);return c};a.prototype.pointToWorldFrame=function(a,
c){c=c||new b;this.quaternion.vmult(a,c);c.vadd(this.position,c);return c};a.prototype.vectorToWorldFrame=function(a,c){c=c||new b;this.quaternion.vmult(a,c);return c};var p=new b,n=new k;a.prototype.addShape=function(a,c,d){var e=new b,f=new k;c&&e.copy(c);d&&f.copy(d);this.shapes.push(a);this.shapeOffsets.push(e);this.shapeOrientations.push(f);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0;return this};a.prototype.updateBoundingRadius=function(){for(var b=this.shapes,
a=this.shapeOffsets,c=b.length,d=0,e=0;e!==c;e++){var f=b[e];f.updateBoundingSphereRadius();var h=a[e].norm();f=f.boundingSphereRadius;h+f>d&&(d=h+f)}this.boundingRadius=d};var q=new e;a.prototype.computeAABB=function(){for(var b=this.shapes,a=this.shapeOffsets,c=this.shapeOrientations,d=b.length,e=this.quaternion,f=this.aabb,h=0;h!==d;h++){var g=b[h];c[h].mult(e,n);n.vmult(a[h],p);p.vadd(this.position,p);g.calculateWorldAABB(p,n,q.lowerBound,q.upperBound);0===h?f.copy(q):f.extend(q)}this.aabbNeedsUpdate=
!1};var t=new l,r=new l;new l;a.prototype.updateInertiaWorld=function(b){var a=this.invInertia;if(a.x!==a.y||a.y!==a.z||b)t.setRotationFromQuaternion(this.quaternion),t.transpose(r),t.scale(a,t),t.mmult(r,this.invInertiaWorld)};var y=new b,u=new b;a.prototype.applyForce=function(b,c){this.type===a.DYNAMIC&&(c.vsub(this.position,y),y.cross(b,u),this.force.vadd(b,this.force),this.torque.vadd(u,this.torque))};var x=new b,w=new b;a.prototype.applyLocalForce=function(b,c){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(b,
x),this.pointToWorldFrame(c,w),this.applyForce(x,w))};var z=new b,A=new b,C=new b;a.prototype.applyImpulse=function(b,c){this.type===a.DYNAMIC&&(c.vsub(this.position,z),A.copy(b),A.mult(this.invMass,A),this.velocity.vadd(A,this.velocity),z.cross(b,C),this.invInertiaWorld.vmult(C,C),this.angularVelocity.vadd(C,this.angularVelocity))};var D=new b,G=new b;a.prototype.applyLocalImpulse=function(b,c){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(b,D),this.pointToWorldFrame(c,G),this.applyImpulse(D,G))};
var H=new b;a.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var b=this.inertia,a=this.fixedRotation;this.computeAABB();H.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);h.calculateInertia(H,this.mass,b);this.invInertia.set(0<b.x&&!a?1/b.x:0,0<b.y&&!a?1/b.y:0,0<b.z&&!a?1/b.z:0);this.updateInertiaWorld(!0)};a.prototype.getVelocityAtWorldPoint=function(a,c){var d=
new b;a.vsub(this.position,d);this.angularVelocity.cross(d,c);this.velocity.vadd(c,c);return c}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(c,f,g){function a(b){this.chassisBody=b.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis="undefined"!==typeof b.indexRightAxis?b.indexRightAxis:1;this.indexForwardAxis="undefined"!==
typeof b.indexForwardAxis?b.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof b.indexUpAxis?b.indexUpAxis:2}function d(b,a,c){var d=A,e=C,f=D,h=G;a.vsub(b.position,d);d.cross(c,e);b.invInertiaWorld.vmult(e,h);h.cross(d,f);return b.invMass+c.dot(f)}c("./Body");var b=c("../math/Vec3"),l=c("../math/Quaternion");c("../collision/RaycastResult");g=c("../collision/Ray");var k=c("../objects/WheelInfo");f.exports=a;new b;new b;new b;var e=new b,h=new b,p=new b;new g;a.prototype.addWheel=function(b){b=
b||{};b=new k(b);var a=this.wheelInfos.length;this.wheelInfos.push(b);return a};a.prototype.setSteeringValue=function(b,a){this.wheelInfos[a].steering=b};new b;a.prototype.applyEngineForce=function(b,a){this.wheelInfos[a].engineForce=b};a.prototype.setBrake=function(b,a){this.wheelInfos[a].brake=b};a.prototype.addToWorld=function(b){b.add(this.chassisBody);var a=this;this.preStepCallback=function(){a.updateVehicle(b.dt)};b.addEventListener("preStep",this.preStepCallback);this.world=b};a.prototype.getVehicleAxisWorld=
function(b,a){a.set(0===b?1:0,1===b?1:0,2===b?1:0);this.chassisBody.vectorToWorldFrame(a,a)};a.prototype.updateVehicle=function(a){for(var c=this.wheelInfos,d=c.length,e=this.chassisBody,f=0;f<d;f++)this.updateWheelTransform(f);this.currentVehicleSpeedKmHour=3.6*e.velocity.norm();f=new b;this.getVehicleAxisWorld(this.indexForwardAxis,f);0>f.dot(e.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(f=0;f<d;f++)this.castRay(c[f]);this.updateSuspension(a);var h=new b,g=new b;for(f=0;f<d;f++){var n=c[f],
k=n.suspensionForce;k>n.maxSuspensionForce&&(k=n.maxSuspensionForce);n.raycastResult.hitNormalWorld.scale(k*a,h);n.raycastResult.hitPointWorld.vsub(e.position,g);e.applyImpulse(h,n.raycastResult.hitPointWorld)}this.updateFriction(a);h=new b;g=new b;k=new b;for(f=0;f<d;f++){n=c[f];e.getVelocityAtWorldPoint(n.chassisConnectionPointWorld,k);var l=1;switch(this.indexUpAxis){case 1:l=-1}if(n.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,g);var q=g.dot(n.raycastResult.hitNormalWorld);n.raycastResult.hitNormalWorld.scale(q,
h);g.vsub(h,g);q=g.dot(k);n.deltaRotation=l*q*a/n.radius}!n.sliding&&n.isInContact||0===n.engineForce||!n.useCustomSlidingRotationalSpeed||(n.deltaRotation=(0<n.engineForce?1:-1)*n.customSlidingRotationalSpeed*a);Math.abs(n.brake)>Math.abs(n.engineForce)&&(n.deltaRotation=0);n.rotation+=n.deltaRotation;n.deltaRotation*=.99}};a.prototype.updateSuspension=function(b){b=this.chassisBody.mass;for(var a=this.wheelInfos,c=a.length,d=0;d<c;d++){var e=a[d];if(e.isInContact){var f=e.suspensionStiffness*(e.suspensionRestLength-
e.suspensionLength)*e.clippedInvContactDotSuspension;var h=e.suspensionRelativeVelocity;f-=(0>h?e.dampingCompression:e.dampingRelaxation)*h;e.suspensionForce=f*b;0>e.suspensionForce&&(e.suspensionForce=0)}else e.suspensionForce=0}};a.prototype.removeFromWorld=function(b){b.remove(this.chassisBody);b.removeEventListener("preStep",this.preStepCallback);this.world=null};var n=new b,q=new b;a.prototype.castRay=function(a){this.updateWheelTransformWorld(a);var c=this.chassisBody,d=-1;a.directionWorld.scale(a.suspensionRestLength+
a.radius,n);var e=a.chassisConnectionPointWorld;e.vadd(n,q);var f=a.raycastResult;f.reset();var h=c.collisionResponse;c.collisionResponse=!1;this.world.rayTest(e,q,f);c.collisionResponse=h;e=f.body;a.raycastResult.groundObject=0;e?(d=f.distance,a.raycastResult.hitNormalWorld=f.hitNormalWorld,a.isInContact=!0,a.suspensionLength=f.distance-a.radius,f=a.suspensionRestLength-a.maxSuspensionTravel,e=a.suspensionRestLength+a.maxSuspensionTravel,a.suspensionLength<f&&(a.suspensionLength=f),a.suspensionLength>
e&&(a.suspensionLength=e,a.raycastResult.reset()),f=a.raycastResult.hitNormalWorld.dot(a.directionWorld),e=new b,c.getVelocityAtWorldPoint(a.raycastResult.hitPointWorld,e),c=a.raycastResult.hitNormalWorld.dot(e),-.1<=f?(a.suspensionRelativeVelocity=0,a.clippedInvContactDotSuspension=10):(f=-1/f,a.suspensionRelativeVelocity=c*f,a.clippedInvContactDotSuspension=f)):(a.suspensionLength=a.suspensionRestLength+0*a.maxSuspensionTravel,a.suspensionRelativeVelocity=0,a.directionWorld.scale(-1,a.raycastResult.hitNormalWorld),
a.clippedInvContactDotSuspension=1);return d};a.prototype.updateWheelTransformWorld=function(b){b.isInContact=!1;var a=this.chassisBody;a.pointToWorldFrame(b.chassisConnectionPointLocal,b.chassisConnectionPointWorld);a.vectorToWorldFrame(b.directionLocal,b.directionWorld);a.vectorToWorldFrame(b.axleLocal,b.axleWorld)};a.prototype.updateWheelTransform=function(b){b=this.wheelInfos[b];this.updateWheelTransformWorld(b);b.directionLocal.scale(-1,e);h.copy(b.axleLocal);e.cross(h,p);p.normalize();h.normalize();
var a=b.steering,c=new l;c.setFromAxisAngle(e,a);a=new l;a.setFromAxisAngle(h,b.rotation);var d=b.worldTransform.quaternion;this.chassisBody.quaternion.mult(c,d);d.mult(a,d);d.normalize();c=b.worldTransform.position;c.copy(b.directionWorld);c.scale(b.suspensionLength,c);c.vadd(b.chassisConnectionPointWorld,c)};var t=[new b(1,0,0),new b(0,1,0),new b(0,0,1)];a.prototype.getWheelTransformWorld=function(b){return this.wheelInfos[b].worldTransform};var r=new b,y=[],u=[];a.prototype.updateFriction=function(a){for(var c=
this.wheelInfos,e=c.length,f=this.chassisBody,h=0,n=0;n<e;n++){var g=c[n],k=g.raycastResult.body;k&&h++;g.sideImpulse=0;g.forwardImpulse=0;u[n]||(u[n]=new b);y[n]||(y[n]=new b)}for(n=0;n<e;n++)if(g=c[n],k=g.raycastResult.body){var l=y[n];this.getWheelTransformWorld(n).vectorToWorldFrame(t[this.indexRightAxis],l);h=g.raycastResult.hitNormalWorld;var q=l.dot(h);h.scale(q,r);l.vsub(r,l);l.normalize();h.cross(l,u[n]);u[n].normalize();h=g;q=f;var p=g.raycastResult.hitPointWorld,D=g.raycastResult.hitPointWorld;
if(1.1<l.norm2())k=0;else{var B=H,G=J,A=L;q.getVelocityAtWorldPoint(p,B);k.getVelocityAtWorldPoint(D,G);B.vsub(G,A);k=-.2*l.dot(A)*(1/(q.invMass+k.invMass))}h.sideImpulse=k;g.sideImpulse*=1}this.sliding=!1;for(n=0;n<e;n++){g=c[n];k=g.raycastResult.body;q=0;g.slipInfo=1;if(k){h=g.brake?g.brake:0;B=f;p=k;D=g.raycastResult.hitPointWorld;l=u[n];q=h;G=D;A=x;var F=w,W=z;B.getVelocityAtWorldPoint(G,A);p.getVelocityAtWorldPoint(G,F);A.vsub(F,W);G=l.dot(W);B=d(B,D,l);p=d(p,D,l);p=1/(B+p)*-G;q<p&&(p=q);p<-q&&
(p=-q);q=p;q+=g.engineForce*a;h/=q;g.slipInfo*=h}g.forwardImpulse=0;g.skidInfo=1;k&&(g.skidInfo=1,k=g.suspensionForce*a*g.frictionSlip,h=k*k,g.forwardImpulse=q,q=.5*g.forwardImpulse,p=1*g.sideImpulse,q=q*q+p*p,g.sliding=!1,q>h&&(this.sliding=!0,g.sliding=!0,h=k/Math.sqrt(q),g.skidInfo*=h))}if(this.sliding)for(n=0;n<e;n++)g=c[n],0!==g.sideImpulse&&1>g.skidInfo&&(g.forwardImpulse*=g.skidInfo,g.sideImpulse*=g.skidInfo);for(n=0;n<e;n++)g=c[n],a=new b,a.copy(g.raycastResult.hitPointWorld),0!==g.forwardImpulse&&
(k=new b,u[n].scale(g.forwardImpulse,k),f.applyImpulse(k,a)),0!==g.sideImpulse&&(k=g.raycastResult.body,h=new b,h.copy(g.raycastResult.hitPointWorld),q=new b,y[n].scale(g.sideImpulse,q),f.pointToLocalFrame(a,a),a["xyz"[this.indexUpAxis]]*=g.rollInfluence,f.pointToWorldFrame(a,a),f.applyImpulse(q,a),q.scale(-1,q),k.applyImpulse(q,h))};var x=new b,w=new b,z=new b,A=new b,C=new b,D=new b,G=new b,H=new b,J=new b,L=new b},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,
"../objects/WheelInfo":36,"./Body":31}],33:[function(c,f,g){function a(b){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof b.coordinateSystem?new k(1,2,3):b.coordinateSystem.clone();this.chassisBody=b.chassisBody;this.chassisBody||(b=new l(new k(5,2,.5)),this.chassisBody=new d(1,b));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var d=c("./Body"),b=c("../shapes/Sphere"),l=c("../shapes/Box"),k=c("../math/Vec3"),e=c("../constraints/HingeConstraint");f.exports=a;a.prototype.addWheel=
function(a){a=a||{};var c=a.body;c||(c=new d(1,new b(1.2)));this.wheelBodies.push(c);this.wheelForces.push(0);new k;var f="undefined"!==typeof a.position?a.position.clone():new k,h=new k;this.chassisBody.pointToWorldFrame(f,h);c.position.set(h.x,h.y,h.z);a="undefined"!==typeof a.axis?a.axis.clone():new k(0,1,0);this.wheelAxes.push(a);c=new e(this.chassisBody,c,{pivotA:f,axisA:a,pivotB:k.ZERO,axisB:a,collideConnected:!1});this.constraints.push(c);return this.wheelBodies.length-1};a.prototype.setSteeringValue=
function(b,a){var c=this.wheelAxes[a],d=Math.cos(b),e=Math.sin(b),f=c.x;c=c.y;this.constraints[a].axisA.set(d*f-e*c,e*f+d*c,0)};a.prototype.setMotorSpeed=function(b,a){var c=this.constraints[a];c.enableMotor();c.motorTargetVelocity=b};a.prototype.disableMotor=function(b){this.constraints[b].disableMotor()};var h=new k;a.prototype.setWheelForce=function(b,a){this.wheelForces[a]=b};a.prototype.applyWheelForce=function(b,a){var c=this.wheelBodies[a],d=c.torque;this.wheelAxes[a].scale(b,h);c.vectorToWorldFrame(h,
h);d.vadd(h,d)};a.prototype.addToWorld=function(b){for(var a=this.constraints,c=this.wheelBodies.concat([this.chassisBody]),d=0;d<c.length;d++)b.add(c[d]);for(d=0;d<a.length;d++)b.addConstraint(a[d]);b.addEventListener("preStep",this._update.bind(this))};a.prototype._update=function(){for(var b=this.wheelForces,a=0;a<b.length;a++)this.applyWheelForce(b[a],a)};a.prototype.removeFromWorld=function(b){for(var a=this.constraints,c=this.wheelBodies.concat([this.chassisBody]),d=0;d<c.length;d++)b.remove(c[d]);
for(d=0;d<a.length;d++)b.removeConstraint(a[d])};var p=new k;a.prototype.getWheelSpeed=function(b){var a=this.wheelBodies[b].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[b],p);return a.dot(p)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(c,f,g){function a(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=
[]}f.exports=a;c("../shapes/Shape");f=c("../math/Vec3");c("../math/Quaternion");c("../shapes/Particle");c("../objects/Body");c("../material/Material");a.prototype.add=function(b){this.particles.push(b);this.neighbors.length<this.particles.length&&this.neighbors.push([])};a.prototype.remove=function(b){b=this.particles.indexOf(b);-1!==b&&(this.particles.splice(b,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var d=new f;a.prototype.getNeighbors=function(b,a){for(var c=this.particles.length,
e=b.id,f=this.smoothingRadius*this.smoothingRadius,h=0;h!==c;h++){var g=this.particles[h];g.position.vsub(b.position,d);e!==g.id&&d.norm2()<f&&a.push(g)}};var b=new f,l=new f,k=new f,e=new f,h=new f,p=new f;a.prototype.update=function(){for(var a=this.particles.length,c=this.speedOfSound,d=this.eps,f=0;f!==a;f++){var g=this.particles[f],u=this.neighbors[f];u.length=0;this.getNeighbors(g,u);u.push(this.particles[f]);for(var x=u.length,w=0,z=0;z!==x;z++){g.position.vsub(u[z].position,b);var A=b.norm();
A=this.w(A);w+=u[z].mass*A}this.densities[f]=w;this.pressures[f]=c*c*(this.densities[f]-this.density)}for(f=0;f!==a;f++){c=this.particles[f];l.set(0,0,0);k.set(0,0,0);u=this.neighbors[f];x=u.length;for(z=0;z!==x;z++)w=u[z],c.position.vsub(w.position,h),A=h.norm(),g=-w.mass*(this.pressures[f]/(this.densities[f]*this.densities[f]+d)+this.pressures[z]/(this.densities[z]*this.densities[z]+d)),this.gradw(h,e),e.mult(g,e),l.vadd(e,l),w.velocity.vsub(c.velocity,p),p.mult(1/(1E-4+this.densities[f]*this.densities[z])*
this.viscosity*w.mass,p),g=this.nablaw(A),p.mult(g,p),k.vadd(p,k);k.mult(c.mass,k);l.mult(c.mass,l);c.force.vadd(k,c.force);c.force.vadd(l,c.force)}};a.prototype.w=function(b){var a=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(a,9))*Math.pow(a*a-b*b,3)};a.prototype.gradw=function(b,a){var c=b.norm(),d=this.smoothingRadius;b.mult(945/(32*Math.PI*Math.pow(d,9))*Math.pow(d*d-c*c,2),a)};a.prototype.nablaw=function(b){var a=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(a,9))*(a*a-b*b)*(7*
b*b-3*a*a)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(c,f,g){function a(b,a,c){c=c||{};this.restLength="number"===typeof c.restLength?c.restLength:1;this.stiffness=c.stiffness||100;this.damping=c.damping||1;this.bodyA=b;this.bodyB=a;this.localAnchorA=new d;this.localAnchorB=new d;c.localAnchorA&&this.localAnchorA.copy(c.localAnchorA);c.localAnchorB&&this.localAnchorB.copy(c.localAnchorB);c.worldAnchorA&&
this.setWorldAnchorA(c.worldAnchorA);c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB)}var d=c("../math/Vec3");f.exports=a;a.prototype.setWorldAnchorA=function(b){this.bodyA.pointToLocalFrame(b,this.localAnchorA)};a.prototype.setWorldAnchorB=function(b){this.bodyB.pointToLocalFrame(b,this.localAnchorB)};a.prototype.getWorldAnchorA=function(b){this.bodyA.pointToWorldFrame(this.localAnchorA,b)};a.prototype.getWorldAnchorB=function(b){this.bodyB.pointToWorldFrame(this.localAnchorB,b)};var b=new d,
l=new d,k=new d,e=new d,h=new d,p=new d,n=new d,q=new d,t=new d,r=new d,y=new d;a.prototype.applyForce=function(){var a=this.stiffness,c=this.damping,d=this.restLength,f=this.bodyA,g=this.bodyB;this.getWorldAnchorA(h);this.getWorldAnchorB(p);h.vsub(f.position,n);p.vsub(g.position,q);p.vsub(h,b);var C=b.norm();l.copy(b);l.normalize();g.velocity.vsub(f.velocity,k);g.angularVelocity.cross(q,y);k.vadd(y,k);f.angularVelocity.cross(n,y);k.vsub(y,k);l.mult(-a*(C-d)-c*k.dot(l),e);f.force.vsub(e,f.force);
g.force.vadd(e,g.force);n.cross(e,t);q.cross(e,r);f.torque.vsub(t,f.torque);g.torque.vadd(r,g.torque)}},{"../math/Vec3":30}],36:[function(c,f,g){function a(a){a=k.defaults(a,{chassisConnectionPointLocal:new d,chassisConnectionPointWorld:new d,directionLocal:new d,directionWorld:new d,axleLocal:new d,axleWorld:new d,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,
maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=a.maxSuspensionTravel;this.customSlidingRotationalSpeed=a.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=a.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=a.chassisConnectionPointLocal.clone();
this.chassisConnectionPointWorld=a.chassisConnectionPointWorld.clone();this.directionLocal=a.directionLocal.clone();this.directionWorld=a.directionWorld.clone();this.axleLocal=a.axleLocal.clone();this.axleWorld=a.axleWorld.clone();this.suspensionRestLength=a.suspensionRestLength;this.suspensionMaxLength=a.suspensionMaxLength;this.radius=a.radius;this.suspensionStiffness=a.suspensionStiffness;this.dampingCompression=a.dampingCompression;this.dampingRelaxation=a.dampingRelaxation;this.frictionSlip=
a.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=a.rollInfluence;this.maxSuspensionForce=a.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=a.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new l;this.worldTransform=new b;this.isInContact=!1}var d=c("../math/Vec3"),b=c("../math/Transform"),l=c("../collision/RaycastResult"),
k=c("../utils/Utils");f.exports=a;var e=new d,h=new d;e=new d;a.prototype.updateWheel=function(b){var a=this.raycastResult;if(this.isInContact){var c=a.hitNormalWorld.dot(a.directionWorld);a.hitPointWorld.vsub(b.position,h);b.getVelocityAtWorldPoint(h,e);b=a.hitNormalWorld.dot(e);-.1<=c?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(c=-1/c,this.suspensionRelativeVelocity=b*c,this.clippedInvContactDotSuspension=c)}else a.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=
0,a.directionWorld.scale(-1,a.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(c,f,g){function a(b){d.call(this);this.type=d.types.BOX;this.halfExtents=b;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3"),l=c("./ConvexPolyhedron");a.prototype=new d;a.prototype.constructor=
a;a.prototype.updateConvexPolyhedronRepresentation=function(){var a=this.halfExtents.x,c=this.halfExtents.y,d=this.halfExtents.z;a=[new b(-a,-c,-d),new b(a,-c,-d),new b(a,c,-d),new b(-a,c,-d),new b(-a,-c,d),new b(a,-c,d),new b(a,c,d),new b(-a,c,d)];new b(0,0,1);new b(0,1,0);new b(1,0,0);this.convexPolyhedronRepresentation=a=new l(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);a.material=this.material};a.prototype.calculateLocalInertia=function(c,d){d=d||new b;a.calculateInertia(this.halfExtents,
c,d);return d};a.calculateInertia=function(b,a,c){c.x=1/12*a*(4*b.y*b.y+4*b.z*b.z);c.y=1/12*a*(4*b.x*b.x+4*b.z*b.z);c.z=1/12*a*(4*b.y*b.y+4*b.x*b.x)};a.prototype.getSideNormals=function(b,a){var c=this.halfExtents;b[0].set(c.x,0,0);b[1].set(0,c.y,0);b[2].set(0,0,c.z);b[3].set(-c.x,0,0);b[4].set(0,-c.y,0);b[5].set(0,0,-c.z);if(void 0!==a)for(c=0;c!==b.length;c++)a.vmult(b[c],b[c]);return b};a.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};a.prototype.updateBoundingSphereRadius=
function(){this.boundingSphereRadius=this.halfExtents.norm()};var k=new b;new b;a.prototype.forEachWorldCorner=function(b,a,c){var d=this.halfExtents;d=[[d.x,d.y,d.z],[-d.x,d.y,d.z],[-d.x,-d.y,d.z],[-d.x,-d.y,-d.z],[d.x,-d.y,-d.z],[d.x,d.y,-d.z],[-d.x,d.y,-d.z],[d.x,-d.y,d.z]];for(var e=0;e<d.length;e++)k.set(d[e][0],d[e][1],d[e][2]),a.vmult(k,k),b.vadd(k,k),c(k.x,k.y,k.z)};var e=[new b,new b,new b,new b,new b,new b,new b,new b];a.prototype.calculateWorldAABB=function(b,a,c,d){var f=this.halfExtents;
e[0].set(f.x,f.y,f.z);e[1].set(-f.x,f.y,f.z);e[2].set(-f.x,-f.y,f.z);e[3].set(-f.x,-f.y,-f.z);e[4].set(f.x,-f.y,-f.z);e[5].set(f.x,f.y,-f.z);e[6].set(-f.x,f.y,-f.z);e[7].set(f.x,-f.y,f.z);var h=e[0];a.vmult(h,h);b.vadd(h,h);d.copy(h);c.copy(h);for(f=1;8>f;f++){h=e[f];a.vmult(h,h);b.vadd(h,h);var g=h.x,k=h.y;h=h.z;g>d.x&&(d.x=g);k>d.y&&(d.y=k);h>d.z&&(d.z=h);g<c.x&&(c.x=g);k<c.y&&(c.y=k);h<c.z&&(c.z=h)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(c,f,g){function a(b,a,
c){d.call(this);this.type=d.types.CONVEXPOLYHEDRON;this.vertices=b||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=a||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=c?c.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3");c("../math/Quaternion");var l=c("../math/Transform");a.prototype=new d;a.prototype.constructor=a;
var k=new b;a.prototype.computeEdges=function(){for(var b=this.faces,a=this.vertices,c=this.uniqueEdges,d=c.length=0;d!==b.length;d++)for(var e=b[d],f=e.length,h=0;h!==f;h++){a[e[h]].vsub(a[e[(h+1)%f]],k);k.normalize();for(var g=!1,l=0;l!==c.length;l++)if(c[l].almostEquals(k)||c[l].almostEquals(k)){g=!0;break}g||c.push(k.clone())}};a.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var a=0;a<this.faces.length;a++){for(var c=0;c<this.faces[a].length;c++)if(!this.vertices[this.faces[a][c]])throw Error("Vertex "+
this.faces[a][c]+" not found!");c=this.faceNormals[a]||new b;this.getFaceNormal(a,c);c.negate(c);this.faceNormals[a]=c;if(0>c.dot(this.vertices[this.faces[a][0]]))for(console.error(".faceNormals["+a+"] = Vec3("+c.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),c=0;c<this.faces[a].length;c++)console.warn(".vertices["+this.faces[a][c]+"] = Vec3("+this.vertices[this.faces[a][c]].toString()+")")}};var e=
new b,h=new b;a.computeNormal=function(b,a,c,d){a.vsub(b,h);c.vsub(a,e);e.cross(h,d);d.isZero()||d.normalize()};a.prototype.getFaceNormal=function(b,c){var d=this.faces[b];return a.computeNormal(this.vertices[d[0]],this.vertices[d[1]],this.vertices[d[2]],c)};var p=new b;a.prototype.clipAgainstHull=function(a,c,d,e,f,h,g,k,l){for(var n=-1,q=-Number.MAX_VALUE,r=0;r<d.faces.length;r++){p.copy(d.faceNormals[r]);f.vmult(p,p);var v=p.dot(h);v>q&&(q=v,n=r)}q=[];r=d.faces[n];v=r.length;for(var t=0;t<v;t++){var E=
d.vertices[r[t]],y=new b;y.copy(E);f.vmult(y,y);e.vadd(y,y);q.push(y)}0<=n&&this.clipFaceAgainstHull(h,a,c,q,g,k,l)};var n=new b,q=new b,t=new b,r=new b,y=new b,u=new b;a.prototype.findSeparatingAxis=function(b,a,c,d,e,f,h,g){var k=Number.MAX_VALUE,l=0;if(this.uniqueAxes)for(v=0;v!==this.uniqueAxes.length;v++){c.vmult(this.uniqueAxes[v],n);E=this.testSepAxis(n,b,a,c,d,e);if(!1===E)return!1;E<k&&(k=E,f.copy(n))}else for(var p=h?h.length:this.faces.length,v=0;v<p;v++){E=h?h[v]:v;n.copy(this.faceNormals[E]);
c.vmult(n,n);var E=this.testSepAxis(n,b,a,c,d,e);if(!1===E)return!1;E<k&&(k=E,f.copy(n))}if(b.uniqueAxes)for(v=0;v!==b.uniqueAxes.length;v++){e.vmult(b.uniqueAxes[v],q);l++;E=this.testSepAxis(q,b,a,c,d,e);if(!1===E)return!1;E<k&&(k=E,f.copy(q))}else for(h=g?g.length:b.faces.length,v=0;v<h;v++){E=g?g[v]:v;q.copy(b.faceNormals[E]);e.vmult(q,q);l++;E=this.testSepAxis(q,b,a,c,d,e);if(!1===E)return!1;E<k&&(k=E,f.copy(q))}for(g=0;g!==this.uniqueEdges.length;g++)for(c.vmult(this.uniqueEdges[g],r),l=0;l!==
b.uniqueEdges.length;l++)if(e.vmult(b.uniqueEdges[l],y),r.cross(y,u),!u.almostZero()){u.normalize();v=this.testSepAxis(u,b,a,c,d,e);if(!1===v)return!1;v<k&&(k=v,f.copy(u))}d.vsub(a,t);0<t.dot(f)&&f.negate(f);return!0};var x=[],w=[];a.prototype.testSepAxis=function(b,c,d,e,f,h){a.project(this,b,d,e,x);a.project(c,b,f,h,w);d=x[0];b=x[1];c=w[0];e=w[1];if(d<e||c<b)return!1;d-=e;b=c-b;return d<b?d:b};var z=new b,A=new b;a.prototype.calculateLocalInertia=function(b,a){this.computeLocalAABB(z,A);var c=A.x-
z.x,d=A.y-z.y,e=A.z-z.z;a.x=1/12*b*(4*d*d+4*e*e);a.y=1/12*b*(4*c*c+4*e*e);a.z=1/12*b*(4*d*d+4*c*c)};a.prototype.getPlaneConstantOfFace=function(b){return-this.faceNormals[b].dot(this.vertices[this.faces[b][0]])};var C=new b,D=new b,G=new b,H=new b,J=new b,L=new b,O=new b,U=new b;a.prototype.clipFaceAgainstHull=function(b,a,c,d,e,f,h){for(var g=[],k=-1,l=Number.MAX_VALUE,n=0;n<this.faces.length;n++){C.copy(this.faceNormals[n]);c.vmult(C,C);var p=C.dot(b);p<l&&(l=p,k=n)}if(!(0>k)){b=this.faces[k];b.connectedFaces=
[];for(l=0;l<this.faces.length;l++)for(n=0;n<this.faces[l].length;n++)-1!==b.indexOf(this.faces[l][n])&&l!==k&&-1===b.connectedFaces.indexOf(l)&&b.connectedFaces.push(l);l=b.length;for(n=0;n<l;n++){p=this.vertices[b[n]];p.vsub(this.vertices[b[(n+1)%l]],D);G.copy(D);c.vmult(G,G);a.vadd(G,G);H.copy(this.faceNormals[k]);c.vmult(H,H);a.vadd(H,H);G.cross(H,J);J.negate(J);L.copy(p);c.vmult(L,L);a.vadd(L,L);L.dot(J);p=b.connectedFaces[n];O.copy(this.faceNormals[p]);p=this.getPlaneConstantOfFace(p);U.copy(O);
c.vmult(U,U);p-=U.dot(a);for(this.clipFaceAgainstPlane(d,g,U,p);d.length;)d.shift();for(;g.length;)d.push(g.shift())}O.copy(this.faceNormals[k]);p=this.getPlaneConstantOfFace(k);U.copy(O);c.vmult(U,U);p-=U.dot(a);for(l=0;l<d.length;l++)a=U.dot(d[l])+p,a<=e&&(console.log("clamped: depth="+a+" to minDist="+(e+"")),a=e),a<=f&&(c=d[l],0>=a&&h.push({point:c,normal:U,depth:a}))}};a.prototype.clipFaceAgainstPlane=function(a,c,d,e){var f=a.length;if(2>f)return c;var h=a[a.length-1];var g=d.dot(h)+e;for(var k=
0;k<f;k++){var l=a[k];var n=d.dot(l)+e;if(0>g){if(0>n){var p=new b;p.copy(l)}else p=new b,h.lerp(l,g/(g-n),p);c.push(p)}else 0>n&&(p=new b,h.lerp(l,g/(g-n),p),c.push(p),c.push(l));h=l;g=n}return c};a.prototype.computeWorldVertices=function(a,c){for(var d=this.vertices.length;this.worldVertices.length<d;)this.worldVertices.push(new b);for(var e=this.vertices,f=this.worldVertices,h=0;h!==d;h++)c.vmult(e[h],f[h]),a.vadd(f[h],f[h]);this.worldVerticesNeedsUpdate=!1};new b;a.prototype.computeLocalAABB=
function(b,a){var c=this.vertices.length,d=this.vertices;b.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);a.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var e=0;e<c;e++){var f=d[e];f.x<b.x?b.x=f.x:f.x>a.x&&(a.x=f.x);f.y<b.y?b.y=f.y:f.y>a.y&&(a.y=f.y);f.z<b.z?b.z=f.z:f.z>a.z&&(a.z=f.z)}};a.prototype.computeWorldFaceNormals=function(a){for(var c=this.faceNormals.length;this.worldFaceNormals.length<c;)this.worldFaceNormals.push(new b);for(var d=this.faceNormals,e=this.worldFaceNormals,
f=0;f!==c;f++)a.vmult(d[f],e[f]);this.worldFaceNormalsNeedsUpdate=!1};a.prototype.updateBoundingSphereRadius=function(){for(var b=0,a=this.vertices,c=0,d=a.length;c!==d;c++){var e=a[c].norm2();e>b&&(b=e)}this.boundingSphereRadius=Math.sqrt(b)};var M=new b;a.prototype.calculateWorldAABB=function(b,a,c,d){for(var e=this.vertices.length,f=this.vertices,h,g,k,l,n,p,q=0;q<e;q++){M.copy(f[q]);a.vmult(M,M);b.vadd(M,M);var v=M;if(v.x<h||void 0===h)h=v.x;else if(v.x>l||void 0===l)l=v.x;if(v.y<g||void 0===
g)g=v.y;else if(v.y>n||void 0===n)n=v.y;if(v.z<k||void 0===k)k=v.z;else if(v.z>p||void 0===p)p=v.z}c.set(h,g,k);d.set(l,n,p)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.prototype.getAveragePointLocal=function(a){a=a||new b;for(var c=this.vertices.length,d=this.vertices,e=0;e<c;e++)a.vadd(d[e],a);a.mult(1/c,a);return a};a.prototype.transformAllPoints=function(b,a){var c=this.vertices.length,d=this.vertices;if(a){for(var e=0;e<c;e++){var f=d[e];a.vmult(f,f)}for(e=
0;e<this.faceNormals.length;e++)f=this.faceNormals[e],a.vmult(f,f)}if(b)for(e=0;e<c;e++)f=d[e],f.vadd(b,f)};var Q=new b,K=new b,E=new b;a.prototype.pointIsInside=function(b){var a=this.vertices,c=this.faces,d=this.faceNormals,e=this.faces.length;this.getAveragePointLocal(Q);for(var f=0;f<e;f++){var h=d[f];var g=a[c[f][0]],k=K;b.vsub(g,k);k=h.dot(k);var l=E;Q.vsub(g,l);h=h.dot(l);if(0>k&&0<h||0<k&&0>h)return!1}return-1};new b;var R=new b,v=new b;a.project=function(b,a,c,d,e){var f=b.vertices.length;
b=b.vertices;v.setZero();l.vectorToLocalFrame(c,d,a,R);l.pointToLocalFrame(c,d,v,v);d=v.dot(R);c=a=b[0].dot(R);for(var h=1;h<f;h++){var g=b[h].dot(R);g>a&&(a=g);g<c&&(c=g)}c-=d;a-=d;c>a&&(f=c,c=a,a=f);e[0]=a;e[1]=c}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(c,f,g){function a(a,c,f,g){var e=[],h=[],k=[],p=[],y=[],u=Math.cos,x=Math.sin;e.push(new b(c*u(0),c*x(0),.5*-f));p.push(0);e.push(new b(a*u(0),a*x(0),.5*f));y.push(1);for(var w=0;w<g;w++){var z=
2*Math.PI/g*(w+1),A=2*Math.PI/g*(w+.5);w<g-1?(e.push(new b(c*u(z),c*x(z),.5*-f)),p.push(2*w+2),e.push(new b(a*u(z),a*x(z),.5*f)),y.push(2*w+3),k.push([2*w+2,2*w+3,2*w+1,2*w])):k.push([0,1,2*w+1,2*w]);(1===g%2||w<g/2)&&h.push(new b(u(A),x(A),0))}k.push(y);h.push(new b(0,0,1));a=[];for(w=0;w<p.length;w++)a.push(p[p.length-w-1]);k.push(a);this.type=d.types.CONVEXPOLYHEDRON;l.call(this,e,k,h)}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3");c("../math/Quaternion");var l=c("./ConvexPolyhedron");a.prototype=
new l},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(c,f,g){function a(a,c){c=k.defaults(c,{maxValue:null,minValue:null,elementSize:1});this.data=a;this.maxValue=c.maxValue;this.minValue=c.minValue;this.elementSize=c.elementSize;null===c.minValue&&this.updateMinValue();null===c.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;d.call(this);this.pillarConvex=new b;this.pillarOffset=new l;this.type=d.types.HEIGHTFIELD;this.updateBoundingSphereRadius();
this._cachedPillars={}}var d=c("./Shape"),b=c("./ConvexPolyhedron"),l=c("../math/Vec3"),k=c("../utils/Utils");f.exports=a;a.prototype=new d;a.prototype.update=function(){this._cachedPillars={}};a.prototype.updateMinValue=function(){for(var b=this.data,a=b[0][0],c=0;c!==b.length;c++)for(var d=0;d!==b[c].length;d++){var f=b[c][d];f<a&&(a=f)}this.minValue=a};a.prototype.updateMaxValue=function(){for(var b=this.data,a=b[0][0],c=0;c!==b.length;c++)for(var d=0;d!==b[c].length;d++){var f=b[c][d];f>a&&(a=
f)}this.maxValue=a};a.prototype.setHeightValueAtIndex=function(b,a,c){this.data[b][a]=c;this.clearCachedConvexTrianglePillar(b,a,!1);0<b&&(this.clearCachedConvexTrianglePillar(b-1,a,!0),this.clearCachedConvexTrianglePillar(b-1,a,!1));0<a&&(this.clearCachedConvexTrianglePillar(b,a-1,!0),this.clearCachedConvexTrianglePillar(b,a-1,!1));0<a&&0<b&&this.clearCachedConvexTrianglePillar(b-1,a-1,!0)};a.prototype.getRectMinMax=function(b,a,c,d,f){f=f||[];for(var e=this.data,h=this.minValue;b<=c;b++)for(var g=
a;g<=d;g++){var k=e[b][g];k>h&&(h=k)}f[0]=this.minValue;f[1]=h};a.prototype.getIndexOfPosition=function(b,a,c,d){var e=this.elementSize,f=this.data;b=Math.floor(b/e);a=Math.floor(a/e);c[0]=b;c[1]=a;d&&(0>b&&(b=0),0>a&&(a=0),b>=f.length-1&&(b=f.length-1),a>=f[0].length-1&&(a=f[0].length-1));return 0>b||0>a||b>=f.length-1||a>=f[0].length-1?!1:!0};a.prototype.getHeightAt=function(b,a,c){var d=[];this.getIndexOfPosition(b,a,d,c);b=[];this.getRectMinMax(d[0],d[1]+1,d[0],d[1]+1,b);return(b[0]+b[1])/2};
a.prototype.getCacheConvexTrianglePillarKey=function(b,a,c){return b+"_"+a+"_"+(c?1:0)};a.prototype.getCachedConvexTrianglePillar=function(b,a,c){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,a,c)]};a.prototype.setCachedConvexTrianglePillar=function(b,a,c,d,f){this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,a,c)]={convex:d,offset:f}};a.prototype.clearCachedConvexTrianglePillar=function(b,a,c){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,a,c)]};a.prototype.getConvexTrianglePillar=
function(a,c,d){var e=this.pillarConvex,f=this.pillarOffset;if(this.cacheEnabled){var h=this.getCachedConvexTrianglePillar(a,c,d);if(h){this.pillarConvex=h.convex;this.pillarOffset=h.offset;return}e=new b;f=new l;this.pillarConvex=e;this.pillarOffset=f}h=this.data;var g=this.elementSize,k=e.faces;e.vertices.length=6;for(var p=0;6>p;p++)e.vertices[p]||(e.vertices[p]=new l);k.length=5;for(p=0;5>p;p++)k[p]||(k[p]=[]);p=e.vertices;var x=(Math.min(h[a][c],h[a+1][c],h[a][c+1],h[a+1][c+1])-this.minValue)/
2+this.minValue;d?(f.set((a+.75)*g,(c+.75)*g,x),p[0].set(.25*g,.25*g,h[a+1][c+1]-x),p[1].set(-.75*g,.25*g,h[a][c+1]-x),p[2].set(.25*g,-.75*g,h[a+1][c]-x),p[3].set(.25*g,.25*g,-x-1),p[4].set(-.75*g,.25*g,-x-1),p[5].set(.25*g,-.75*g,-x-1),k[0][0]=0,k[0][1]=1,k[0][2]=2,k[1][0]=5,k[1][1]=4,k[1][2]=3,k[2][0]=2,k[2][1]=5,k[2][2]=3,k[2][3]=0,k[3][0]=3,k[3][1]=4,k[3][2]=1,k[3][3]=0,k[4][0]=1,k[4][1]=4,k[4][2]=5,k[4][3]=2):(f.set((a+.25)*g,(c+.25)*g,x),p[0].set(-.25*g,-.25*g,h[a][c]-x),p[1].set(.75*g,-.25*
g,h[a+1][c]-x),p[2].set(-.25*g,.75*g,h[a][c+1]-x),p[3].set(-.25*g,-.25*g,-x-1),p[4].set(.75*g,-.25*g,-x-1),p[5].set(-.25*g,.75*g,-x-1),k[0][0]=0,k[0][1]=1,k[0][2]=2,k[1][0]=5,k[1][1]=4,k[1][2]=3,k[2][0]=0,k[2][1]=2,k[2][2]=5,k[2][3]=3,k[3][0]=1,k[3][1]=0,k[3][2]=3,k[3][3]=4,k[4][0]=4,k[4][1]=5,k[4][2]=2,k[4][3]=1);e.computeNormals();e.computeEdges();e.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(a,c,d,e,f)};a.prototype.calculateLocalInertia=function(b,a){a=a||new l;a.set(0,0,0);
return a};a.prototype.volume=function(){return Number.MAX_VALUE};a.prototype.calculateWorldAABB=function(b,a,c,d){c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);d.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};a.prototype.updateBoundingSphereRadius=function(){var b=this.data,a=this.elementSize;this.boundingSphereRadius=(new l(b.length*a,b[0].length*a,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,
"./Shape":43}],41:[function(c,f,g){function a(){d.call(this);this.type=d.types.PARTICLE}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3");a.prototype=new d;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(a,c){c=c||new b;c.set(0,0,0);return c};a.prototype.volume=function(){return 0};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};a.prototype.calculateWorldAABB=function(b,a,c,d){c.copy(b);d.copy(b)}},{"../math/Vec3":30,"./Shape":43}],42:[function(c,
f,g){function a(){d.call(this);this.type=d.types.PLANE;this.worldNormal=new b;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3");a.prototype=new d;a.prototype.constructor=a;a.prototype.computeWorldNormal=function(b){var a=this.worldNormal;a.set(0,0,1);b.vmult(a,a);this.worldNormalNeedsUpdate=!1};a.prototype.calculateLocalInertia=function(a,c){return c=c||new b};a.prototype.volume=function(){return Number.MAX_VALUE};var l=new b;
a.prototype.calculateWorldAABB=function(b,a,c,d){l.set(0,0,1);a.vmult(l,l);a=Number.MAX_VALUE;c.set(-a,-a,-a);d.set(a,a,a);1===l.x&&(d.x=b.x);1===l.y&&(d.y=b.y);1===l.z&&(d.z=b.z);-1===l.x&&(c.x=b.x);-1===l.y&&(c.y=b.y);-1===l.z&&(c.z=b.z)};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(c,f,g){function a(){this.id=a.idCounter++;this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=
null}f.exports=a;a=c("./Shape");c("../math/Vec3");c("../math/Quaternion");c("../material/Material");a.prototype.constructor=a;a.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};a.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};a.prototype.calculateLocalInertia=function(a,b){throw"calculateLocalInertia() not implemented for shape type "+this.type;};a.idCounter=0;a.types={SPHERE:1,
PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(c,f,g){function a(b){d.call(this);this.radius=void 0!==b?Number(b):1;this.type=d.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3");a.prototype=new d;a.prototype.constructor=a;a.prototype.calculateLocalInertia=
function(a,c){c=c||new b;var d=2*a*this.radius*this.radius/5;c.x=d;c.y=d;c.z=d;return c};a.prototype.volume=function(){return 4*Math.PI*this.radius/3};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};a.prototype.calculateWorldAABB=function(b,a,c,d){a=this.radius;for(var e=["x","y","z"],f=0;f<e.length;f++){var h=e[f];c[h]=b[h]-a;d[h]=b[h]+a}}},{"../math/Vec3":30,"./Shape":43}],45:[function(c,f,g){function a(a,c){d.call(this);this.type=d.types.TRIMESH;this.vertices=
new Float32Array(a);this.indices=new Int16Array(c);this.normals=new Float32Array(c.length);this.aabb=new k;this.edges=null;this.scale=new b(1,1,1);this.tree=new e;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}f.exports=a;var d=c("./Shape"),b=c("../math/Vec3");c("../math/Quaternion");var l=c("../math/Transform"),k=c("../collision/AABB"),e=c("../utils/Octree");a.prototype=new d;a.prototype.constructor=a;var h=new b;a.prototype.updateTree=
function(){var a=this.tree;a.reset();a.aabb.copy(this.aabb);var c=this.scale;a.aabb.lowerBound.x*=1/c.x;a.aabb.lowerBound.y*=1/c.y;a.aabb.lowerBound.z*=1/c.z;a.aabb.upperBound.x*=1/c.x;a.aabb.upperBound.y*=1/c.y;a.aabb.upperBound.z*=1/c.z;c=new k;for(var d=new b,e=new b,f=new b,h=[d,e,f],g=0;g<this.indices.length/3;g++){var l=3*g;this._getUnscaledVertex(this.indices[l],d);this._getUnscaledVertex(this.indices[l+1],e);this._getUnscaledVertex(this.indices[l+2],f);c.setFromPoints(h);a.insert(c,g)}a.removeEmptyNodes()};
var p=new k;a.prototype.getTrianglesInAABB=function(b,a){p.copy(b);var c=this.scale,d=c.x,e=c.y;c=c.z;var f=p.lowerBound,h=p.upperBound;f.x/=d;f.y/=e;f.z/=c;h.x/=d;h.y/=e;h.z/=c;return this.tree.aabbQuery(p,a)};a.prototype.setScale=function(b){var a=b.x===b.y===b.z;this.scale.x===this.scale.y===this.scale.z&&a||this.updateNormals();this.scale.copy(b);this.updateAABB();this.updateBoundingSphereRadius()};a.prototype.updateNormals=function(){for(var b=this.normals,c=0;c<this.indices.length/3;c++){var d=
3*c,e=this.indices[d+1],f=this.indices[d+2];this.getVertex(this.indices[d],y);this.getVertex(e,u);this.getVertex(f,x);a.computeNormal(u,y,x,h);b[d]=h.x;b[d+1]=h.y;b[d+2]=h.z}};a.prototype.updateEdges=function(){for(var b={},a=function(a,c){b[e<f?e+"_"+f:f+"_"+e]=!0},c=0;c<this.indices.length/3;c++){var d=3*c,e=this.indices[d],f=this.indices[d+1];d=this.indices[d+2];a(e,f);a(f,d);a(d,e)}a=Object.keys(b);this.edges=new Int16Array(2*a.length);for(c=0;c<a.length;c++)d=a[c].split("_"),this.edges[2*c]=
parseInt(d[0],10),this.edges[2*c+1]=parseInt(d[1],10)};a.prototype.getEdgeVertex=function(b,a,c){this.getVertex(this.edges[2*b+(a?1:0)],c)};var n=new b,q=new b;a.prototype.getEdgeVector=function(b,a){this.getEdgeVertex(b,0,n);this.getEdgeVertex(b,1,q);q.vsub(n,a)};var t=new b,r=new b;a.computeNormal=function(b,a,c,d){a.vsub(b,r);c.vsub(a,t);t.cross(r,d);d.isZero()||d.normalize()};var y=new b,u=new b,x=new b;a.prototype.getVertex=function(b,a){var c=this.scale;this._getUnscaledVertex(b,a);a.x*=c.x;
a.y*=c.y;a.z*=c.z;return a};a.prototype._getUnscaledVertex=function(a,b){var c=3*a,d=this.vertices;return b.set(d[c],d[c+1],d[c+2])};a.prototype.getWorldVertex=function(a,b,c,d){this.getVertex(a,d);l.pointToWorldFrame(b,c,d,d);return d};a.prototype.getTriangleVertices=function(a,b,c,d){a*=3;this.getVertex(this.indices[a],b);this.getVertex(this.indices[a+1],c);this.getVertex(this.indices[a+2],d)};a.prototype.getNormal=function(a,b){var c=3*a;return b.set(this.normals[c],this.normals[c+1],this.normals[c+
2])};var w=new k;a.prototype.calculateLocalInertia=function(a,b){this.computeLocalAABB(w);var c=w.upperBound.x-w.lowerBound.x,d=w.upperBound.y-w.lowerBound.y,e=w.upperBound.z-w.lowerBound.z;return b.set(1/12*a*(4*d*d+4*e*e),1/12*a*(4*c*c+4*e*e),1/12*a*(4*d*d+4*c*c))};var z=new b;a.prototype.computeLocalAABB=function(a){var b=a.lowerBound;a=a.upperBound;var c=this.vertices.length;this.getVertex(0,z);b.copy(z);a.copy(z);for(var d=0;d!==c;d++)this.getVertex(d,z),z.x<b.x?b.x=z.x:z.x>a.x&&(a.x=z.x),z.y<
b.y?b.y=z.y:z.y>a.y&&(a.y=z.y),z.z<b.z?b.z=z.z:z.z>a.z&&(a.z=z.z)};a.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};a.prototype.updateBoundingSphereRadius=function(){var a=0,c=this.vertices,d=new b,e=0;for(c=c.length/3;e!==c;e++){this.getVertex(e,d);var f=d.norm2();f>a&&(a=f)}this.boundingSphereRadius=Math.sqrt(a)};new b;var A=new l,C=new k;a.prototype.calculateWorldAABB=function(a,b,c,d){A.position=a;A.quaternion=b;this.aabb.toWorldFrame(A,C);c.copy(C.lowerBound);d.copy(C.upperBound)};
a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.createTorus=function(b,c,d,e,f){b=b||1;c=c||.5;d=d||8;e=e||6;f=f||2*Math.PI;for(var h=[],g=[],k=0;k<=d;k++)for(var l=0;l<=e;l++){var n=l/e*f,p=k/d*Math.PI*2;h.push((b+c*Math.cos(p))*Math.cos(n),(b+c*Math.cos(p))*Math.sin(n),c*Math.sin(p))}for(k=1;k<=d;k++)for(l=1;l<=e;l++)b=(e+1)*(k-1)+l-1,c=(e+1)*(k-1)+l,f=(e+1)*k+l,g.push((e+1)*k+l-1,b,f),g.push(b,c,f);return new a(h,g)}},{"../collision/AABB":3,"../math/Quaternion":28,
"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(c,f,g){function a(){d.call(this);this.iterations=10;this.tolerance=1E-7}f.exports=a;c("../math/Vec3");c("../math/Quaternion");var d=c("./Solver");a.prototype=new d;var b=[],l=[],k=[];a.prototype.solve=function(a,c){var d=0,e=this.iterations,f=this.tolerance*this.tolerance,h=this.equations,g=h.length,y=c.bodies,u=y.length,x;if(0!==g)for(x=0;x!==u;x++)y[x].updateSolveMassProperties();l.length=g;k.length=g;b.length=
g;for(x=0;x!==g;x++){var w=h[x];b[x]=0;k[x]=w.computeB(a);l[x]=1/w.computeC()}if(0!==g){for(x=0;x!==u;x++)w=y[x],d=w.wlambda,w.vlambda.set(0,0,0),d&&d.set(0,0,0);for(d=0;d!==e;d++){for(var z=x=0;z!==g;z++){w=h[z];var A=k[z];var C=l[z];var D=b[z];var G=w.computeGWlambda();A=C*(A-G-w.eps*D);D+A<w.minForce?A=w.minForce-D:D+A>w.maxForce&&(A=w.maxForce-D);b[z]+=A;x+=0<A?A:-A;w.addToWlambda(A)}if(x*x<f)break}for(x=0;x!==u;x++)w=y[x],e=w.velocity,f=w.angularVelocity,e.vadd(w.vlambda,e),f&&f.vadd(w.wlambda,
f)}return d}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(c,f,g){function a(){this.equations=[]}f.exports=a;a.prototype.solve=function(a,b){return 0};a.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)};a.prototype.removeEquation=function(a){var b=this.equations;a=b.indexOf(a);-1!==a&&b.splice(a,1)};a.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(c,f,g){function a(a){k.call(this);this.iterations=10;this.tolerance=1E-7;
this.subsolver=a;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function d(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!(d.visited||d.body.type&n))return d}return!1}function b(a,b,c){b.push(a.body);b=a.eqs.length;for(var d=0;d!==b;d++){var e=a.eqs[d];-1===c.indexOf(e)&&c.push(e)}}function l(a,b){return b.id-a.id}f.exports=a;c("../math/Vec3");c("../math/Quaternion");var k=c("./Solver");c=c("../objects/Body");a.prototype=new k;var e=[],h=[],
p={bodies:[]},n=c.STATIC,q=[];a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};a.prototype.solve=function(a,c){for(var f=this.nodePool,g=c.bodies,k=this.equations,n=k.length,r=g.length,t=this.subsolver;f.length<r;)f.push(this.createNode());e.length=r;for(var C=0;C<r;C++)e[C]=f[C];for(C=0;C!==r;C++)f=e[C],f.body=g[C],f.children.length=0,f.eqs.length=0,f.visited=!1;for(r=0;r!==n;r++){f=k[r];C=g.indexOf(f.bi);var D=g.indexOf(f.bj);C=e[C];D=e[D];C.children.push(D);C.eqs.push(f);
D.children.push(C);D.eqs.push(f)}g=0;k=h;t.tolerance=this.tolerance;for(t.iterations=this.iterations;C=d(e);){k.length=0;p.bodies.length=0;f=C;C=b;n=p.bodies;r=k;q.push(f);f.visited=!0;for(C(f,n,r);q.length;)for(f=q.pop();D=d(f.children);)D.visited=!0,C(D,n,r),q.push(D);n=k.length;k=k.sort(l);for(C=0;C!==n;C++)t.addEquation(k[C]);t.solve(a,p);t.removeAllEquations();g++}return g}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(c,f,g){c=function(){};f.exports=
c;c.prototype={constructor:c,addEventListener:function(a,c){void 0===this._listeners&&(this._listeners={});var b=this._listeners;void 0===b[a]&&(b[a]=[]);-1===b[a].indexOf(c)&&b[a].push(c);return this},hasEventListener:function(a,c){if(void 0===this._listeners)return!1;var b=this._listeners;return void 0!==b[a]&&-1!==b[a].indexOf(c)?!0:!1},removeEventListener:function(a,c){if(void 0===this._listeners)return this;var b=this._listeners;if(void 0===b[a])return this;var d=b[a].indexOf(c);-1!==d&&b[a].splice(d,
1);return this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var c=this._listeners[a.type];if(void 0!==c){a.target=this;for(var b=0,f=c.length;b<f;b++)c[b].call(this,a)}return this}}},{}],50:[function(c,f,g){function a(a){a=a||{};this.root=a.root||null;this.aabb=a.aabb?a.aabb.clone():new b;this.data=[];this.children=[]}function d(b,c){c=c||{};c.root=null;c.aabb=b;a.call(this,c);this.maxDepth="undefined"!==typeof c.maxDepth?c.maxDepth:8}var b=c("../collision/AABB"),l=c("../math/Vec3");
f.exports=d;d.prototype=new a;a.prototype.reset=function(a,b){this.children.length=this.data.length=0};a.prototype.insert=function(a,b,c){var d=this.data;c=c||0;if(!this.aabb.contains(a))return!1;var f=this.children;if(c<(this.maxDepth||this.root.maxDepth)){var e=!1;f.length||(this.subdivide(),e=!0);for(var g=0;8!==g;g++)if(f[g].insert(a,b,c+1))return!0;e&&(f.length=0)}d.push(b);return!0};var k=new l;a.prototype.subdivide=function(){var c=this.aabb,d=c.lowerBound,f=c.upperBound;c=this.children;c.push(new a({aabb:new b({lowerBound:new l(0,
0,0)})}),new a({aabb:new b({lowerBound:new l(1,0,0)})}),new a({aabb:new b({lowerBound:new l(1,1,0)})}),new a({aabb:new b({lowerBound:new l(1,1,1)})}),new a({aabb:new b({lowerBound:new l(0,1,1)})}),new a({aabb:new b({lowerBound:new l(0,0,1)})}),new a({aabb:new b({lowerBound:new l(1,0,1)})}),new a({aabb:new b({lowerBound:new l(0,1,0)})}));f.vsub(d,k);k.scale(.5,k);f=this.root||this;for(var e=0;8!==e;e++){var g=c[e];g.root=f;var r=g.aabb.lowerBound;r.x*=k.x;r.y*=k.y;r.z*=k.z;r.vadd(d,r);r.vadd(k,g.aabb.upperBound)}};
a.prototype.aabbQuery=function(a,b){for(var c=[this];c.length;){var d=c.pop();d.aabb.overlaps(a)&&Array.prototype.push.apply(b,d.data);Array.prototype.push.apply(c,d.children)}return b};var e=new b;a.prototype.rayQuery=function(a,b,c){a.getAABB(e);e.toLocalFrame(b,e);this.aabbQuery(e,c);return c};a.prototype.removeEmptyNodes=function(){for(var a=[this];a.length;){for(var b=a.pop(),c=b.children.length-1;0<=c;c--)b.children[c].data.length||b.children.splice(c,1);Array.prototype.push.apply(a,b.children)}}},
{"../collision/AABB":3,"../math/Vec3":30}],51:[function(c,f,g){function a(){this.objects=[];this.type=Object}f.exports=a;a.prototype.release=function(){for(var a=arguments.length,b=0;b!==a;b++)this.objects.push(arguments[b])};a.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};a.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(c,f,g){function a(){this.data={keys:[]}}
f.exports=a;a.prototype.get=function(a,b){if(a>b){var c=b;b=a;a=c}return this.data[a+"-"+b]};a.prototype.set=function(a,b,c){if(a>b){var d=b;b=a;a=d}d=a+"-"+b;this.get(a,b)||this.data.keys.push(d);this.data[d]=c};a.prototype.reset=function(){for(var a=this.data,b=a.keys;0<b.length;){var c=b.pop();delete a[c]}}},{}],53:[function(c,f,g){function a(){}f.exports=a;a.defaults=function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a}},{}],54:[function(c,f,g){function a(){b.call(this);this.type=
d}f.exports=a;var d=c("../math/Vec3"),b=c("./Pool");a.prototype=new b;a.prototype.constructObject=function(){return new d}},{"../math/Vec3":30,"./Pool":51}],55:[function(c,f,g){function a(a){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new e;this.world=a;this.currentContactMaterial=null;this.enableFrictionReduction=!1}f.exports=a;f=c("../collision/AABB");g=c("../shapes/Shape");var d=c("../collision/Ray"),b=c("../math/Vec3"),l=c("../math/Transform");
c("../shapes/ConvexPolyhedron");var k=c("../math/Quaternion");c("../solver/Solver");var e=c("../utils/Vec3Pool"),h=c("../equations/ContactEquation"),p=c("../equations/FrictionEquation");a.prototype.createContactEquation=function(a,b,c,d,f,e){if(this.contactPointPool.length){var g=this.contactPointPool.pop();g.bi=a;g.bj=b}else g=new h(a,b);g.enabled=a.collisionResponse&&b.collisionResponse&&c.collisionResponse&&d.collisionResponse;var k=this.currentContactMaterial;g.restitution=k.restitution;g.setSpookParams(k.contactEquationStiffness,
k.contactEquationRelaxation,this.world.dt);a=c.material||a.material;b=d.material||b.material;a&&b&&0<=a.restitution&&0<=b.restitution&&(g.restitution=a.restitution*b.restitution);g.si=f||c;g.sj=e||d;return g};a.prototype.createFrictionEquationsFromContact=function(a,b){var c=a.bi,d=a.bj,f=this.world,e=this.currentContactMaterial,g=e.friction,h=a.si.material||c.material,k=a.sj.material||d.material;h&&k&&0<=h.friction&&0<=k.friction&&(g=h.friction*k.friction);if(0<g){g*=f.gravity.length();h=c.invMass+
d.invMass;0<h&&(h=1/h);var l=this.frictionEquationPool;k=l.length?l.pop():new p(c,d,g*h);l=l.length?l.pop():new p(c,d,g*h);k.bi=l.bi=c;k.bj=l.bj=d;k.minForce=l.minForce=-g*h;k.maxForce=l.maxForce=g*h;k.ri.copy(a.ri);k.rj.copy(a.rj);l.ri.copy(a.ri);l.rj.copy(a.rj);a.ni.tangents(k.t,l.t);k.setSpookParams(e.frictionEquationStiffness,e.frictionEquationRelaxation,f.dt);l.setSpookParams(e.frictionEquationStiffness,e.frictionEquationRelaxation,f.dt);k.enabled=l.enabled=a.enabled;b.push(k,l);return!0}return!1};
var n=new b,q=new b,t=new b;a.prototype.createFrictionFromAverage=function(a){var b=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(b,this.frictionResult)&&1!==a){var c=this.frictionResult[this.frictionResult.length-2],d=this.frictionResult[this.frictionResult.length-1];n.setZero();q.setZero();t.setZero();for(var f=b.bi,e=0;e!==a;e++)b=this.result[this.result.length-1-e],b.bodyA!==f?(n.vadd(b.ni,n),q.vadd(b.ri,q),t.vadd(b.rj,t)):(n.vsub(b.ni,n),q.vadd(b.rj,q),t.vadd(b.ri,
t));a=1/a;q.scale(a,c.ri);t.scale(a,c.rj);d.ri.copy(c.ri);d.rj.copy(c.rj);n.normalize();n.tangents(c.t,d.t)}};var r=new b,y=new b,u=new k,x=new k;a.prototype.getContacts=function(a,b,c,d,e,f,g){this.contactPointPool=e;this.frictionEquationPool=g;this.result=d;this.frictionResult=f;d=0;for(e=a.length;d!==e;d++){f=a[d];g=b[d];var h=null;f.material&&g.material&&(h=c.getContactMaterial(f.material,g.material)||null);for(var k=0;k<f.shapes.length;k++){f.quaternion.mult(f.shapeOrientations[k],u);f.quaternion.vmult(f.shapeOffsets[k],
r);r.vadd(f.position,r);for(var l=f.shapes[k],n=0;n<g.shapes.length;n++){g.quaternion.mult(g.shapeOrientations[n],x);g.quaternion.vmult(g.shapeOffsets[n],y);y.vadd(g.position,y);var p=g.shapes[n];if(!(r.distanceTo(y)>l.boundingSphereRadius+p.boundingSphereRadius)){var q=null;l.material&&p.material&&(q=c.getContactMaterial(l.material,p.material)||null);this.currentContactMaterial=q||h||c.defaultContactMaterial;(q=this[l.type|p.type])&&(l.type<p.type?q.call(this,l,p,r,y,u,x,f,g,l,p):q.call(this,p,l,
y,r,x,u,g,f,l,p))}}}}};a.prototype[g.types.BOX|g.types.BOX]=a.prototype.boxBox=function(a,b,c,d,f,e,g,h){a.convexPolyhedronRepresentation.material=a.material;b.convexPolyhedronRepresentation.material=b.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.convexConvex(a.convexPolyhedronRepresentation,b.convexPolyhedronRepresentation,c,d,f,e,g,h,a,b)};a.prototype[g.types.BOX|g.types.CONVEXPOLYHEDRON]=
a.prototype.boxConvex=function(a,b,c,d,f,e,g,h){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexConvex(a.convexPolyhedronRepresentation,b,c,d,f,e,g,h,a,b)};a.prototype[g.types.BOX|g.types.PARTICLE]=a.prototype.boxParticle=function(a,b,c,d,f,e,g,h){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexParticle(a.convexPolyhedronRepresentation,
b,c,d,f,e,g,h,a,b)};a.prototype[g.types.SPHERE]=a.prototype.sphereSphere=function(a,b,c,d,f,e,g,h){f=this.createContactEquation(g,h,a,b);d.vsub(c,f.ni);f.ni.normalize();f.ri.copy(f.ni);f.rj.copy(f.ni);f.ri.mult(a.radius,f.ri);f.rj.mult(-b.radius,f.rj);f.ri.vadd(c,f.ri);f.ri.vsub(g.position,f.ri);f.rj.vadd(d,f.rj);f.rj.vsub(h.position,f.rj);this.result.push(f);this.createFrictionEquationsFromContact(f,this.frictionResult)};var w=new b,z=new b,A=new b;a.prototype[g.types.PLANE|g.types.TRIMESH]=a.prototype.planeTrimesh=
function(a,c,d,f,e,g,h,k){var n=new b;w.set(0,0,1);e.vmult(w,w);for(e=0;e<c.vertices.length/3;e++){c.getVertex(e,n);var p=new b;p.copy(n);l.pointToWorldFrame(f,g,p,n);p=z;n.vsub(d,p);if(0>=w.dot(p)){var q=this.createContactEquation(h,k,a,c);q.ni.copy(w);var v=A;w.scale(p.dot(w),v);n.vsub(v,v);q.ri.copy(v);q.ri.vsub(h.position,q.ri);q.rj.copy(n);q.rj.vsub(k.position,q.rj);this.result.push(q);this.createFrictionEquationsFromContact(q,this.frictionResult)}}};var C=new b,D=new b;new b;var G=new b,H=new b,
J=new b,L=new b,O=new b,U=new b,M=new b,Q=new b,K=new b,E=new b,R=new b,v=new f,I=[];a.prototype[g.types.SPHERE|g.types.TRIMESH]=a.prototype.sphereTrimesh=function(a,b,c,f,e,g,h,k){l.pointToLocalFrame(f,g,c,M);e=a.radius;v.lowerBound.set(M.x-e,M.y-e,M.z-e);v.upperBound.set(M.x+e,M.y+e,M.z+e);b.getTrianglesInAABB(v,I);var n=a.radius*a.radius;for(e=0;e<I.length;e++)for(var p=0;3>p;p++)if(b.getVertex(b.indices[3*I[e]+p],G),G.vsub(M,D),D.norm2()<=n){H.copy(G);l.pointToWorldFrame(f,g,H,G);G.vsub(c,D);
var q=this.createContactEquation(h,k,a,b);q.ni.copy(D);q.ni.normalize();q.ri.copy(q.ni);q.ri.scale(a.radius,q.ri);q.ri.vadd(c,q.ri);q.ri.vsub(h.position,q.ri);q.rj.copy(G);q.rj.vsub(k.position,q.rj);this.result.push(q);this.createFrictionEquationsFromContact(q,this.frictionResult)}for(e=0;e<I.length;e++)for(p=0;3>p;p++)b.getVertex(b.indices[3*I[e]+p],J),b.getVertex(b.indices[3*I[e]+(p+1)%3],L),L.vsub(J,O),M.vsub(L,Q),c=Q.dot(O),M.vsub(J,Q),q=Q.dot(O),0<q&&0>c&&(M.vsub(J,Q),U.copy(O),U.normalize(),
q=Q.dot(U),U.scale(q,Q),Q.vadd(J,Q),c=Q.distanceTo(M),c<a.radius&&(q=this.createContactEquation(h,k,a,b),Q.vsub(M,q.ni),q.ni.normalize(),q.ni.scale(a.radius,q.ri),l.pointToWorldFrame(f,g,Q,Q),Q.vsub(k.position,q.rj),l.vectorToWorldFrame(g,q.ni,q.ni),l.vectorToWorldFrame(g,q.ri,q.ri),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult)));e=0;for(p=I.length;e!==p;e++)b.getTriangleVertices(I[e],K,E,R),b.getNormal(I[e],C),M.vsub(K,Q),c=Q.dot(C),C.scale(c,Q),M.vsub(Q,Q),c=
Q.distanceTo(M),d.pointInTriangle(Q,K,E,R)&&c<a.radius&&(q=this.createContactEquation(h,k,a,b),Q.vsub(M,q.ni),q.ni.normalize(),q.ni.scale(a.radius,q.ri),l.pointToWorldFrame(f,g,Q,Q),Q.vsub(k.position,q.rj),l.vectorToWorldFrame(g,q.ni,q.ni),l.vectorToWorldFrame(g,q.ri,q.ri),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult));I.length=0};var V=new b,S=new b;a.prototype[g.types.SPHERE|g.types.PLANE]=a.prototype.spherePlane=function(a,b,c,d,f,e,g,h){b=this.createContactEquation(g,
h,a,b);b.ni.set(0,0,1);e.vmult(b.ni,b.ni);b.ni.negate(b.ni);b.ni.normalize();b.ni.mult(a.radius,b.ri);c.vsub(d,V);b.ni.mult(b.ni.dot(V),S);V.vsub(S,b.rj);-V.dot(b.ni)<=a.radius&&(a=b.ri,e=b.rj,a.vadd(c,a),a.vsub(g.position,a),e.vadd(d,e),e.vsub(h.position,e),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult))};var N=new b,B=new b,P=new b,T=new b,F=new b,W=new b,Y=new b,X=[new b,new b,new b,new b,new b,new b],aa=new b,Z=new b,ha=new b,na=new b;a.prototype[g.types.SPHERE|
g.types.BOX]=a.prototype.sphereBox=function(a,b,c,d,f,e,g,h){f=this.v3pool;c.vsub(d,T);b.getSideNormals(X,e);e=a.radius;for(var k=!1,l=null,n=0,p=0,q=0,v=null,r=0,E=X.length;r!==E&&!1===k;r++){var t=F;t.copy(X[r]);var u=t.norm();t.normalize();var w=T.dot(t);if(w<u+e&&0<w){var y=W,x=Y;y.copy(X[(r+1)%3]);x.copy(X[(r+2)%3]);var H=y.norm(),R=x.norm();y.normalize();x.normalize();var I=T.dot(y),B=T.dot(x);I<H&&I>-H&&B<R&&B>-R&&(w=Math.abs(w-u-e),null===v||w<v)&&(v=w,p=I,q=B,l=u,Z.copy(t),ha.copy(y),na.copy(x),
n++)}}n&&(k=!0,n=this.createContactEquation(g,h,a,b),Z.mult(-e,n.ri),n.ni.copy(Z),n.ni.negate(n.ni),Z.mult(l,Z),ha.mult(p,ha),Z.vadd(ha,Z),na.mult(q,na),Z.vadd(na,n.rj),n.ri.vadd(c,n.ri),n.ri.vsub(g.position,n.ri),n.rj.vadd(d,n.rj),n.rj.vsub(h.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult));w=f.get();for(l=0;2!==l&&!k;l++)for(p=0;2!==p&&!k;p++)for(q=0;2!==q&&!k;q++)w.set(0,0,0),l?w.vadd(X[0],w):w.vsub(X[0],w),p?w.vadd(X[1],w):w.vsub(X[1],w),q?w.vadd(X[2],
w):w.vsub(X[2],w),d.vadd(w,aa),aa.vsub(c,aa),aa.norm2()<e*e&&(k=!0,n=this.createContactEquation(g,h,a,b),n.ri.copy(aa),n.ri.normalize(),n.ni.copy(n.ri),n.ri.mult(e,n.ri),n.rj.copy(w),n.ri.vadd(c,n.ri),n.ri.vsub(g.position,n.ri),n.rj.vadd(d,n.rj),n.rj.vsub(h.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult));f.release(w);v=f.get();r=f.get();n=f.get();E=f.get();w=f.get();t=X.length;for(l=0;l!==t&&!k;l++)for(p=0;p!==t&&!k;p++)if(l%3!==p%3){X[p].cross(X[l],
v);v.normalize();X[l].vadd(X[p],r);n.copy(c);n.vsub(r,n);n.vsub(d,n);u=n.dot(v);v.mult(u,E);for(q=0;q===l%3||q===p%3;)q++;w.copy(c);w.vsub(E,w);w.vsub(r,w);w.vsub(d,w);u=Math.abs(u);y=w.norm();u<X[q].norm()&&y<e&&(k=!0,q=this.createContactEquation(g,h,a,b),r.vadd(E,q.rj),q.rj.copy(q.rj),w.negate(q.ni),q.ni.normalize(),q.ri.copy(q.rj),q.ri.vadd(d,q.ri),q.ri.vsub(c,q.ri),q.ri.normalize(),q.ri.mult(e,q.ri),q.ri.vadd(c,q.ri),q.ri.vsub(g.position,q.ri),q.rj.vadd(d,q.rj),q.rj.vsub(h.position,q.rj),this.result.push(q),
this.createFrictionEquationsFromContact(q,this.frictionResult))}f.release(v,r,n,E,w)};var xa=new b,ya=new b,za=new b,Aa=new b,Ba=new b,Ca=new b,Da=new b,Ea=new b,Fa=new b,Ga=new b;a.prototype[g.types.SPHERE|g.types.CONVEXPOLYHEDRON]=a.prototype.sphereConvex=function(a,b,c,d,f,e,g,h){f=this.v3pool;c.vsub(d,xa);for(var k=b.faceNormals,l=b.faces,n=b.vertices,q=a.radius,p=0;p!==n.length;p++){var v=Ba;e.vmult(n[p],v);d.vadd(v,v);var r=Aa;v.vsub(c,r);if(r.norm2()<q*q){a=this.createContactEquation(g,h,a,
b);a.ri.copy(r);a.ri.normalize();a.ni.copy(a.ri);a.ri.mult(q,a.ri);v.vsub(d,a.rj);a.ri.vadd(c,a.ri);a.ri.vsub(g.position,a.ri);a.rj.vadd(d,a.rj);a.rj.vsub(h.position,a.rj);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);return}}p=0;for(v=l.length;p!==v;p++){r=l[p];var E=Ca;e.vmult(k[p],E);var t=Da;e.vmult(n[r[0]],t);t.vadd(d,t);var w=Ea;E.mult(-q,w);c.vadd(w,w);var u=Fa;w.vsub(t,u);w=u.dot(E);u=Ga;c.vsub(t,u);if(0>w&&0<u.dot(E)){t=[];u=0;for(var y=r.length;u!==y;u++){var x=
f.get();e.vmult(n[r[u]],x);d.vadd(x,x);t.push(x)}a:{u=t;y=E;x=c;for(var H=null,I=u.length,R=0;R!==I;R++){var J=u[R],z=N;u[(R+1)%I].vsub(J,z);var M=B;z.cross(y,M);z=P;x.vsub(J,z);J=M.dot(z);if(null===H||0<J&&!0===H||0>=J&&!1===H)null===H&&(H=0<J);else{u=!1;break a}}u=!0}if(u){a=this.createContactEquation(g,h,a,b);E.mult(-q,a.ri);E.negate(a.ni);b=f.get();E.mult(-w,b);e=f.get();E.mult(-q,e);c.vsub(d,a.rj);a.rj.vadd(e,a.rj);a.rj.vadd(b,a.rj);a.rj.vadd(d,a.rj);a.rj.vsub(h.position,a.rj);a.ri.vadd(c,a.ri);
a.ri.vsub(g.position,a.ri);f.release(b);f.release(e);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);u=0;for(r=t.length;u!==r;u++)f.release(t[u]);break}else for(u=0;u!==r.length;u++){E=f.get();w=f.get();e.vmult(n[r[(u+1)%r.length]],E);e.vmult(n[r[(u+2)%r.length]],w);d.vadd(E,E);d.vadd(w,w);I=ya;w.vsub(E,I);H=za;I.unit(H);y=f.get();x=f.get();c.vsub(E,x);R=x.dot(H);H.mult(R,y);y.vadd(E,y);H=f.get();y.vsub(c,H);if(0<R&&R*R<I.norm2()&&H.norm2()<q*q){a=this.createContactEquation(g,
h,a,b);y.vsub(d,a.rj);y.vsub(c,a.ni);a.ni.normalize();a.ni.mult(q,a.ri);a.rj.vadd(d,a.rj);a.rj.vsub(h.position,a.rj);a.ri.vadd(c,a.ri);a.ri.vsub(g.position,a.ri);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);u=0;for(r=t.length;u!==r;u++)f.release(t[u]);f.release(E);f.release(w);f.release(y);f.release(H);f.release(x);return}f.release(E);f.release(w);f.release(y);f.release(H);f.release(x)}u=0;for(r=t.length;u!==r;u++)f.release(t[u])}}};new b;new b;a.prototype[g.types.PLANE|
g.types.BOX]=a.prototype.planeBox=function(a,b,c,d,f,e,g,h){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.planeConvex(a,b.convexPolyhedronRepresentation,c,d,f,e,g,h)};var ba=new b,ca=new b,qa=new b,Ha=new b;a.prototype[g.types.PLANE|g.types.CONVEXPOLYHEDRON]=a.prototype.planeConvex=function(a,b,c,d,f,e,g,h){ca.set(0,0,1);f.vmult(ca,ca);for(var k=f=0;k!==b.vertices.length;k++)if(ba.copy(b.vertices[k]),e.vmult(ba,ba),
d.vadd(ba,ba),ba.vsub(c,qa),0>=ca.dot(qa)){var l=this.createContactEquation(g,h,a,b),n=Ha;ca.mult(ca.dot(qa),n);ba.vsub(n,n);n.vsub(c,l.ri);l.ni.copy(ca);ba.vsub(d,l.rj);l.ri.vadd(c,l.ri);l.ri.vsub(g.position,l.ri);l.rj.vadd(d,l.rj);l.rj.vsub(h.position,l.rj);this.result.push(l);f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(l,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)};var ra=new b,oa=new b;a.prototype[g.types.CONVEXPOLYHEDRON]=
a.prototype.convexConvex=function(a,b,c,d,f,e,g,h,k,l,n,q){if(!(c.distanceTo(d)>a.boundingSphereRadius+b.boundingSphereRadius)&&a.findSeparatingAxis(b,c,f,d,e,ra,n,q)){n=[];a.clipAgainstHull(c,f,b,d,e,ra,-100,100,n);for(e=f=0;e!==n.length;e++){q=this.createContactEquation(g,h,a,b,k,l);var p=q.ri,v=q.rj;ra.negate(q.ni);n[e].normal.negate(oa);oa.mult(n[e].depth,oa);n[e].point.vadd(oa,p);v.copy(n[e].point);p.vsub(c,p);v.vsub(d,v);p.vadd(c,p);p.vsub(g.position,p);v.vadd(d,v);v.vsub(h.position,v);this.result.push(q);
f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(q,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}};var da=new b,ta=new b,pa=new b;a.prototype[g.types.PLANE|g.types.PARTICLE]=a.prototype.planeParticle=function(a,b,c,d,f,e,g,h){da.set(0,0,1);g.quaternion.vmult(da,da);d.vsub(g.position,ta);0>=da.dot(ta)&&(a=this.createContactEquation(h,g,b,a),a.ni.copy(da),a.ni.negate(a.ni),a.ri.set(0,0,0),da.mult(da.dot(d),pa),d.vsub(pa,pa),a.rj.copy(pa),
this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult))};var ia=new b;a.prototype[g.types.PARTICLE|g.types.SPHERE]=a.prototype.sphereParticle=function(a,b,c,d,f,e,g,h){ia.set(0,0,1);d.vsub(c,ia);ia.norm2()<=a.radius*a.radius&&(b=this.createContactEquation(h,g,b,a),ia.normalize(),b.rj.copy(ia),b.rj.mult(a.radius,b.rj),b.ni.copy(ia),b.ni.negate(b.ni),b.ri.set(0,0,0),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult))};var ua=new k,ja=new b;
new b;var sa=new b,va=new b,ka=new b;a.prototype[g.types.PARTICLE|g.types.CONVEXPOLYHEDRON]=a.prototype.convexParticle=function(a,b,c,d,f,e,g,h){var k=-1;e=null;var l=0;ja.copy(d);ja.vsub(c,ja);f.conjugate(ua);ua.vmult(ja,ja);if(a.pointIsInside(ja)){a.worldVerticesNeedsUpdate&&a.computeWorldVertices(c,f);a.worldFaceNormalsNeedsUpdate&&a.computeWorldFaceNormals(f);f=0;for(var n=a.faces.length;f!==n;f++){var q=a.worldFaceNormals[f];d.vsub(a.worldVertices[a.faces[f][0]],va);var p=-q.dot(va);if(null===
e||Math.abs(p)<Math.abs(e))e=p,k=f,sa.copy(q),l++}-1!==k?(a=this.createContactEquation(h,g,b,a),sa.mult(e,ka),ka.vadd(d,ka),ka.vsub(c,ka),a.rj.copy(ka),sa.negate(a.ni),a.ri.set(0,0,0),b=a.ri,e=a.rj,b.vadd(d,b),b.vsub(h.position,b),e.vadd(c,e),e.vsub(g.position,e),this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};a.prototype[g.types.BOX|g.types.HEIGHTFIELD]=a.prototype.boxHeightfield=function(a,
b,c,d,f,e,g,h){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexHeightfield(a.convexPolyhedronRepresentation,b,c,d,f,e,g,h)};var ea=new b,la=new b,wa=[0];a.prototype[g.types.CONVEXPOLYHEDRON|g.types.HEIGHTFIELD]=a.prototype.convexHeightfield=function(a,b,c,d,f,e,g,h){var k=b.data,n=b.elementSize,q=a.boundingSphereRadius;l.pointToLocalFrame(d,e,c,ea);var p=Math.floor((ea.x-q)/n)-1,v=Math.ceil((ea.x+q)/n)+1,r=Math.floor((ea.y-
q)/n)-1;n=Math.ceil((ea.y+q)/n)+1;if(!(0>v||0>n||p>k.length||r>k[0].length)){0>p&&(p=0);0>v&&(v=0);0>r&&(r=0);0>n&&(n=0);p>=k.length&&(p=k.length-1);v>=k.length&&(v=k.length-1);n>=k[0].length&&(n=k[0].length-1);r>=k[0].length&&(r=k[0].length-1);k=[];b.getRectMinMax(p,r,v,n,k);var E=k[0];if(!(ea.z-q>k[1]||ea.z+q<E))for(q=p;q<v;q++)for(p=r;p<n;p++)b.getConvexTrianglePillar(q,p,!1),l.pointToWorldFrame(d,e,b.pillarOffset,la),c.distanceTo(la)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&
this.convexConvex(a,b.pillarConvex,c,la,f,e,g,h,null,null,wa,null),b.getConvexTrianglePillar(q,p,!0),l.pointToWorldFrame(d,e,b.pillarOffset,la),c.distanceTo(la)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,b.pillarConvex,c,la,f,e,g,h,null,null,wa,null)}};var fa=new b,ma=new b;a.prototype[g.types.SPHERE|g.types.HEIGHTFIELD]=a.prototype.sphereHeightfield=function(a,b,c,d,f,e,g,h){var k=b.data,n=a.radius,q=b.elementSize;l.pointToLocalFrame(d,e,c,fa);var p=Math.floor((fa.x-
n)/q)-1,v=Math.ceil((fa.x+n)/q)+1,r=Math.floor((fa.y-n)/q)-1;q=Math.ceil((fa.y+n)/q)+1;if(!(0>v||0>q||p>k.length||q>k[0].length)){0>p&&(p=0);0>v&&(v=0);0>r&&(r=0);0>q&&(q=0);p>=k.length&&(p=k.length-1);v>=k.length&&(v=k.length-1);q>=k[0].length&&(q=k[0].length-1);r>=k[0].length&&(r=k[0].length-1);k=[];b.getRectMinMax(p,r,v,q,k);var E=k[0];if(!(fa.z-n>k[1]||fa.z+n<E))for(n=this.result;p<v;p++)for(k=r;k<q;k++)if(E=n.length,b.getConvexTrianglePillar(p,k,!1),l.pointToWorldFrame(d,e,b.pillarOffset,ma),
c.distanceTo(ma)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,c,ma,f,e,g,h),b.getConvexTrianglePillar(p,k,!0),l.pointToWorldFrame(d,e,b.pillarOffset,ma),c.distanceTo(ma)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,c,ma,f,e,g,h),2<n.length-E)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,
"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(c,f,g){function a(){k.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new d;this.broadphase=new y;this.bodies=[];this.solver=new b;this.constraints=[];this.narrowphase=new l(this);this.collisionMatrix=new e;
this.collisionMatrixPrevious=new e;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new q;this.defaultMaterial=new h("default");this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null}}f.exports=a;c("../shapes/Shape");
var d=c("../math/Vec3");f=c("../math/Quaternion");var b=c("../solver/GSSolver");c("../utils/Vec3Pool");c("../equations/ContactEquation");c("../equations/FrictionEquation");var l=c("./Narrowphase"),k=c("../utils/EventTarget"),e=c("../collision/ArrayCollisionMatrix"),h=c("../material/Material"),p=c("../material/ContactMaterial"),n=c("../objects/Body"),q=c("../utils/TupleDictionary"),t=c("../collision/RaycastResult");g=c("../collision/AABB");var r=c("../collision/Ray"),y=c("../collision/NaiveBroadphase");
a.prototype=new k;new g;var u=new r;a.prototype.getContactMaterial=function(a,b){return this.contactMaterialTable.get(a.id,b.id)};a.prototype.numObjects=function(){return this.bodies.length};a.prototype.collisionMatrixTick=function(){var a=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=a;this.collisionMatrix.reset()};a.prototype.add=a.prototype.addBody=function(a){-1===this.bodies.indexOf(a)&&(a.index=this.bodies.length,this.bodies.push(a),a.world=
this,a.initPosition.copy(a.position),a.initVelocity.copy(a.velocity),a.timeLastSleepy=this.time,a instanceof n&&(a.initAngularVelocity.copy(a.angularVelocity),a.initQuaternion.copy(a.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=a,this.dispatchEvent(this.addBodyEvent))};a.prototype.addConstraint=function(a){this.constraints.push(a)};a.prototype.removeConstraint=function(a){a=this.constraints.indexOf(a);-1!==a&&this.constraints.splice(a,1)};a.prototype.rayTest=
function(a,b,c){c instanceof t?this.raycastClosest(a,b,{skipBackfaces:!0},c):this.raycastAll(a,b,{skipBackfaces:!0},c)};a.prototype.raycastAll=function(a,b,c,d){c.mode=r.ALL;c.from=a;c.to=b;c.callback=d;return u.intersectWorld(this,c)};a.prototype.raycastAny=function(a,b,c,d){c.mode=r.ANY;c.from=a;c.to=b;c.result=d;return u.intersectWorld(this,c)};a.prototype.raycastClosest=function(a,b,c,d){c.mode=r.CLOSEST;c.from=a;c.to=b;c.result=d;return u.intersectWorld(this,c)};a.prototype.remove=function(a){a.world=
null;var b=this.bodies.length-1,c=this.bodies,d=c.indexOf(a);if(-1!==d){c.splice(d,1);for(d=0;d!==c.length;d++)c[d].index=d;this.collisionMatrix.setNumObjects(b);this.removeBodyEvent.body=a;this.dispatchEvent(this.removeBodyEvent)}};a.prototype.removeBody=a.prototype.remove;a.prototype.addMaterial=function(a){this.materials.push(a)};a.prototype.addContactMaterial=function(a){this.contactmaterials.push(a);this.contactMaterialTable.set(a.materials[0].id,a.materials[1].id,a)};"undefined"===typeof performance&&
(performance={});if(!performance.now){var x=Date.now();performance.timing&&performance.timing.navigationStart&&(x=performance.timing.navigationStart);performance.now=function(){return Date.now()-x}}var w=new d;a.prototype.step=function(a,b,c){c=c||10;b=b||0;if(0===b)this.internalStep(a),this.time+=a;else{var d=Math.floor((this.time+b)/a)-Math.floor(this.time/a);d=Math.min(d,c);c=performance.now();for(var f=0;f!==d&&!(this.internalStep(a),performance.now()-c>1E3*a);f++);this.time+=b;a=this.time%a/
a;b=this.bodies;for(d=0;d!==b.length;d++)c=b[d],c.type!==n.STATIC&&c.sleepState!==n.SLEEPING?(c.position.vsub(c.previousPosition,w),w.scale(a,w),c.position.vadd(w,c.interpolatedPosition)):(c.interpolatedPosition.copy(c.position),c.interpolatedQuaternion.copy(c.quaternion))}};var z={type:"postStep"},A={type:"preStep"},C={type:"collide",body:null,contact:null},D=[],G=[],H=[],J=[];new d;new d;new d;new d;new d;new d;new d;new d;new d;new f;var L=new f,O=new f,U=new d;a.prototype.internalStep=function(a){this.dt=
a;var b=this.contacts,c=this.numObjects(),d=this.bodies,f=this.solver,e=this.gravity,g=this.doProfiling,h=this.profile,k=n.DYNAMIC,l,q=this.constraints;e.norm();var p=e.x,r=e.y,t=e.z;g&&(l=performance.now());for(e=0;e!==c;e++){var u=d[e];if(u.type&k){var w=u.force;u=u.mass;w.x+=u*p;w.y+=u*r;w.z+=u*t}}e=0;for(u=this.subsystems.length;e!==u;e++)this.subsystems[e].update();g&&(l=performance.now());H.length=0;J.length=0;this.broadphase.collisionPairs(this,H,J);g&&(h.broadphase=performance.now()-l);u=
q.length;for(e=0;e!==u;e++)if(p=q[e],!p.collideConnected)for(r=H.length-1;0<=r;--r)if(p.bodyA===H[r]&&p.bodyB===J[r]||p.bodyB===H[r]&&p.bodyA===J[r])H.splice(r,1),J.splice(r,1);this.collisionMatrixTick();g&&(l=performance.now());u=b.length;for(e=0;e!==u;e++)D.push(b[e]);b.length=0;u=this.frictionEquations.length;for(e=0;e!==u;e++)G.push(this.frictionEquations[e]);this.frictionEquations.length=0;this.narrowphase.getContacts(H,J,this,b,D,this.frictionEquations,G);g&&(h.narrowphase=performance.now()-
l);g&&(l=performance.now());for(e=0;e<this.frictionEquations.length;e++)f.addEquation(this.frictionEquations[e]);e=b.length;for(r=0;r!==e;r++)p=b[r],u=p.bi,t=p.bj,u.material&&t.material&&this.getContactMaterial(u.material,t.material),u.material&&t.material&&0<=u.material.restitution&&0<=t.material.restitution&&(p.restitution=u.material.restitution*t.material.restitution),f.addEquation(p),u.allowSleep&&u.type===n.DYNAMIC&&u.sleepState===n.SLEEPING&&t.sleepState===n.AWAKE&&t.type!==n.STATIC&&t.velocity.norm2()+
t.angularVelocity.norm2()>=2*Math.pow(t.sleepSpeedLimit,2)&&(u._wakeUpAfterNarrowphase=!0),t.allowSleep&&t.type===n.DYNAMIC&&t.sleepState===n.SLEEPING&&u.sleepState===n.AWAKE&&u.type!==n.STATIC&&u.velocity.norm2()+u.angularVelocity.norm2()>=2*Math.pow(u.sleepSpeedLimit,2)&&(t._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(u,t,!0),this.collisionMatrixPrevious.get(u,t)||(C.body=t,C.contact=p,u.dispatchEvent(C),C.body=u,t.dispatchEvent(C));g&&(h.makeContactConstraints=performance.now()-l,l=performance.now());
for(e=0;e!==c;e++)u=d[e],u._wakeUpAfterNarrowphase&&(u.wakeUp(),u._wakeUpAfterNarrowphase=!1);u=q.length;for(e=0;e!==u;e++)for(p=q[e],p.update(),r=0,b=p.equations.length;r!==b;r++)f.addEquation(p.equations[r]);f.solve(a,this);g&&(h.solve=performance.now()-l);f.removeAllEquations();f=Math.pow;for(e=0;e!==c;e++)if(u=d[e],u.type&k&&(q=f(1-u.linearDamping,a),b=u.velocity,b.mult(q,b),q=u.angularVelocity))b=f(1-u.angularDamping,a),q.mult(b,q);this.dispatchEvent(A);for(e=0;e!==c;e++)u=d[e],u.preStep&&u.preStep.call(u);
g&&(l=performance.now());k=n.DYNAMIC|n.KINEMATIC;f=0===this.stepnumber%(this.quatNormalizeSkip+1);q=this.quatNormalizeFast;b=.5*a;for(e=0;e!==c;e++)if(u=d[e],p=u.force,r=u.torque,u.type&k&&u.sleepState!==n.SLEEPING){t=u.velocity;w=u.angularVelocity;var y=u.position,x=u.quaternion,M=u.invMass,ha=u.invInertiaWorld;t.x+=p.x*M*a;t.y+=p.y*M*a;t.z+=p.z*M*a;u.angularVelocity&&(ha.vmult(r,U),U.mult(a,U),U.vadd(w,w));y.x+=t.x*a;y.y+=t.y*a;y.z+=t.z*a;u.angularVelocity&&(L.set(w.x,w.y,w.z,0),L.mult(x,O),x.x+=
b*O.x,x.y+=b*O.y,x.z+=b*O.z,x.w+=b*O.w,f&&(q?x.normalizeFast():x.normalize()));u.aabb&&(u.aabbNeedsUpdate=!0);u.updateInertiaWorld&&u.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;g&&(h.integrate=performance.now()-l);this.time+=a;this.stepnumber+=1;this.dispatchEvent(z);for(e=0;e!==c;e++)u=d[e],(a=u.postStep)&&a.call(u);if(this.allowSleep)for(e=0;e!==c;e++)d[e].sleepTick(this.time)};a.prototype.clearForces=function(){for(var a=this.bodies,b=a.length,c=0;c!==b;c++){var d=a[c];d.force.set(0,
0,0);d.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},
{},[2])(2)});CANNON=CANNON||{};var camera,scene,renderer;
CANNON.Demo=function(m){function c(){if(w){for(var a in w.__controllers)w.__controllers[a].updateDisplay();for(var b in w.__folders)for(a in w.__folders[b].__controllers)w.__folders[b].__controllers[a].updateDisplay()}}function f(a){function b(a,c){a.material&&(a.material=c);for(var d=0;d<a.children.length;d++)b(a.children[d],c)}if(-1===V.indexOf(a))throw Error("Render mode "+a+" not found!");switch(a){case "solid":n.currentMaterial=G;S.intensity=1;N.color.setHex(2236962);break;case "wireframe":n.currentMaterial=
H,S.intensity=0,N.color.setHex(16777215)}for(var c=0;c<u.length;c++)b(u[c],n.currentMaterial);t.rendermode=a}function g(){for(var a=y.length,b=0;b<a;b++){var c=y[b];c.position.copy(c.initPosition);c.velocity.copy(c.initVelocity);c.initAngularVelocity&&(c.angularVelocity.copy(c.initAngularVelocity),c.quaternion.copy(c.initQuaternion))}}function a(a){0===a.x&&(a.x=1E-6);0===a.y&&(a.y=1E-6);0===a.z&&(a.z=1E-6)}function d(){for(var b=y.length,c=0;c<b;c++){var d=y[c],e=u[c];e.position.copy(d.position);
d.quaternion&&e.quaternion.copy(d.quaternion)}L.restart();if(t.contacts)for(c=0;c<I.contacts.length;c++)for(b=0;2>b;b++){e=L.request();var f=I.contacts[c];d=0===b?f.bi:f.bj;var g=0===b?f.ri:f.rj;e.position.set(d.position.x+g.x,d.position.y+g.y,d.position.z+g.z)}L.hideCached();O.restart();if(t.cm2contact)for(c=0;c<I.contacts.length;c++)for(b=0;2>b;b++)e=O.request(),f=I.contacts[c],d=0===b?f.bi:f.bj,g=0===b?f.ri:f.rj,e.scale.set(g.x,g.y,g.z),a(e.scale),e.position.copy(d.position);O.hideCached();K.restart();
E.restart();if(t.constraints){for(c=0;c<I.constraints.length;c++)f=I.constraints[c],f instanceof CANNON.DistanceConstraint&&(d=f.equations.normal,b=d.bi,d=d.bj,e=K.request(),d=d.position?d.position:d,e.scale.set(d.x-b.position.x,d.y-b.position.y,d.z-b.position.z),a(e.scale),e.position.copy(b.position));for(c=0;c<I.constraints.length;c++)if(f=I.constraints[c],f instanceof CANNON.PointToPointConstraint){g=f.equations.normal;b=g.bi;d=g.bj;e=E.request();f=E.request();var h=E.request();e.scale.set(g.ri.x,
g.ri.y,g.ri.z);f.scale.set(g.rj.x,g.rj.y,g.rj.z);h.scale.set(-g.penetrationVec.x,-g.penetrationVec.y,-g.penetrationVec.z);a(e.scale);a(f.scale);a(h.scale);e.position.copy(b.position);f.position.copy(d.position);g.bj.position.vadd(g.rj,h.position)}}E.hideCached();K.hideCached();R.restart();if(t.normals)for(c=0;c<I.contacts.length;c++)f=I.contacts[c],b=f.bi,e=R.request(),g=f.ni,d=b,e.scale.set(g.x,g.y,g.z),a(e.scale),e.position.copy(d.position),f.ri.vadd(e.position,e.position);R.hideCached();v.restart();
if(t.axes)for(b=0;b<y.length;b++)d=y[b],e=v.request(),e.position.copy(d.position),d.quaternion&&e.quaternion.copy(d.quaternion);v.hideCached();Q.restart();if(t.aabbs)for(c=0;c<y.length;c++)d=y[c],d.computeAABB&&(d.aabbNeedsUpdate&&d.computeAABB(),isFinite(d.aabb.lowerBound.x)&&isFinite(d.aabb.lowerBound.y)&&isFinite(d.aabb.lowerBound.z)&&isFinite(d.aabb.upperBound.x)&&isFinite(d.aabb.upperBound.y)&&isFinite(d.aabb.upperBound.z)&&0!=d.aabb.lowerBound.x-d.aabb.upperBound.x&&0!=d.aabb.lowerBound.y-d.aabb.upperBound.y&&
0!=d.aabb.lowerBound.z-d.aabb.upperBound.z&&(e=Q.request(),e.scale.set(d.aabb.lowerBound.x-d.aabb.upperBound.x,d.aabb.lowerBound.y-d.aabb.upperBound.y,d.aabb.lowerBound.z-d.aabb.upperBound.z),e.position.set(.5*(d.aabb.lowerBound.x+d.aabb.upperBound.x),.5*(d.aabb.lowerBound.y+d.aabb.upperBound.y),.5*(d.aabb.lowerBound.z+d.aabb.upperBound.z))));Q.hideCached()}function b(){requestAnimationFrame(b);if(!t.paused){d();var a=1/t.stepFrequency,c=Date.now()/1E3;Z?I.step(a,c-Z,t.maxSubSteps):I.step(a);Z=c}CAMERA_TEST&&
W.update();renderer.clear();renderer.render(n.scene,camera);B.update()}function l(a){mouseX=a.clientX-X;mouseY=a.clientY-aa}function k(a){T=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;F=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST&&(W.screen.width=T,W.screen.height=F)}function e(a){n.dispatchEvent({type:"destroy"});t.paused=!1;c();h(a)}function h(a){for(var b=u.length,d=0;d<b;d++){I.remove(y.pop());var e=u.pop();n.scene.remove(e)}for(;I.constraints.length;)I.removeConstraint(I.constraints[0]);
x[a]();t.iterations=I.solver.iterations;t.gx=I.gravity.x+0;t.gy=I.gravity.y+0;t.gz=I.gravity.z+0;t.quatNormalizeSkip=I.quatNormalizeSkip;t.quatNormalizeFast=I.quatNormalizeFast;c();L.restart();L.hideCached();O.restart();O.hideCached();K.restart();K.hideCached();R.restart();R.hideCached()}function p(a){var b=[],c=[];this.request=function(){geo=b.length?b.pop():a();scene.add(geo);c.push(geo);return geo};this.restart=function(){for(;c.length;)b.push(c.pop())};this.hideCached=function(){for(var a=0;a<
b.length;a++)scene.remove(b[a])}}var n=this;this.addScene=function(a,b){if("string"!==typeof a)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof b)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");x.push(b);var c=x.length-1;C[a]=function(){e(c)};q.add(C,a)};this.restartCurrentScene=g;this.changeScene=e;this.start=function(){h(0)};var q,t=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,
gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};m=m||{};for(var r in m)r in t&&(t[r]=m[r]);if(0!==t.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");var y=this.bodies=[],u=this.visuals=[],x=[],w=null,z=null,A=null,C={},D=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var G=new THREE.MeshPhongMaterial({color:11184810,
specular:1118481,shininess:100}),H=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=G;var J=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var L=new p(function(){return new THREE.Mesh(D,J)}),O=new p(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),U=new THREE.BoxGeometry(1,
1,1),M=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),Q=new p(function(){return new THREE.Mesh(U,M)}),K=new p(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),E=new p(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),
R=new p(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:65280}))}),v=new p(function(){var a=new THREE.Object3D,b=new THREE.Vector3(0,0,0),c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.Geometry;c.vertices.push(b);d.vertices.push(b);e.vertices.push(b);c.vertices.push(new THREE.Vector3(1,0,0));d.vertices.push(new THREE.Vector3(0,1,0));e.vertices.push(new THREE.Vector3(0,
0,1));b=new THREE.Line(c,new THREE.LineBasicMaterial({color:16711680}));d=new THREE.Line(d,new THREE.LineBasicMaterial({color:65280}));e=new THREE.Line(e,new THREE.LineBasicMaterial({color:255}));a.add(b);a.add(d);a.add(e);return a}),I=this.world=new CANNON.World;I.broadphase=new CANNON.NaiveBroadphase;var V=["solid","wireframe"],S,N,B,P;Detector.webgl||Detector.addGetWebGLMessage();var T=s_iCanvasResizeWidth+s_iCanvasOffsetWidth,F=s_iCanvasResizeHeight+s_iCanvasOffsetHeight,W,Y,X=T/2,aa=F/2;(function(){Y=
document.createElement("div");document.body.appendChild(Y);CAMERA_TEST?(NEAR=5,camera=new THREE.PerspectiveCamera(45,T/F,NEAR,FAR),camera.lookAt(new THREE.Vector3(0,0,0)),camera.position.set(0,500,500),camera.up.set(0,0,1)):camera=createOrthoGraphicCamera();scene=n.scene=new THREE.Scene;scene.fog=new THREE.Fog(2236962,1E3,FAR);N=new THREE.AmbientLight(4473924);scene.add(N);S=new THREE.DirectionalLight(16777164,1);S.position.set(180,0,180);S.target.position.set(0,0,0);S.castShadow=!0;S.shadow.camera.near=
10;S.shadow.camera.far=100;S.shadow.camera.fov=30;S.shadowMapBias=.0139;S.shadowMapDarkness=.1;S.shadow.mapSize.width=1024;S.shadow.mapSize.height=1024;scene.add(S);scene.add(camera);renderer=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});renderer.setSize(T,F);renderer.domElement.style.position="relative";renderer.domElement.style.top="0px";renderer.domElement.style.opacity=.5;
Y.appendChild(renderer.domElement);P=document.createElement("div");P.style.position="absolute";P.style.top="10px";P.style.width="100%";P.style.textAlign="center";P.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';Y.appendChild(P);document.addEventListener("mousemove",l);window.addEventListener("resize",k);renderer.setClearColor(scene.fog.color,1);renderer.autoClear=!1;A=document.createElement("canvas");A.width=T;A.height=F;A.style.opacity=.5;A.style.position=
"absolute";A.style.top="0px";A.style.zIndex=90;Y.appendChild(A);z=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});z.streamTo(A);var a={},b=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]],c=0,d;for(d in I.profile){var e=b[c%b.length];a[d]=new TimeSeries({label:d,fillStyle:"rgb("+e[0]+","+e[1]+","+e[2]+")",maxDataLength:500});
c++}I.addEventListener("postStep",function(b){for(var c in I.profile)a[c].append(1E3*I.time,I.profile[c])});c=0;for(d in I.profile)e=b[c%b.length],z.addTimeSeries(a[d],{strokeStyle:"rgb("+e[0]+","+e[1]+","+e[2]+")",lineWidth:2}),c++;I.doProfiling=!1;z.stop();A.style.display="none";B=new Stats;B.domElement.style.position="absolute";B.domElement.style.top="0px";B.domElement.style.zIndex=100;Y.appendChild(B.domElement);void 0!=window.dat&&(w=new dat.GUI,w.domElement.parentNode.style.zIndex=120,b=w.addFolder("Rendering"),
b.add(t,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(a){f(a)}),b.add(t,"contacts"),b.add(t,"cm2contact"),b.add(t,"normals"),b.add(t,"constraints"),b.add(t,"axes"),b.add(t,"particleSize").min(0).max(1).onChange(function(a){for(var b=0;b<u.length;b++)y[b]instanceof CANNON.Particle&&u[b].scale.set(a,a,a)}),b.add(t,"shadows").onChange(function(a){a?renderer.shadowMapAutoUpdate=!0:(renderer.shadowMapAutoUpdate=!1,renderer.clearTarget(S.shadowMap))}),b.add(t,"aabbs"),b.add(t,"profiling").onChange(function(a){a?
(I.doProfiling=!0,z.start(),A.style.display="block"):(I.doProfiling=!1,z.stop(),A.style.display="none")}),b=w.addFolder("World"),b.add(t,"paused").onChange(function(a){}),b.add(t,"stepFrequency",60,600).step(60),b.add(t,"gx",-100,100).onChange(function(a){isNaN(a)||I.gravity.set(a,t.gy,t.gz)}),b.add(t,"gy",-100,100).onChange(function(a){isNaN(a)||I.gravity.set(t.gx,a,t.gz)}),b.add(t,"gz",-100,100).onChange(function(a){isNaN(a)||I.gravity.set(t.gx,t.gy,a)}),b.add(t,"quatNormalizeSkip",0,50).step(1).onChange(function(a){isNaN(a)||
(I.quatNormalizeSkip=a)}),b.add(t,"quatNormalizeFast").onChange(function(a){I.quatNormalizeFast=!!a}),b=w.addFolder("Solver"),b.add(t,"iterations",1,50).step(1).onChange(function(a){I.solver.iterations=a}),b.add(t,"k",10,1E7).onChange(function(a){n.setGlobalSpookParams(t.k,t.d,1/t.stepFrequency)}),b.add(t,"d",0,20).step(.1).onChange(function(a){n.setGlobalSpookParams(t.k,t.d,1/t.stepFrequency)}),b.add(t,"tolerance",0,10).step(.01).onChange(function(a){I.solver.tolerance=a}),q=w.addFolder("Scenes"),
q.open());CAMERA_TEST&&(W=new THREE.TrackballControls(camera,renderer.domElement),W.rotateSpeed=1,W.zoomSpeed=1.2,W.panSpeed=.2,W.noZoom=!1,W.noPan=!1,W.staticMoving=!1,W.dynamicDampingFactor=.3,W.minDistance=0,W.maxDistance=1E5,W.screen.width=T,W.screen.height=F)})();b();var Z=0;document.addEventListener("keypress",function(a){if(a.keyCode)switch(a.keyCode){case 32:g();break;case 104:"none"==B.domElement.style.display?(B.domElement.style.display="block",P.style.display="block"):(B.domElement.style.display=
"none",P.style.display="none");break;case 97:t.aabbs=!t.aabbs;c();break;case 99:t.constraints=!t.constraints;c();break;case 112:t.paused=!t.paused;c();break;case 115:I.step(1/t.stepFrequency);d();break;case 109:a=V.indexOf(t.rendermode);a++;a%=V.length;f(V[a]);c();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:x.length>a.keyCode-49&&!document.activeElement.localName.match(/input/)&&e(a.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;
CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(m,c,f){for(var g=this.world,a=0;a<g.constraints.length;a++)for(var d=g.constraints[a],b=0;b<d.equations.length;b++)d.equations[b].setSpookParams(m,c,f);for(a=0;a<g.contactmaterials.length;a++)f=g.contactmaterials[a],f.contactEquationStiffness=m,f.frictionEquationStiffness=m,f.contactEquationRelaxation=c,f.frictionEquationRelaxation=c;g.defaultContactMaterial.contactEquationStiffness=m;g.defaultContactMaterial.frictionEquationStiffness=m;g.defaultContactMaterial.contactEquationRelaxation=
c;g.defaultContactMaterial.frictionEquationRelaxation=c};CANNON.Demo.prototype.getWorld=function(){return this.world};CANNON.Demo.prototype.addVisual=function(m){var c;m instanceof CANNON.Body&&(c=this.shape2mesh(m));c&&(this.bodies.push(m),this.visuals.push(c),m.visualref=c,m.visualref.visualId=this.bodies.length-1,this.scene.add(c));return c};CANNON.Demo.prototype.addVisuals=function(m){for(var c=0;c<m.length;c++)this.addVisual(m[c])};
CANNON.Demo.prototype.removeVisual=function(m){if(m.visualref){for(var c=this.bodies,f=this.visuals,g=[],a=[],d=c.length,b=0;b<d;b++)g.unshift(c.pop()),a.unshift(f.pop());d=m.visualref.visualId;for(var l=0;l<g.length;l++)l!==d&&(b=l>d?l-1:l,c[b]=g[l],f[b]=a[l],c[b].visualref=g[l].visualref,c[b].visualref.visualId=b);m.visualref.visualId=null;this.scene.remove(m.visualref);m.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(m){for(var c=new THREE.Object3D,f=0;f<m.shapes.length;f++){var g=m.shapes[f];switch(g.type){case CANNON.Shape.types.SPHERE:var a=new THREE.SphereGeometry(g.radius,8,8);g=new THREE.Mesh(a,this.currentMaterial);break;case CANNON.Shape.types.PARTICLE:g=new THREE.Mesh(this.particleGeo,this.particleMaterial);a=this.settings;g.scale.set(a.particleSize,a.particleSize,a.particleSize);break;case CANNON.Shape.types.PLANE:var d=new THREE.PlaneGeometry(10,10,4,4);g=new THREE.Object3D;
a=new THREE.Object3D;d=new THREE.Mesh(d,this.currentMaterial);d.scale.set(100,100,100);a.add(d);d.castShadow=!0;d.receiveShadow=!0;g.add(a);break;case CANNON.Shape.types.BOX:a=new THREE.BoxGeometry(2*g.halfExtents.x,2*g.halfExtents.y,2*g.halfExtents.z);g=new THREE.Mesh(a,this.currentMaterial);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:d=new THREE.Geometry;for(a=0;a<g.vertices.length;a++){var b=g.vertices[a];d.vertices.push(new THREE.Vector3(b.x,b.y,b.z))}for(a=0;a<g.faces.length;a++){var l=g.faces[a],
k=l[0];for(b=1;b<l.length-1;b++)d.faces.push(new THREE.Face3(k,l[b],l[b+1]))}d.computeBoundingSphere();d.computeFaceNormals();g=new THREE.Mesh(d,this.currentMaterial);break;case CANNON.Shape.types.HEIGHTFIELD:d=new THREE.Geometry;l=new CANNON.Vec3;k=new CANNON.Vec3;var e=new CANNON.Vec3;for(b=0;b<g.data.length-1;b++)for(var h=0;h<g.data[b].length-1;h++)for(var p=0;2>p;p++)g.getConvexTrianglePillar(b,h,0===p),l.copy(g.pillarConvex.vertices[0]),k.copy(g.pillarConvex.vertices[1]),e.copy(g.pillarConvex.vertices[2]),
l.vadd(g.pillarOffset,l),k.vadd(g.pillarOffset,k),e.vadd(g.pillarOffset,e),d.vertices.push(new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(e.x,e.y,e.z)),a=d.vertices.length-3,d.faces.push(new THREE.Face3(a,a+1,a+2));d.computeBoundingSphere();d.computeFaceNormals();g=new THREE.Mesh(d,this.currentMaterial);break;case CANNON.Shape.types.TRIMESH:d=new THREE.Geometry;l=new CANNON.Vec3;k=new CANNON.Vec3;e=new CANNON.Vec3;for(a=0;a<g.indices.length/3;a++)g.getTriangleVertices(a,
l,k,e),d.vertices.push(new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(e.x,e.y,e.z)),b=d.vertices.length-3,d.faces.push(new THREE.Face3(b,b+1,b+2));d.computeBoundingSphere();d.computeFaceNormals();g=new THREE.Mesh(d,this.currentMaterial);break;default:throw"Visual type not recognized: "+g.type;}g.receiveShadow=!0;g.castShadow=!0;if(g.children)for(a=0;a<g.children.length;a++)if(g.children[a].castShadow=!0,g.children[a].receiveShadow=!0,g.children[a])for(b=0;b<g.children[a].length;b++)g.children[a].children[b].castShadow=
!0,g.children[a].children[b].receiveShadow=!0;a=m.shapeOffsets[f];d=m.shapeOrientations[f];g.position.set(a.x,a.y,a.z);g.quaternion.set(d.x,d.y,d.z,d.w);c.add(g)}this.camera=function(){return camera};this.getScene=function(){return scene};return c};var NUM_ROWS_PAGE_LEVEL=2,NUM_COLS_PAGE_LEVEL=5;
function CLevelMenu(m){var c,f,g,a,d,b,l,k,e,h,p,n,q,t,r,y,u,x,w=null,z=null,A,C,D,G=null,H=null;this._init=function(){n=0;A=new createjs.Container;s_oStage.addChild(A);var t=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));A.addChild(t);t=s_oSpriteLibrary.getSprite("msg_box");var L=createBitmap(t);L.x=CANVAS_WIDTH_HALF;L.y=CANVAS_HEIGHT_HALF;L.regX=.5*t.width;L.regY=.5*t.height;A.addChild(L);h=CANVAS_WIDTH/2-350;p=CANVAS_HEIGHT_HALF-210;new CTLText(s_oStage,h,p,700,60,60,"center",TEXT_COLOR,FONT_GAME,
1,0,0,TEXT_SELECT_A_LEVEL,!0,!0,!1,!1);t=s_oSpriteLibrary.getSprite("but_exit");k=CANVAS_WIDTH-t.height/2-10;e=t.height/2+10;u=new CGfxButton(k,e,t,s_oStage);u.addEventListener(ON_MOUSE_UP,this._onExit,this);q=t.height;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)b=u.getX()-t.width-10,l=t.height/2+10,x=new CToggle(b,l,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive),x.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);t=window.document;L=t.documentElement;G=L.requestFullscreen||L.mozRequestFullScreen||
L.webkitRequestFullScreen||L.msRequestFullscreen;H=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(G=!1);G&&screenfull.enabled&&(t=s_oSpriteLibrary.getSprite("but_fullscreen"),c=t.width/4+10,f=e,D=new CToggle(c,f,t,s_bFullscreen,s_oStage),D.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this._checkBoundLimits();r=[];t=Math.floor((CANVAS_WIDTH+EDGEBOARD_X)/NUM_COLS_PAGE_LEVEL)/2;L=.7*-EDGEBOARD_X;for(var O=0;O<NUM_COLS_PAGE_LEVEL;O++)r.push(L),
L+=t;y=[];this._createNewLevelPage(0,m);if(1<y.length){for(t=1;t<y.length;t++)y[t].visible=!1;a=CANVAS_WIDTH-180;d=CANVAS_HEIGHT_HALF;w=new CGfxButton(a,d,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage);w.addEventListener(ON_MOUSE_UP,this._onRight,this);g=CANVAS_HEIGHT_HALF;z=new CGfxButton(180,g,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage);z.addEventListener(ON_MOUSE_UP,this._onLeft,this)}C=new createjs.Shape;C.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(C);
createjs.Tween.get(C).to({alpha:0},1E3).call(function(){s_oStage.removeChild(C);C=null});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var a=0;a<t.length;a++)t[a].unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)x.unload(),x=null;G&&screenfull.enabled&&D.unload();u.unload();u=null;null!==z&&(z.unload(),w.unload());s_oLevelMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(a,d){u.setPosition(k-a,e+d);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||x.setPosition(b-
a,d+l);G&&screenfull.enabled&&D.setPosition(c+s_iOffsetX,f+s_iOffsetY)};this._checkBoundLimits=function(){for(var a=s_oSpriteLibrary.getSprite("but_level"),b=0,c=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*q,d=0;b<c;)b+=a.height+20,d++;NUM_ROWS_PAGE_LEVEL>d&&(NUM_ROWS_PAGE_LEVEL=d);c=b=0;d=CANVAS_WIDTH-2*EDGEBOARD_X;for(a=s_oSpriteLibrary.getSprite("but_level");c<d;)c+=a.width/2+5,b++;NUM_COLS_PAGE_LEVEL>b&&(NUM_COLS_PAGE_LEVEL=b)};this._createNewLevelPage=function(a,b){var c=new createjs.Container;A.addChild(c);
y.push(c);t=[];for(var d=0,e=-230,f=1,g=!1,h=s_oSpriteLibrary.getSprite("but_level"),k=a;k<b;k++){var l=new CLevelBut(r[d]+h.width/2,e+h.height/2,k+1,h,k+1>s_iLastLevel?!1:!0,c);l.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,k);t.push(l);d++;if(d===r.length&&(d=0,e+=h.height+20,f++,f>NUM_ROWS_PAGE_LEVEL&&k<b-1)){g=!0;break}}c.x=CANVAS_WIDTH/2;c.y=520;c.regX=c.getBounds().width/2;g&&this._createNewLevelPage(k+1,b)};this._onRight=function(){y[n].visible=!1;n++;n>=y.length&&(n=
0);y[n].visible=!0};this._onLeft=function(){y[n].visible=!1;n--;0>n&&(n=y.length-1);y[n].visible=!0};this._onButLevelRelease=function(a){this.unload();s_oMain.gotoGame(a)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this.resetFullscreenBut=function(){G&&screenfull.enabled&&D.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?H.call(window.document):G.call(window.document.documentElement);
sizeHandler()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(m,c,f,g,a,d){var b,l,k,e=[],h=[],p,n,q,t,r;this._init=function(a,c,d,f,g){l=[];k=[];q=new createjs.Container;y.addChild(q);var h=new createjs.SpriteSheet({images:[f],frames:{width:f.width/2,height:f.height,regX:f.width/2/2,regY:f.height/2},animations:{state_true:[0],state_false:[1]}});b=g;n=createSprite(h,"state_"+b,f.width/2/2,f.height/2,f.width/2,f.height);n.mouseEnabled=g;n.x=a;n.y=c;n.stop();s_bMobile||(q.cursor="pointer");q.addChild(n);e.push(n);p=new createjs.Text(d,"60px "+
FONT_GAME,TEXT_COLOR);p.x=a;p.y=c+20;p.textAlign="center";p.textBaseline="alphabetic";p.lineWidth=200;q.addChild(p);g||(p.color="#b4b4b4");this._initListener()};this.unload=function(){q.off("mousedown",t);q.off("pressup",r);q.removeChild(n)};this._initListener=function(){t=q.on("mousedown",this.buttonDown);r=q.on("pressup",this.buttonRelease)};this.viewBut=function(a){q.addChild(a)};this.addEventListener=function(a,b,c){l[a]=b;k[a]=c};this.addEventListenerWithParams=function(a,b,c,d){l[a]=b;k[a]=
c;h=d};this.ifClickable=function(){return!0===q.mouseEnabled?1:0};this.setActive=function(a,c){b=c;e[a].gotoAndStop("state_"+b);e[a].mouseEnabled=!0;p.color=b?"#69b8d5":"#b4b4b4"};this.buttonRelease=function(){b&&l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(k[ON_MOUSE_UP],h)};this.buttonDown=function(){l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN],h)};this.setPosition=function(a,b){q.x=a;q.y=b};this.setVisible=function(a){q.visible=a};var y=d;this._init(m,c,f,g,a,d)}
function CBall(m,c,f,g,a){var d,b,l,k=null,e=0,h=0,p=null,n;this._init=function(a,c,e){l=new createjs.Container;l.visible=!1;t.addChild(l);var f=new createjs.SpriteSheet({framerate:15,images:[e],frames:{width:e.width/7,height:e.height,regX:e.width/2/7,regY:e.height/2},animations:{start:0,rotate:[0,6]}});d=createSprite(f,0,e.width/2/7,e.height/2,e.width/7,e.height/2);d.stop();this.scale(.93);e=s_oSpriteLibrary.getSprite("ball_shadow");b=createBitmap(e);b.x=a;b.y=c;b.regX=.5*e.width;b.regY=.5*e.height;
this.scaleShadow(.93);l.addChild(b,d)};this.rolls=function(){d.rotation=Math.degrees(Math.sin(.15*q.velocity.x));var a=Math.abs(q.angularVelocity.x),b=this._goToPrevFrame;0>q.angularVelocity.x&&(b=this._goToNextFrame);7<a?b():3<a?(e++,e>2/ROLL_BALL_RATE&&(b(),e=0)):1<a?(e++,e>3/ROLL_BALL_RATE&&(b(),e=0)):a>MIN_BALL_VEL_ROTATION&&(e++,e>4/ROLL_BALL_RATE&&(b(),e=0))};this._goToPrevFrame=function(){0===h?h=6:h--;d.gotoAndStop(h)};this._goToNextFrame=function(){7===h?h=1:h++;d.gotoAndStop(h)};this.unload=
function(){d.removeAllEventListeners();t.removeChild(d)};this.setVisible=function(a){l.visible=a};this.playAnim=function(a){d.gotoAndPlay(a)};this.getStartScale=function(){return.93};this.startPosShadowY=function(a){k=a};this.getStartShadowYPos=function(){return k};this.fadeAnimation=function(a,b,c){a!==n&&(null!==p&&createjs.Tween.removeTweens(l),this.tweenFade(a,b,c),n=a)};this.tweenFade=function(a,b,c){p=createjs.Tween.get(l).wait(c).to({alpha:a},b).call(function(){p=null})};this.setPositionShadow=
function(a,c){b.x=a;b.y=c};this.setPosition=function(a,b){d.x=a;d.y=b};this.getPhysics=function(){return q};this.setAngle=function(a){d.rotation=a};this.getX=function(){return d.x};this.getY=function(){return d.y};this.getStartScale=function(){return.93};this.scale=function(a){d.scaleX=a;d.scaleY=a};this.scaleShadow=function(a){.08<a?(b.scaleX=a,b.scaleY=a):(b.scaleX=.08,b.scaleY=.08)};this.setAlphaByHeight=function(a){b.alpha=a};this.getScale=function(){return d.scaleX};this.getObject=function(){return d};
this.getDepthPos=function(){return q.position.y};this.isVisible=function(){return l.visible};var q=g;var t=a;this._init(m,c,f);return this}
function CScenario(){var m,c,f,g,a,d,b,l,k,e,h,p;if(SHOW_3D_RENDER)var n=new CANNON.Demo;this.getDemo=function(){return n};this._init=function(){m=SHOW_3D_RENDER?n.getWorld():new CANNON.World;m.gravity.set(0,0,-9.81);m.broadphase=new CANNON.NaiveBroadphase;m.solver.iterations=50;m.solver.tolerance=1E-5;c=new CANNON.Material;f=new CANNON.Material;g=new CANNON.Material;var a=new CANNON.ContactMaterial(f,c,{friction:.2,restitution:.3}),b=new CANNON.ContactMaterial(f,g,{friction:.5,restitution:.1});m.addContactMaterial(a);
m.addContactMaterial(b);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario.createHandGoalKeeper()};this._createFieldBody=function(){l=new CANNON.Plane;k=new CANNON.Body({mass:0,material:c});k.addShape(l);k.position.z=-10;k.addEventListener("collide",function(a){s_oScenario.fieldCollision()});m.addBody(k);SHOW_3D_RENDER&&n.addVisual(k)};this.createHandGoalKeeper=function(){e=new CANNON.Box(new CANNON.Vec3(HAND_KEEPER_SIZE.width,HAND_KEEPER_SIZE.depth,HAND_KEEPER_SIZE.height));
h=new CANNON.Body({mass:0,material:g});h.addShape(e);h.position.set(HAND_KEEPER_POSITION.x,HAND_KEEPER_POSITION.y,HAND_KEEPER_POSITION.z);h.addEventListener("collide",function(a){s_oScenario.handCollision(a)});m.addBody(h);SHOW_3D_RENDER&&(p=n.addVisual(h))};this._createBallBody=function(){a=new CANNON.Sphere(BALL_RADIUS);d=new CANNON.Body({mass:BALL_MASS,material:f,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var c=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);
d.position.copy(c);d.sleep();d.addShape(a);m.add(d);SHOW_3D_RENDER&&(b=n.addVisual(d))};this.addImpulse=function(a,b){d.wakeUp();var c=new CANNON.Vec3(0,0,BALL_RADIUS),e=new CANNON.Vec3(b.x,b.y,b.z);a.applyImpulse(e,c)};this.addForce=function(a,b){var c=new CANNON.Vec3(0,0,0),d=new CANNON.Vec3(b.x,b.y,b.z);a.applyForce(d,c)};this.getBodyVelocity=function(a){return a.velocity};this.ballBody=function(){return d};this.ballMesh=function(){return b};this.getCamera=function(){return n.camera()};this.fieldCollision=
function(){s_oGame.ballFadeForReset();playSound("drop_bounce_grass",1,!1)};this.setElementAngularVelocity=function(a,b){a.angularVelocity.set(b.x,b.y,b.z)};this.setElementVelocity=function(a,b){var c=new CANNON.Vec3(b.x,b.y,b.z);a.velocity=c};this.setElementLinearDamping=function(a,b){a.linearDamping=b};this.getFieldBody=function(){return k};this.handCollision=function(a){s_oGame.keeperSave(a.contact.rj)};this.update=function(){m.step(PHYSICS_STEP)};this.getHandKeeperBody=function(){return h};this.getHandKeeperMesh=
function(){return p};this.isBallSleeping=function(){return d.sleepState};this.destroyWorld=function(){for(var a=m.bodies,b=0;b<a.length;b++)m.remove(a[b]);m=null};s_oScenario=this;SHOW_3D_RENDER?(n.addScene("Test",this._init),n.start()):this._init()}var s_oScenario;
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(m){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var m=document.createElement("div");m.id="webgl-error-message";m.style.fontFamily="monospace";m.style.fontSize="13px";m.style.fontWeight="normal";m.style.textAlign="center";m.style.background=
"#fff";m.style.color="#000";m.style.padding="1.5em";m.style.width="400px";m.style.margin="5em auto 0";this.webgl||(m.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return m},addGetWebGLMessage:function(m){m=m||{};var c=void 0!==m.parent?m.parent:document.body;m=void 0!==m.id?m.id:"oldie";var f=Detector.getWebGLErrorMessage();f.id=m;c.appendChild(f)}};
function TimeSeries(m){m=m||{};m.resetBoundsInterval=m.resetBoundsInterval||3E3;m.resetBounds=void 0===m.resetBounds?!0:m.resetBounds;this.options=m;this.data=[];this.label=m.label||"";this.maxDataLength=m.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;m.resetBounds&&(this.boundsTimer=setInterval(function(c){return function(){c.resetBounds()}}(this),m.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var m=0;m<this.data.length;m++)this.maxValue=isNaN(this.maxValue)?this.data[m][1]:Math.max(this.maxValue,this.data[m][1]),this.minValue=isNaN(this.minValue)?this.data[m][1]:Math.min(this.minValue,this.data[m][1])};
TimeSeries.prototype.append=function(m,c){this.lastTimeStamp=m;var f=this.dataPool.length?this.dataPool.pop():[m,c];f[0]=m;f[1]=c;this.data.push(f);this.maxValue=isNaN(this.maxValue)?c:Math.max(this.maxValue,c);for(this.minValue=isNaN(this.minValue)?c:Math.min(this.minValue,c);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(m){m=m||{};m.grid=m.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};m.millisPerPixel=m.millisPerPixel||20;m.fps=m.fps||50;m.maxValueScale=m.maxValueScale||1;m.minValue=m.minValue;m.maxValue=m.maxValue;m.labels=m.labels||{fillStyle:"#ffffff"};m.interpolation=m.interpolation||"bezier";m.scaleSmoothing=m.scaleSmoothing||.125;m.maxDataSetLength=m.maxDataSetLength||2;m.timestampFormatter=m.timestampFormatter||null;this.options=m;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(m,c){this.seriesSet.push({timeSeries:m,options:c||{}})};SmoothieChart.prototype.removeTimeSeries=function(m){this.seriesSet.splice(this.seriesSet.indexOf(m),1)};SmoothieChart.prototype.streamTo=function(m,c){var f=this;this.render_on_tick=function(){f.render(m,f.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(m){function c(c){return(10>c?"0":"")+c}return c(m.getHours())+":"+c(m.getMinutes())+":"+c(m.getSeconds())};
SmoothieChart.prototype.render=function(m,c){var f=m.getContext("2d"),g=this.options,a=m.clientWidth,d=m.clientHeight;f.save();c-=c%g.millisPerPixel;f.translate(0,0);f.beginPath();f.rect(0,0,a,d);f.clip();f.save();f.fillStyle=g.grid.fillStyle;f.clearRect(0,0,a,d);f.fillRect(0,0,a,d);f.restore();f.save();f.lineWidth=g.grid.lineWidth||1;f.strokeStyle=g.grid.strokeStyle||"#ffffff";if(0<g.grid.millisPerLine)for(var b=c-c%g.grid.millisPerLine;b>=c-a*g.millisPerPixel;b-=g.grid.millisPerLine){f.beginPath();
var l=Math.round(a-(c-b)/g.millisPerPixel);f.moveTo(l,0);f.lineTo(l,d);f.stroke();if(g.timestampFormatter){var k=g.timestampFormatter(new Date(b)),e=f.measureText(k).width/2+f.measureText(x).width+4;l<a-e&&(f.fillStyle=g.labels.fillStyle,f.fillText(k,l-f.measureText(k).width/2,d-2))}f.closePath()}for(x=1;x<g.grid.verticalSections;x++)b=Math.round(x*d/g.grid.verticalSections),f.beginPath(),f.moveTo(0,b),f.lineTo(a,b),f.stroke(),f.closePath();f.beginPath();f.strokeRect(0,0,a,d);f.closePath();f.restore();
x=l=Number.NaN;for(k=0;k<this.seriesSet.length;k++){var h=this.seriesSet[k].timeSeries;isNaN(h.maxValue)||(l=isNaN(l)?h.maxValue:Math.max(l,h.maxValue));isNaN(h.minValue)||(x=isNaN(x)?h.minValue:Math.min(x,h.minValue))}if(!isNaN(l)||!isNaN(x)){l=null!=g.maxValue?g.maxValue:l*g.maxValueScale;null!=g.minValue&&(x=g.minValue);this.currentValueRange+=g.scaleSmoothing*(l-x-this.currentValueRange);this.currentVisMinValue+=g.scaleSmoothing*(x-this.currentVisMinValue);e=this.currentValueRange;var p=this.currentVisMinValue;
for(k=0;k<this.seriesSet.length;k++){f.save();h=this.seriesSet[k].timeSeries;h=h.data;for(var n=this.seriesSet[k].options;h.length>=g.maxDataSetLength&&h[1][0]<c-a*g.millisPerPixel;)h.splice(0,1);f.lineWidth=n.lineWidth||1;f.fillStyle=n.fillStyle;f.strokeStyle=n.strokeStyle||"#ffffff";f.beginPath();var q=0,t=0,r=0;for(b=0;b<h.length;b++){var y=Math.round(a-(c-h[b][0])/g.millisPerPixel),u=h[b][1]-p;u=Math.max(Math.min(d-(e?Math.round(u/e*d):0),d-1),1);if(0==b)q=y,f.moveTo(y,u);else switch(g.interpolation){case "line":f.lineTo(y,
u);break;default:f.bezierCurveTo(Math.round((t+y)/2),r,Math.round(t+y)/2,u,y,u)}t=y;r=u}0<h.length&&n.fillStyle&&(f.lineTo(a+n.lineWidth+1,r),f.lineTo(a+n.lineWidth+1,d+n.lineWidth+1),f.lineTo(q,d+n.lineWidth),f.fill());f.stroke();f.closePath();f.restore()}if(!g.labels.disabled){g.labelOffsetY||(g.labelOffsetY=0);f.fillStyle=g.labels.fillStyle;b=parseFloat(l).toFixed(2);var x=parseFloat(x).toFixed(2);f.fillText(b,a-f.measureText(b).width-2,10);f.fillText(x,a-f.measureText(x).width-2,d-2);for(b=0;b<
this.seriesSet.length;b++)h=this.seriesSet[b].timeSeries,a=h.label,f.fillStyle=h.options.fillStyle||"rgb(255,255,255)",a&&f.fillText(a,2,10*(b+1)+g.labelOffsetY)}}f.restore()};
var Stats=function(){var m=0,c=0,f=Date.now(),g=f,a=f,d=0,b=1E3,l=0,k=[[16,16,48],[0,255,255]],e=0,h=1E3,p=0,n=[[16,48,16],[0,255,0]];var q=document.createElement("div");q.style.cursor="pointer";q.style.width="80px";q.style.opacity="0.9";q.style.zIndex="10001";q.addEventListener("mousedown",function(a){a.preventDefault();m=(m+1)%2;0==m?(t.style.display="block",x.style.display="none"):(t.style.display="none",x.style.display="block")},!1);var t=document.createElement("div");t.style.textAlign="left";
t.style.lineHeight="1.2em";t.style.backgroundColor="rgb("+Math.floor(k[0][0]/2)+","+Math.floor(k[0][1]/2)+","+Math.floor(k[0][2]/2)+")";t.style.padding="0 0 3px 3px";q.appendChild(t);var r=document.createElement("div");r.style.fontFamily="Helvetica, Arial, sans-serif";r.style.fontSize="9px";r.style.color="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";r.style.fontWeight="bold";r.innerHTML="FPS";t.appendChild(r);var y=document.createElement("div");y.style.position="relative";y.style.width="74px";y.style.height=
"30px";y.style.backgroundColor="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";for(t.appendChild(y);74>y.children.length;){var u=document.createElement("span");u.style.width="1px";u.style.height="30px";u.style.cssFloat="left";u.style.backgroundColor="rgb("+k[0][0]+","+k[0][1]+","+k[0][2]+")";y.appendChild(u)}var x=document.createElement("div");x.style.textAlign="left";x.style.lineHeight="1.2em";x.style.backgroundColor="rgb("+Math.floor(n[0][0]/2)+","+Math.floor(n[0][1]/2)+","+Math.floor(n[0][2]/2)+")";
x.style.padding="0 0 3px 3px";x.style.display="none";q.appendChild(x);var w=document.createElement("div");w.style.fontFamily="Helvetica, Arial, sans-serif";w.style.fontSize="9px";w.style.color="rgb("+n[1][0]+","+n[1][1]+","+n[1][2]+")";w.style.fontWeight="bold";w.innerHTML="MS";x.appendChild(w);var z=document.createElement("div");z.style.position="relative";z.style.width="74px";z.style.height="30px";z.style.backgroundColor="rgb("+n[1][0]+","+n[1][1]+","+n[1][2]+")";for(x.appendChild(z);74>z.children.length;)u=
document.createElement("span"),u.style.width="1px",u.style.height=30*Math.random()+"px",u.style.cssFloat="left",u.style.backgroundColor="rgb("+n[0][0]+","+n[0][1]+","+n[0][2]+")",z.appendChild(u);return{domElement:q,update:function(){f=Date.now();e=f-g;h=Math.min(h,e);p=Math.max(p,e);w.textContent=e+" MS ("+h+"-"+p+")";var k=Math.min(30,30-e/200*30);z.appendChild(z.firstChild).style.height=k+"px";g=f;c++;f>a+1E3&&(d=Math.round(1E3*c/(f-a)),b=Math.min(b,d),l=Math.max(l,d),r.textContent=d+" FPS ("+
b+"-"+l+")",k=Math.min(30,30-d/100*30),y.appendChild(y.firstChild).style.height=k+"px",a=f,c=0)}}};
THREE.TrackballControls=function(m,c){function f(a){!1!==b.enabled&&(window.removeEventListener("keydown",f),h=e,e===l.NONE)&&(a.keyCode!==b.keys[l.ROTATE]||b.noRotate?a.keyCode!==b.keys[l.ZOOM]||b.noZoom?a.keyCode!==b.keys[l.PAN]||b.noPan||(e=l.PAN):e=l.ZOOM:e=l.ROTATE)}function g(a){!1!==b.enabled&&(a.preventDefault(),a.stopPropagation(),e!==l.ROTATE||b.noRotate?e!==l.ZOOM||b.noZoom?e!==l.PAN||b.noPan||w.copy(D(a.pageX,a.pageY)):r.copy(D(a.pageX,a.pageY)):q.copy(G(a.pageX,a.pageY)))}function a(c){!1!==
b.enabled&&(c.preventDefault(),c.stopPropagation(),e=l.NONE,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",a),b.dispatchEvent(C))}function d(a){if(!1!==b.enabled){a.preventDefault();a.stopPropagation();var c=0;a.wheelDelta?c=a.wheelDelta/40:a.detail&&(c=-a.detail/3);t.y+=.01*c;b.dispatchEvent(A);b.dispatchEvent(C)}}var b=this,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=m;this.domElement=void 0!==c?c:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var k=new THREE.Vector3,e=l.NONE,h=l.NONE,p=new THREE.Vector3,n=new THREE.Vector3,q=new THREE.Vector3,t=new THREE.Vector2,r=new THREE.Vector2,y=0,u=0,x=new THREE.Vector2,w=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var z={type:"change"},A={type:"start"},C={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;
this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var D=function(){var a=new THREE.Vector2;return function(c,d){a.set((c-b.screen.left)/b.screen.width,(d-b.screen.top)/b.screen.height);return a}}(),G=function(){var a=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f){d.set((e-.5*b.screen.width-b.screen.left)/(.5*b.screen.width),(.5*b.screen.height+b.screen.top-f)/(.5*b.screen.height),
0);var g=d.length();b.noRoll?d.z=g<Math.SQRT1_2?Math.sqrt(1-g*g):.5/g:1<g?d.normalize():d.z=Math.sqrt(1-g*g);p.copy(b.object.position).sub(b.target);a.copy(b.object.up).setLength(d.y);a.add(c.copy(b.object.up).cross(p).setLength(d.x));a.add(p.setLength(d.z));return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,c=new THREE.Quaternion;return function(){var d=Math.acos(n.dot(q)/n.length()/q.length());d&&(a.crossVectors(n,q).normalize(),d*=b.rotateSpeed,c.setFromAxisAngle(a,-d),p.applyQuaternion(c),
b.object.up.applyQuaternion(c),q.applyQuaternion(c),b.staticMoving?n.copy(q):(c.setFromAxisAngle(a,d*(b.dynamicDampingFactor-1)),n.applyQuaternion(c)))}}();this.zoomCamera=function(){if(e===l.TOUCH_ZOOM_PAN){var a=y/u;y=u;p.multiplyScalar(a)}else a=1+(r.y-t.y)*b.zoomSpeed,1!==a&&0<a&&(p.multiplyScalar(a),b.staticMoving?t.copy(r):t.y+=(r.y-t.y)*this.dynamicDampingFactor)};this.panCamera=function(){var a=new THREE.Vector2,c=new THREE.Vector3,d=new THREE.Vector3;return function(){a.copy(w).sub(x);a.lengthSq()&&
(a.multiplyScalar(p.length()*b.panSpeed),d.copy(p).cross(b.object.up).setLength(a.x),d.add(c.copy(b.object.up).setLength(a.y)),b.object.position.add(d),b.target.add(d),b.staticMoving?x.copy(w):x.add(a.subVectors(w,x).multiplyScalar(b.dynamicDampingFactor)))}}();this.checkDistances=function(){b.noZoom&&b.noPan||(p.lengthSq()>b.maxDistance*b.maxDistance&&b.object.position.addVectors(b.target,p.setLength(b.maxDistance)),p.lengthSq()<b.minDistance*b.minDistance&&b.object.position.addVectors(b.target,
p.setLength(b.minDistance)))};this.update=function(){p.subVectors(b.object.position,b.target);b.noRotate||b.rotateCamera();b.noZoom||b.zoomCamera();b.noPan||b.panCamera();b.object.position.addVectors(b.target,p);b.checkDistances();b.object.lookAt(b.target);1E-6<k.distanceToSquared(b.object.position)&&(b.dispatchEvent(z),k.copy(b.object.position))};this.reset=function(){h=e=l.NONE;b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.up.copy(b.up0);p.subVectors(b.object.position,b.target);
b.object.lookAt(b.target);b.dispatchEvent(z);k.copy(b.object.position)};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){!1!==b.enabled&&(c.preventDefault(),c.stopPropagation(),e===l.NONE&&(e=c.button),e!==l.ROTATE||b.noRotate?e!==l.ZOOM||b.noZoom?e!==l.PAN||b.noPan||(x.copy(D(c.pageX,c.pageY)),w.copy(x)):(t.copy(D(c.pageX,c.pageY)),r.copy(t)):(n.copy(G(c.pageX,c.pageY)),q.copy(n)),document.addEventListener("mousemove",
g,!1),document.addEventListener("mouseup",a,!1),b.dispatchEvent(A))},!1);this.domElement.addEventListener("mousewheel",d,!1);this.domElement.addEventListener("DOMMouseScroll",d,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==b.enabled){switch(a.touches.length){case 1:e=l.TOUCH_ROTATE;n.copy(G(a.touches[0].pageX,a.touches[0].pageY));q.copy(n);break;case 2:e=l.TOUCH_ZOOM_PAN;var c=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY;u=y=Math.sqrt(c*c+d*
d);x.copy(D((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));w.copy(x);break;default:e=l.NONE}b.dispatchEvent(A)}},!1);this.domElement.addEventListener("touchend",function(a){if(!1!==b.enabled){switch(a.touches.length){case 1:q.copy(G(a.touches[0].pageX,a.touches[0].pageY));n.copy(q);break;case 2:y=u=0,w.copy(D((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),x.copy(w)}e=l.NONE;b.dispatchEvent(C)}},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:q.copy(G(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var c=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY;u=Math.sqrt(c*c+d*d);w.copy(D((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:e=l.NONE}},!1);window.addEventListener("keydown",f,!1);window.addEventListener("keyup",function(a){!1!==b.enabled&&(e=h,window.addEventListener("keydown",
f,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(m,c){c=c||document;var f=c.createElement("link");f.type="text/css";f.rel="stylesheet";f.href=m;c.getElementsByTagName("head")[0].appendChild(f)},inject:function(m,c){c=c||document;var f=document.createElement("style");f.type="text/css";f.innerHTML=m;c.getElementsByTagName("head")[0].appendChild(f)}}}();
dat.utils.common=function(){var m=Array.prototype.forEach,c=Array.prototype.slice;return{BREAK:{},extend:function(f){this.each(c.call(arguments,1),function(c){for(var a in c)this.isUndefined(c[a])||(f[a]=c[a])},this);return f},defaults:function(f){this.each(c.call(arguments,1),function(c){for(var a in c)this.isUndefined(f[a])&&(f[a]=c[a])},this);return f},compose:function(){var f=c.call(arguments);return function(){for(var g=c.call(arguments),a=f.length-1;0<=a;a--)g=[f[a].apply(this,g)];return g[0]}},
each:function(c,g,a){if(m&&c.forEach===m)c.forEach(g,a);else if(c.length===c.length+0)for(var d=0,b=c.length;d<b&&!(d in c&&g.call(a,c[d],d)===this.BREAK);d++);else for(d in c)if(g.call(a,c[d],d)===this.BREAK)break},defer:function(c){setTimeout(c,0)},toArray:function(f){return f.toArray?f.toArray():c.call(f)},isUndefined:function(c){return void 0===c},isNull:function(c){return null===c},isNaN:function(c){return c!==c},isArray:Array.isArray||function(c){return c.constructor===Array},isObject:function(c){return c===
Object(c)},isNumber:function(c){return c===c+0},isString:function(c){return c===c+""},isBoolean:function(c){return!1===c||!0===c},isFunction:function(c){return"[object Function]"===Object.prototype.toString.call(c)}}}();
dat.controllers.Controller=function(m){var c=function(c,g){this.initialValue=c[g];this.domElement=document.createElement("div");this.object=c;this.property=g;this.__onFinishChange=this.__onChange=void 0};m.extend(c.prototype,{onChange:function(c){this.__onChange=c;return this},onFinishChange:function(c){this.__onFinishChange=c;return this},setValue:function(c){this.object[this.property]=c;this.__onChange&&this.__onChange.call(this,c);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return c}(dat.utils.common);
dat.dom.dom=function(m){function c(a){if("0"===a||m.isUndefined(a))return 0;a=a.match(g);return m.isNull(a)?0:parseFloat(a[1])}var f={};m.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(a,b){m.each(a,function(a){f[a]=b})});var g=/(\d+(\.\d+)?)px/,a={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(a,b,c){m.isUndefined(b)&&(b=!0);m.isUndefined(c)&&(c=!0);a.style.position="absolute";b&&(a.style.left=0,a.style.right=0);c&&(a.style.top=0,a.style.bottom=0)},fakeEvent:function(a,b,c,g){c=c||{};var d=f[b];if(!d)throw Error("Event type "+b+" not supported.");var h=document.createEvent(d);switch(d){case "MouseEvents":h.initMouseEvent(b,c.bubbles||!1,c.cancelable||!0,window,c.clickCount||1,0,0,c.x||c.clientX||0,c.y||c.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":d=h.initKeyboardEvent||h.initKeyEvent;m.defaults(c,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});d(b,c.bubbles||!1,c.cancelable,window,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.keyCode,c.charCode);break;default:h.initEvent(b,c.bubbles||!1,c.cancelable||!0)}m.defaults(h,g);a.dispatchEvent(h)},bind:function(c,b,f,g){c.addEventListener?c.addEventListener(b,f,g||!1):c.attachEvent&&c.attachEvent("on"+b,f);return a},
unbind:function(c,b,f,g){c.removeEventListener?c.removeEventListener(b,f,g||!1):c.detachEvent&&c.detachEvent("on"+b,f);return a},addClass:function(c,b){if(void 0===c.className)c.className=b;else if(c.className!==b){var d=c.className.split(/ +/);-1==d.indexOf(b)&&(d.push(b),c.className=d.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return a},removeClass:function(c,b){if(b){if(void 0!==c.className)if(c.className===b)c.removeAttribute("class");else{var d=c.className.split(/ +/),f=d.indexOf(b);-1!=
f&&(d.splice(f,1),c.className=d.join(" "))}}else c.className=void 0;return a},hasClass:function(a,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return c(a["border-left-width"])+c(a["border-right-width"])+c(a["padding-left"])+c(a["padding-right"])+c(a.width)},getHeight:function(a){a=getComputedStyle(a);return c(a["border-top-width"])+c(a["border-bottom-width"])+c(a["padding-top"])+c(a["padding-bottom"])+c(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return a}(dat.utils.common);
dat.controllers.OptionController=function(m,c,f){var g=function(a,d,b){g.superclass.call(this,a,d);var l=this;this.__select=document.createElement("select");if(f.isArray(b)){var k={};f.each(b,function(a){k[a]=a});b=k}f.each(b,function(a,b){var c=document.createElement("option");c.innerHTML=b;c.setAttribute("value",a);l.__select.appendChild(c)});this.updateDisplay();c.bind(this.__select,"change",function(){l.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
g.superclass=m;f.extend(g.prototype,m.prototype,{setValue:function(a){a=g.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(m,c){var f=function(g,a,d){f.superclass.call(this,g,a);d=d||{};this.__min=d.min;this.__max=d.max;this.__step=d.step;c.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;g=this.__impliedStep;g=g.toString();g=-1<g.indexOf(".")?g.length-g.indexOf(".")-1:0;this.__precision=g};f.superclass=m;c.extend(f.prototype,m.prototype,{setValue:function(c){void 0!==
this.__min&&c<this.__min?c=this.__min:void 0!==this.__max&&c>this.__max&&(c=this.__max);void 0!==this.__step&&0!=c%this.__step&&(c=Math.round(c/this.__step)*this.__step);return f.superclass.prototype.setValue.call(this,c)},min:function(c){this.__min=c;return this},max:function(c){this.__max=c;return this},step:function(c){this.__step=c;return this}});return f}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(m,c,f){var g=function(a,d,b){function l(){var a=parseFloat(h.__input.value);f.isNaN(a)||h.setValue(a)}function k(a){var b=m-a.clientY;h.setValue(h.getValue()+b*h.__impliedStep);m=a.clientY}function e(){c.unbind(window,"mousemove",k);c.unbind(window,"mouseup",e)}this.__truncationSuspended=!1;g.superclass.call(this,a,d,b);var h=this,m;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"change",l);c.bind(this.__input,
"blur",function(){l();h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())});c.bind(this.__input,"mousedown",function(a){c.bind(window,"mousemove",k);c.bind(window,"mouseup",e);m=a.clientY});c.bind(this.__input,"keydown",function(a){13===a.keyCode&&(h.__truncationSuspended=!0,this.blur(),h.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};g.superclass=m;f.extend(g.prototype,m.prototype,{updateDisplay:function(){var a=this.__input;if(this.__truncationSuspended)var c=
this.getValue();else{c=this.getValue();var b=Math.pow(10,this.__precision);c=Math.round(c*b)/b}a.value=c;return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(m,c,f,g,a){function d(a,b,c,d,f){return d+(a-b)/(c-b)*(f-d)}var b=function(a,f,e,g,m){function h(a){a.preventDefault();var b=c.getOffset(l.__background),e=c.getWidth(l.__background);l.setValue(d(a.clientX,b.left,b.left+e,l.__min,l.__max));return!1}function k(){c.unbind(window,"mousemove",h);c.unbind(window,"mouseup",k);l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}b.superclass.call(this,a,f,{min:e,max:g,step:m});var l=this;this.__background=
document.createElement("div");this.__foreground=document.createElement("div");c.bind(this.__background,"mousedown",function(a){c.bind(window,"mousemove",h);c.bind(window,"mouseup",k);h(a)});c.addClass(this.__background,"slider");c.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};b.superclass=m;b.useDefaultStyles=function(){f.inject(a)};g.extend(b.prototype,m.prototype,{updateDisplay:function(){var a=
(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*a+"%";return b.superclass.prototype.updateDisplay.call(this)}});return b}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(m,c,f){var g=function(a,d,b){g.superclass.call(this,a,d);var f=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===b?"Fire":b;c.bind(this.__button,"click",function(a){a.preventDefault();f.fire();return!1});c.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};g.superclass=m;f.extend(g.prototype,m.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(m,c,f){var g=function(a,d){g.superclass.call(this,a,d);var b=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");c.bind(this.__checkbox,"change",function(){b.setValue(!b.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};g.superclass=m;f.extend(g.prototype,m.prototype,{setValue:function(a){a=g.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(m){return function(c){if(1==c.a||m.isUndefined(c.a)){for(c=c.hex.toString(16);6>c.length;)c="0"+c;return"#"+c}return"rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+c.a+")"}}(dat.utils.common);
dat.color.interpret=function(m,c){var f,g,a=[{litmus:c.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:m},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:m},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:m},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:m}}},{litmus:c.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:c.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:c.isObject,conversions:{RGBA_OBJ:{read:function(a){return c.isNumber(a.r)&&c.isNumber(a.g)&&c.isNumber(a.b)&&c.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return c.isNumber(a.r)&&
c.isNumber(a.g)&&c.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return c.isNumber(a.h)&&c.isNumber(a.s)&&c.isNumber(a.v)&&c.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return c.isNumber(a.h)&&c.isNumber(a.s)&&c.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){g=!1;
var d=1<arguments.length?c.toArray(arguments):arguments[0];c.each(a,function(a){if(a.litmus(d))return c.each(a.conversions,function(a,b){f=a.read(d);if(!1===g&&!1!==f)return g=f,f.conversionName=b,f.conversion=a,c.BREAK}),c.BREAK});return g}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(m,c,f,g,a,d,b,l,k,e,h,p,n,q,t){function r(b,c,d,e){if(void 0===c[d])throw Error("Object "+c+' has no property "'+d+'"');e.color?c=new h(c,d):(c=[c,d].concat(e.factoryArgs),c=g.apply(b,c));e.before instanceof a&&(e.before=e.before.__li);x(b,c);q.addClass(c.domElement,"c");d=document.createElement("span");q.addClass(d,"property-name");d.innerHTML=c.property;var f=document.createElement("div");f.appendChild(d);f.appendChild(c.domElement);e=y(b,f,e.before);q.addClass(e,K.CLASS_CONTROLLER_ROW);
q.addClass(e,typeof c.getValue());u(b,e,c);b.__controllers.push(c);return c}function y(a,b,c){var d=document.createElement("li");b&&d.appendChild(b);c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d);a.onResize();return d}function u(a,c,e){e.__li=c;e.__gui=a;t.extend(e,{options:function(b){if(1<arguments.length)return e.remove(),r(a,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[t.toArray(arguments)]});if(t.isArray(b)||t.isObject(b))return e.remove(),r(a,e.object,e.property,
{before:e.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){e.__li.firstElementChild.firstElementChild.innerHTML=a;return e},listen:function(){e.__gui.listen(e);return e},remove:function(){e.__gui.remove(e);return e}});if(e instanceof k){var f=new l(e.object,e.property,{min:e.__min,max:e.__max,step:e.__step});t.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=e[a],c=f[a];e[a]=f[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(e,a);return c.apply(f,a)}});
q.addClass(c,"has-slider");e.domElement.insertBefore(f.domElement,e.domElement.firstElementChild)}else if(e instanceof l){var g=function(b){return t.isNumber(e.__min)&&t.isNumber(e.__max)?(e.remove(),r(a,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[e.__min,e.__max,e.__step]})):b};e.min=t.compose(g,e.min);e.max=t.compose(g,e.max)}else e instanceof d?(q.bind(c,"click",function(){q.fakeEvent(e.__checkbox,"click")}),q.bind(e.__checkbox,"click",function(a){a.stopPropagation()})):
e instanceof b?(q.bind(c,"click",function(){q.fakeEvent(e.__button,"click")}),q.bind(c,"mouseover",function(){q.addClass(e.__button,"hover")}),q.bind(c,"mouseout",function(){q.removeClass(e.__button,"hover")})):e instanceof h&&(q.addClass(c,"color"),e.updateDisplay=t.compose(function(a){c.style.borderLeftColor=e.__color.toString();return a},e.updateDisplay),e.updateDisplay());e.setValue=t.compose(function(b){a.getRoot().__preset_select&&e.isModified()&&G(a.getRoot(),!0);return b},e.setValue)}function x(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e);e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c.Default)c=c.Default;else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function w(a){var b=a.__save_row=document.createElement("li");q.addClass(a.domElement,"has-save");
a.__ul.insertBefore(b,a.__ul.firstChild);q.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";q.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";q.addClass(d,"button");q.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New";q.addClass(e,"button");q.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert";q.addClass(f,"button");q.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");
a.load&&a.load.remembered?t.each(a.load.remembered,function(b,c){D(a,c,c==a.preset)}):D(a,"Default",!1);q.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(g);b.appendChild(c);b.appendChild(d);b.appendChild(e);b.appendChild(f);if(J){var h=function(){k.style.display=a.useLocalStorage?"block":"none"};b=document.getElementById("dg-save-locally");var k=document.getElementById("dg-local-explain");
b.style.display="block";b=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");h();q.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;h()})}var l=document.getElementById("dg-new-constructor");q.bind(l,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||L.hide()});q.bind(c,"click",function(){l.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);L.show();l.focus();l.select()});q.bind(d,
"click",function(){a.save()});q.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});q.bind(f,"click",function(){a.revert()})}function z(a){function b(b){b.preventDefault();e=b.clientX;q.addClass(a.__closeButton,K.CLASS_DRAG);q.bind(window,"mousemove",c);q.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=e-b.clientX;a.onResize();e=b.clientX;return!1}function d(){q.removeClass(a.__closeButton,K.CLASS_DRAG);q.unbind(window,"mousemove",c);q.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");t.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;q.bind(a.__resize_handle,"mousedown",b);q.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function A(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function C(a,b){var c={};t.each(a.__rememberedObjects,function(d,e){var f={};t.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()});c[e]=f});return c}function D(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function G(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function H(a){0!=a.length&&
p(function(){H(a)});t.each(a,function(a){a.updateDisplay()})}m.inject(f);try{var J="localStorage"in window&&null!==window.localStorage}catch(E){J=!1}var L,O=!0,U,M=!1,Q=[],K=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1;t.defer(function(){--a.width})}var d=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);q.addClass(this.domElement,
"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=t.defaults(a,{autoPlace:!0,width:K.DEFAULT_WIDTH});a=t.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});t.isUndefined(a.load)?a.load={preset:"Default"}:a.preset&&(a.load.preset=a.preset);t.isUndefined(a.parent)&&a.hideable&&Q.push(this);a.resizable=t.isUndefined(a.parent)&&a.resizable;a.autoPlace&&t.isUndefined(a.scrollable)&&(a.scrollable=
!0);var e=J&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=
b);d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;A(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;g&&(g.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?q.addClass(d.__ul,K.CLASS_CLOSED):q.removeClass(d.__ul,K.CLASS_CLOSED);this.onResize();d.__closeButton&&(d.__closeButton.innerHTML=b?K.TEXT_OPEN:K.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){J&&
((e=a)?q.bind(window,"unload",b):q.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(t.isUndefined(a.parent)){a.closed=!1;q.addClass(this.domElement,K.CLASS_MAIN);q.makeSelectable(this.domElement,!1);if(J&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=K.TEXT_CLOSED;q.addClass(this.__closeButton,K.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
q.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);q.addClass(g,"controller-name");f=y(d,g);q.addClass(this.__ul,K.CLASS_CLOSED);q.addClass(f,"title");q.bind(f,"click",function(a){a.preventDefault();d.closed=!d.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(t.isUndefined(a.parent)&&(O&&(U=document.createElement("div"),q.addClass(U,"dg"),q.addClass(U,K.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(U),
O=!1),U.appendChild(this.domElement),q.addClass(this.domElement,K.CLASS_AUTO_PLACE)),this.parent||A(d,a.width));q.bind(window,"resize",function(){d.onResize()});q.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()});q.bind(this.__ul,"transitionend",function(){d.onResize()});q.bind(this.__ul,"oTransitionEnd",function(){d.onResize()});this.onResize();a.resizable&&z(this);d.getRoot();a.parent||c()};K.toggleHide=function(){M=!M;t.each(Q,function(a){a.domElement.style.zIndex=M?-999:999;a.domElement.style.opacity=
M?0:1})};K.CLASS_AUTO_PLACE="a";K.CLASS_AUTO_PLACE_CONTAINER="ac";K.CLASS_MAIN="main";K.CLASS_CONTROLLER_ROW="cr";K.CLASS_TOO_TALL="taller-than-window";K.CLASS_CLOSED="closed";K.CLASS_CLOSE_BUTTON="close-button";K.CLASS_DRAG="drag";K.DEFAULT_WIDTH=245;K.TEXT_CLOSED="Close Controls";K.TEXT_OPEN="Open Controls";q.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||K.toggleHide()},!1);t.extend(K.prototype,{add:function(a,b){return r(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return r(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;t.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&U.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new K(b);this.__folders[a]=b;a=y(this,b.domElement);q.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=q.getOffset(a.__ul).top,c=0;t.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=q.getHeight(b))});window.innerHeight-b-20<c?(q.addClass(a.domElement,K.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(q.removeClass(a.domElement,K.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&t.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){t.isUndefined(L)&&(L=new n,L.domElement.innerHTML=c);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;t.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&w(a);-1==
a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)});this.autoPlace&&A(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=C(this));a.folders={};t.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=C(this);G(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=C(this,!0));this.load.remembered[a]=C(this);this.preset=a;D(this,a,!0)},revert:function(a){t.each(this.__controllers,function(b){this.getRoot().load.remembered?x(a||this.getRoot(),b):b.setValue(b.initialValue)},this);t.each(this.__folders,function(a){a.revert(a)});a||G(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);
b&&H(this.__listening)}});return K}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(m,c,f,g,a,d,b){return function(l,k,e,h){var p=l[k];if(b.isArray(e)||b.isObject(e))return new m(l,k,e);if(b.isNumber(p))return b.isNumber(e)&&b.isNumber(h)?new f(l,k,e,h):new c(l,k,{min:e,max:h});if(b.isString(p))return new g(l,k);if(b.isFunction(p))return new a(l,k,"");if(b.isBoolean(p))return new d(l,k)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(m,c,f){var g=
function(a,d){function b(){f.setValue(f.__input.value)}g.superclass.call(this,a,d);var f=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"keyup",b);c.bind(this.__input,"change",b);c.bind(this.__input,"blur",function(){f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())});c.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};g.superclass=m;f.extend(g.prototype,
m.prototype,{updateDisplay:function(){c.isActive(this.__input)||(this.__input.value=this.getValue());return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(m,c,f,g,a){function d(b,c,d,f){b.style.background="";a.each(k,function(a){b.style.cssText+="background: "+a+"linear-gradient("+c+", "+d+" 0%, "+f+" 100%); "})}function b(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var l=function(e,h){function k(a){r(a);c.bind(window,"mousemove",r);c.bind(window,
"mouseup",n)}function n(){c.unbind(window,"mousemove",r);c.unbind(window,"mouseup",n)}function m(){var a=g(this.value);!1!==a?(u.__color.__state=a,u.setValue(u.__color.toOriginal())):this.value=u.__color.toString()}function t(){c.unbind(window,"mousemove",y);c.unbind(window,"mouseup",t)}function r(a){a.preventDefault();var b=c.getWidth(u.__saturation_field),d=c.getOffset(u.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/b;a=1-(a.clientY-d.top+document.body.scrollTop)/b;1<a?a=1:0>
a&&(a=0);1<e?e=1:0>e&&(e=0);u.__color.v=a;u.__color.s=e;u.setValue(u.__color.toOriginal());return!1}function y(a){a.preventDefault();var b=c.getHeight(u.__hue_field),d=c.getOffset(u.__hue_field);a=1-(a.clientY-d.top+document.body.scrollTop)/b;1<a?a=1:0>a&&(a=0);u.__color.h=360*a;u.setValue(u.__color.toOriginal());return!1}l.superclass.call(this,e,h);this.__color=new f(this.getValue());this.__temp=new f(0);var u=this;this.domElement=document.createElement("div");c.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";c.bind(this.__input,"keydown",function(a){13===a.keyCode&&m.call(this)});c.bind(this.__input,"blur",m);c.bind(this.__selector,"mousedown",function(a){c.addClass(this,"drag").bind(window,"mouseup",function(a){c.removeClass(u.__selector,"drag")})});var x=document.createElement("div");a.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});a.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});a.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});a.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});a.extend(x.style,{width:"100%",height:"100%",
background:"none"});d(x,"top","rgba(0,0,0,0)","#000");a.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});b(this.__hue_field);a.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});c.bind(this.__saturation_field,"mousedown",k);c.bind(this.__field_knob,"mousedown",k);c.bind(this.__hue_field,"mousedown",function(a){y(a);c.bind(window,
"mousemove",y);c.bind(window,"mouseup",t)});this.__saturation_field.appendChild(x);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};l.superclass=m;a.extend(l.prototype,m.prototype,{updateDisplay:function(){var b=g(this.getValue());if(!1!==b){var c=!1;
a.each(f.COMPONENTS,function(d){if(!a.isUndefined(b[d])&&!a.isUndefined(this.__color.__state[d])&&b[d]!==this.__color.__state[d])return c=!0,{}},this);c&&a.extend(this.__color.__state,b)}a.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var k=.5>this.__color.v||.5<this.__color.s?255:0,l=255-k;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+k+
","+k+","+k+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;d(this.__saturation_field,"left","#fff",this.__temp.toString());a.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+k+","+k+","+k+")",textShadow:this.__input_textShadow+"rgba("+l+","+l+","+l+",.7)"})}});var k=["-moz-","-o-","-webkit-","-ms-",""];return l}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(m,c,f,g){function a(a,
c,d){Object.defineProperty(a,c,{get:function(){if("RGB"===this.__state.space)return this.__state[c];b(this,c,d);return this.__state[c]},set:function(a){"RGB"!==this.__state.space&&(b(this,c,d),this.__state.space="RGB");this.__state[c]=a}})}function d(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];l(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(l(this),this.__state.space="HSV");this.__state[b]=a}})}function b(a,b,d){if("HEX"===
a.__state.space)a.__state[b]=c.component_from_hex(a.__state.hex,d);else if("HSV"===a.__state.space)g.extend(a.__state,c.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function l(a){var b=c.rgb_to_hsv(a.r,a.g,a.b);g.extend(a.__state,{s:b.s,v:b.v});g.isNaN(b.h)?g.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=b.h}var k=function(){this.__state=m.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};k.COMPONENTS="r g b h s v hex a".split(" ");g.extend(k.prototype,{toString:function(){return f(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(k.prototype,"r",2);a(k.prototype,"g",1);a(k.prototype,"b",0);d(k.prototype,"h");d(k.prototype,"s");d(k.prototype,"v");Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(k.prototype,"hex",{get:function(){this.__state.hex=c.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return k}(dat.color.interpret,dat.color.math=function(){var m;return{hsv_to_rgb:function(c,f,g){var a=c/60-Math.floor(c/60),d=g*(1-f),b=g*(1-a*f);f=g*(1-(1-a)*f);c=[[g,f,d],[b,g,d],[d,g,f],[d,b,g],[f,d,g],[g,d,b]][Math.floor(c/60)%6];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(c,f,g){var a=Math.max(c,f,g),d=a-Math.min(c,f,g);if(0==a)return{h:NaN,s:0,v:0};c=(c==a?(f-g)/d:f==a?2+(g-c)/d:
4+(c-f)/d)/6;0>c&&(c+=1);return{h:360*c,s:d/a,v:a/255}},rgb_to_hex:function(c,f,g){c=this.hex_with_component(0,2,c);c=this.hex_with_component(c,1,f);return c=this.hex_with_component(c,0,g)},component_from_hex:function(c,f){return c>>8*f&255},hex_with_component:function(c,f,g){return g<<(m=8*f)|c&~(255<<m)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(m,c){window.setTimeout(m,1E3/60)}}(),dat.dom.CenteredDiv=function(m,c){var f=function(){this.backgroundElement=document.createElement("div");c.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});m.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
c.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var f=this;m.bind(this.backgroundElement,"click",function(){f.hide()})};f.prototype.show=function(){var f=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();c.defer(function(){f.backgroundElement.style.opacity=1;f.domElement.style.opacity=1;f.domElement.style.webkitTransform="scale(1)"})};f.prototype.hide=function(){var c=this,a=function(){c.domElement.style.display="none";c.backgroundElement.style.display="none";m.unbind(c.domElement,"webkitTransitionEnd",a);m.unbind(c.domElement,"transitionend",a);m.unbind(c.domElement,"oTransitionEnd",a)};m.bind(this.domElement,"webkitTransitionEnd",a);m.bind(this.domElement,"transitionend",
a);m.bind(this.domElement,"oTransitionEnd",a);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};f.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-m.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-m.getHeight(this.domElement)/2+"px"};return f}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
function CWinPanel(m,c){var f,g,a,d,b,l,k,e,h,p;this._init=function(c,m){p=new createjs.Shape;p.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);p.alpha=0;s_oStage.addChild(p);k=new createjs.Container;k.alpha=1;k.visible=!1;k.y=CANVAS_HEIGHT;f=createBitmap(c);f.x=CANVAS_WIDTH_HALF;f.y=CANVAS_HEIGHT_HALF;f.regX=.5*c.width;f.regY=.5*c.height;k.addChild(f);a=new CTLText(k,CANVAS_WIDTH/2-360,CANVAS_HEIGHT_HALF-230,720,70,70,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!1,!1);g=new CTLText(k,
CANVAS_WIDTH/2-360,CANVAS_HEIGHT/2-120,720,34,34,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!1,!1);d=new CTLText(k,CANVAS_WIDTH/2-360,CANVAS_HEIGHT/2,720,34,34,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!1,!1);b=new CTLText(k,CANVAS_WIDTH/2-360,CANVAS_HEIGHT/2+50,720,34,34,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!1,!1);l=new CTLText(k,CANVAS_WIDTH/2-250,CANVAS_HEIGHT/2+170,500,34,34,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!1,!1);var n=s_oSpriteLibrary.getSprite("but_continue");h=
new CGfxButton(.5*CANVAS_WIDTH+360,.5*CANVAS_HEIGHT+180,n,k);h.pulseAnimation();!1===m?(n=s_oSpriteLibrary.getSprite("but_home"),e=new CGfxButton(.5*CANVAS_WIDTH-360,.5*CANVAS_HEIGHT+180,n,k),e.addEventListener(ON_MOUSE_DOWN,this._onExit,this),h.addEventListener(ON_MOUSE_DOWN,this._onContinue,this)):h.addEventListener(ON_MOUSE_DOWN,this._onEnd,this);s_oStage.addChild(k)};this.unload=function(){s_oStage.removeChild(k);e&&(e.unload(),e=null);h&&(h.unload(),h=null)};this.show=function(c,e,f){a.refreshText(TEXT_WIN);
g.refreshText(TEXT_CAUGHT+" "+c+" "+TEXT_OF+" "+e+" "+TEXT_BALLS);d.refreshText(TEXT_SCORE_BALL_CATCH+": "+f.ball_saved);b.refreshText(TEXT_MISS_BALL+": "+f.num_miss);l.refreshText(TEXT_TOTAL_SCORE+": "+f.new_score);k.visible=!0;createjs.Tween.get(p).to({alpha:.5},500,createjs.Ease.cubicOut);createjs.Tween.get(k).wait(250).to({y:0},1250,createjs.Ease.bounceOut).call(function(){s_iAdsLevel===NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++});$(s_oMain).trigger("save_score",
f.new_score);$(s_oMain).trigger("share_event",f.new_score)};this._onContinue=function(){var a=this;createjs.Tween.get(k).to({y:CANVAS_HEIGHT},750,createjs.Ease.quartIn).call(function(){a.unload()});createjs.Tween.get(p).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(p);p.removeAllEventListeners()});h.block(!0);e.block(!0);s_oGame.onContinue(s_oStage.getChildIndex(k))};this._onEnd=function(){this.unload();s_oGame._onEnd()};this._onExit=function(){this.unload();p.off("click",
function(){});s_oGame.onExit()};this._init(m,c);return this}
function CGloves(m,c,f,g,a){var d;this._init=function(a,b,c){var e=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{normal:[0],perfect:[1]}});d=createSprite(e,"normal",c.width/2/2,c.height/2,c.width/2,c.height);this.setPosition(a,b);l.addChild(d)};this.unload=function(){l.removeChild(d)};this.setPosition=function(a,b){d.x=a;d.y=b};this.getObject=function(){return d};this.getDepthPos=function(){return b.position.y};this.getX=
function(){return d.x};this.getY=function(){return d.y};this.changeState=function(a){d.gotoAndStop(a)};this.getPhysics=function(){return b};this.setRotation=function(a){d.rotation=a};var b=g;var l=a;this._init(m,c,f);return this}
function CLosePanel(m){var c,f,g,a,d=null,b,l,k=!1;this._init=function(e){l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.alpha=0;s_oStage.addChild(l);a=new createjs.Container;a.alpha=1;a.visible=!1;a.y=CANVAS_HEIGHT;c=createBitmap(e);c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF;c.regX=.5*e.width;c.regY=.5*e.height;a.addChild(c);f=new CTLText(a,CANVAS_WIDTH/2-220,CANVAS_HEIGHT_HALF,440,90,45,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!0,!1);g=new CTLText(a,
CANVAS_WIDTH/2-360,CANVAS_HEIGHT_HALF-210,720,100,100,"center",TEXT_COLOR,FONT_GAME,1,0,0," ",!0,!0,!0,!1);s_oStage.addChild(a);e=s_oSpriteLibrary.getSprite("but_home");d=new CGfxButton(.5*CANVAS_WIDTH-360,.5*CANVAS_HEIGHT+180,e,a);d.addEventListener(ON_MOUSE_DOWN,this._onExit,this);e=s_oSpriteLibrary.getSprite("but_restart");b=new CGfxButton(.5*CANVAS_WIDTH+360,.5*CANVAS_HEIGHT+180,e,a);b.addEventListener(ON_MOUSE_DOWN,this._onRestart,this);b.pulseAnimation()};this.unload=function(){createjs.Tween.get(a).to({alpha:0},
500,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(a);null!==d&&(d.unload(),d=null);l.removeAllEventListeners();b.unload();b=null})};this.show=function(b,c){f.refreshText(TEXT_CAUGHT+" "+b+" "+TEXT_OF+" "+c+" "+TEXT_BALLS);g.refreshText(TEXT_LOSE);a.visible=!0;createjs.Tween.get(l).to({alpha:.5},500,createjs.Ease.cubicOut);l.on("click",function(){});createjs.Tween.get(a).wait(250).to({y:0},1250,createjs.Ease.elasticOut).call(function(){s_iAdsLevel===NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),
s_iAdsLevel=1):s_iAdsLevel++})};this._onRestart=function(){k||(k=!0,this.unload(),createjs.Tween.get(l).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(l)}),s_oGame.restartLevel())};this._onExit=function(){k||(k=!0,this.unload(),s_oGame.onExit())};this._init(m);return this}
function CAreYouSurePanel(m){var c,f,g,a,d;this._init=function(){a=new createjs.Container;a.alpha=0;b.addChild(a);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=.5;d.on("click",function(){});a.addChild(d);var l=s_oSpriteLibrary.getSprite("msg_box_small");c=createBitmap(l);c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF+50;c.regX=.5*l.width;c.regY=.5*l.height;a.addChild(c);new CTLText(a,CANVAS_WIDTH/2-220,CANVAS_HEIGHT_HALF-100,440,150,60,"center",
"#fff",FONT_GAME,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);f=new CGfxButton(CANVAS_WIDTH/2+180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_yes"),a);f.addEventListener(ON_MOUSE_UP,this._onButYes,this);g=new CGfxButton(CANVAS_WIDTH/2-180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_no"),a);g.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.show=function(){createjs.Tween.get(a).to({alpha:1},150,createjs.quartOut).call(function(){s_oGame.pause(!0)})};this.unload=function(){createjs.Tween.get(a).to({alpha:0},
150,createjs.quartOut).call(function(){b.removeChild(a,d)})};this._onButYes=function(){createjs.Ticker.paused=!1;this.unload();s_oGame.onExit();d.removeAllEventListeners()};this._onButNo=function(){s_oGame.pause(!1);this.unload();a.visible=!1;d.removeAllEventListeners()};var b=m;this._init()}
function CCreditsPanel(){var m,c,f,g,a,d,b,l,k;this._init=function(){k=new createjs.Container;s_oStage.addChild(k);var e=s_oSpriteLibrary.getSprite("msg_box");b=new createjs.Shape;b.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;c=b.on("click",this._onLogoButRelease);b.cursor="pointer";k.addChild(b);f=createBitmap(e);f.x=CANVAS_WIDTH_HALF;f.y=CANVAS_HEIGHT_HALF;f.regX=.5*e.width;f.regY=.5*e.height;k.addChild(f);e=s_oSpriteLibrary.getSprite("but_exit");m=.5*CANVAS_WIDTH+
380;a=new CGfxButton(m,180,e,k);a.addEventListener(ON_MOUSE_UP,this.unload,this);d=new createjs.Text(TEXT_CREDITS_DEVELOPED,"50px "+FONT_GAME,"#ffffff");d.textAlign="center";d.textBaseline="alphabetic";d.x=CANVAS_WIDTH/2;d.y=280;k.addChild(d);e=s_oSpriteLibrary.getSprite("logo_ctl");g=createBitmap(e);g.regX=e.width/2;g.regY=e.height/2;g.x=CANVAS_WIDTH/2;g.y=380;k.addChild(g);l=new createjs.Text("WWW.CODETHISLAB.COM","50px "+FONT_GAME,"#ffffff");l.textAlign="center";l.textBaseline="alphabetic";l.x=
CANVAS_WIDTH/2;l.y=520;k.addChild(l)};this.unload=function(){b.off("click",c);a.unload();a=null;s_oStage.removeChild(k)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CConfirmPanel(m){var c=this,f=[],g=[],a=[],d,b,l=CANVAS_WIDTH/2,k=CANVAS_HEIGHT/2+50,e,h,p;this._init=function(){var a=s_oSpriteLibrary.getSprite("msg_box_small");b=new createjs.Container;b.x=l;b.y=CANVAS_HEIGHT+.5*a.width;e=new createjs.Shape;e.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;e.on("mousedown",this._onClick);s_oStage.addChild(e);d=createBitmap(a);d.regX=a.width/2;d.regY=a.height/2;b.addChild(d);new CTLText(b,-220,-140,440,130,35,"center",TEXT_COLOR,
FONT_GAME,1,0,0,m,!0,!0,!0,!1);h=new CGfxButton(-180,70,s_oSpriteLibrary.getSprite("but_no"),b);h.pulseAnimation();p=new CGfxButton(180,70,s_oSpriteLibrary.getSprite("but_yes"),b);s_oStage.addChild(b);this.show()};this._initListener=function(){h.addEventListener(ON_MOUSE_DOWN,this.buttonNoDown,this);p.addEventListener(ON_MOUSE_DOWN,this.buttonYesDown,this)};this.addEventListener=function(a,b,c){f[a]=b;g[a]=c};this.buttonNoDown=function(){f[ON_BUT_NO_DOWN]&&f[ON_BUT_NO_DOWN].call(g[ON_BUT_NO_DOWN],
a)};this.buttonYesDown=function(){f[ON_BUT_YES_DOWN]&&f[ON_BUT_YES_DOWN].call(g[ON_BUT_YES_DOWN],a)};this._onClick=function(){};this.show=function(){createjs.Tween.get(e).to({alpha:.9},500,createjs.Ease.quadOut);createjs.Tween.get(b).to({y:k},500,createjs.Ease.quadOut).call(function(){c._initListener()})};this.unload=function(){createjs.Tween.get(b).to({y:1.5*CANVAS_HEIGHT},500).call(function(){s_oStage.removeChild(b)});createjs.Tween.get(e).to({alpha:0},500,createjs.Ease.quadIn).call(function(){s_oStage.removeChild(e)})};
this._init();s_oVariousHelp=this;return this}var s_oVariousHelp=null;
function CPause(){var m,c;this._init=function(){m=new createjs.Container;m.alpha=0;c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=.5;c.on("click",function(){});m.addChild(c);var f=new createjs.Text(TEXT_PAUSE,"70px "+FONT_GAME,TEXT_COLOR);f.x=.5*CANVAS_WIDTH;f.y=.5*CANVAS_HEIGHT-100;f.textAlign="center";m.addChild(f);f=s_oSpriteLibrary.getSprite("but_continue");(new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+90,f,m)).addEventListener(ON_MOUSE_UP,
this._onLeavePause,this);s_oStage.addChild(m);var g=this;createjs.Tween.get(m).to({alpha:1},150,createjs.quartOut).call(function(){g.onPause(!0)})};this.onPause=function(c){s_oGame.pause(c)};this.unload=function(){c.off("click",function(){});s_oStage.removeChild(m)};this._onLeavePause=function(){createjs.Ticker.paused=!1;createjs.Tween.removeTweens(m);var c=this;createjs.Tween.get(m).to({alpha:0},150,createjs.quartIn).call(function(){c.onPause(!1);s_oInterface.unloadPause()})};this._init();return this}
function CQuarterback(m,c,f,g){var a,d;this._init=function(b,c,f,e){d=e;e=new createjs.SpriteSheet({images:[f],frames:{width:f.width/10,height:f.height/8,regX:f.width/2/10,regY:f.height/8},animations:{idle:0,shot:[0,36,"stay",30/FPS],stay:[37,79,"remain",30/FPS],remain:[79]}});a=createSprite(e,"idle",f.width/2/10,f.height/8,f.width/10,f.height/8);a.x=b;a.y=c;d.addChild(a)};this.reset=function(){a.gotoAndStop("idle")};this.getX=function(){return a.x};this.getY=function(){return a.y};this.setPosition=
function(b,c){null!==b&&(a.x=b);null!==c&&(a.y=c)};this.rotate=function(b){a.scaleX=b};this.setVisible=function(b){a.visible=b};this.changeState=function(b){a.gotoAndPlay(b)};this.stopAnimation=function(){a.stop()};this.playAnimation=function(){a.play()};this.onFinishAnimation=function(){a.on("animationend",function(b){s_oGame.addImpulseToBall();a.removeAllEventListeners()})};this.fadeAnimation=function(b){createjs.Tween.get(a).to({alpha:b},500)};this.removeTweens=function(){createjs.Tween.removeTweens(a)};
this._init(m,c,f,g);return this}
function CMsgBox(m,c){var f,g;this._init=function(a){g=new createjs.Container;d.addChild(g);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=.5;a.on("click",function(){});g.addChild(a);a=s_oSpriteLibrary.getSprite("msg_box");var b=createBitmap(a);b.x=.5*CANVAS_WIDTH;b.y=.5*CANVAS_HEIGHT;b.regX=.5*a.width;b.regY=.5*a.height;g.addChild(b);new CTLText(g,CANVAS_WIDTH/2-360,200,720,250,40,"center",TEXT_COLOR,FONT_GAME,1,0,0,TEXT_ERR_LS,!0,!0,!0,!1);f=
new CGfxButton(CANVAS_WIDTH/2,550,s_oSpriteLibrary.getSprite("but_yes"),g);f.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){a.unload()};this.unload=function(){f.unload();d.removeChild(g)};var a=this;var d=c;this._init(m)}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var m=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(m--,this._oText.font=m+"px "+this._szFont,this._oText.lineHeight=Math.round(m*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>m););this._iFontSize=m}},__verticalAlign:function(){if(this._bVerticalAlign){var m=this._oText.getBounds().height;this._oText.y-=
(m-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(m){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(m,
this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(m)},setVerticalAlign:function(m){this._bVerticalAlign=m},setOutline:function(m){null!==this._oText&&(this._oText.outline=m)},setShadow:function(m,c,f,g){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(m,c,f,g))},setColor:function(m){this._oText.color=m},setAlpha:function(m){this._oText.alpha=m},setVisible:function(m){this._oText.visible=m},setX:function(m){this._x=m;this._oText.x=m},setY:function(m){this._y=m;this._oText.y=m},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},
getText:function(){return this._oText},getX:function(){return this._x},getY:function(){return this._y},getFontSize:function(){return this._iFontSize},refreshText:function(m){""===m&&(m=" ");null===this._oText&&this.__createText(m);this._oText.text=m;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(m,c,f,g,a,d,b,l,k,e,h,p,n,q,t,r,y){this._oContainer=m;this._x=c;this._y=f;this._iWidth=g;this._iHeight=a;this._bMultiline=r;this._iFontSize=d;this._szAlign=b;this._szColor=l;this._szFont=k;this._iPaddingH=h;this._iPaddingV=p;this._bVerticalAlign=t;this._bFitText=q;this._bDebug=y;this._oDebugShape=null;this._fLineHeightFactor=e;this._oText=null;n&&this.__createText(n)};